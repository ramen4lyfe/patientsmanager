config = {
    "playground_survey_bi_weekly_digest": {
        "cron_schedule": "10 13 * * 5",
        "email_message": """
            <html>
                <body>
                    <p>Hello Playground Dogfooder!</p>
                    <p>Thank you for your continued participation in testing unreleased features for Assistant! As you may have noticed, you get points based on your participation in the Playground Program. The points are calculated each month and the Top 5 performers on the leaderboard are the Playground Champions! Here is how your engagement score is calculated:</p>
                    <ul>
                    <li>Each challenge survey completed in the last 28 days = 5 points</li>
                    <li>Each utterance related to the week's challenges in the last 14 days = 2 points</li>
                    <li>All other utterances ("Hey Portal") in the last 14 days = 1 point</li>
                    </ul>
                    <h3>How can you earn the most points?</h3>
                    <p>Glad you asked! It's easy!</p>
                    <ol>
                    <li>Talk to your Portal once a day ("Hey Portal")</li>
                    <li>Let us know how Assistant is doing by giving it a thumbs up or thumbs down after each utterance. </li>
                    <li>Try <a href="https://fb.workplace.com/groups/307426913277698/posts/845257579494626">this week's homework challenge</a>, try saying:
                    <ul>
                    <li>"Hey Portal, Hey Portal, play my daily discovery on TIDAL"</li>
                    <li>"Hey Portal, play More than a Feeling by Boston on TIDAL"</li>
                    <li>"Hey Portal, play some hip-hop music on TIDAL"</li>
                    <li>"Hey Portal, skip this song"</li>
                    <li>"Hey Portal, what is the name of the current song?"</li>
                    <li>"Hey Portal, play more songs by this artist"</li>
                    <li>"Hey Portal, play heavy metal on TIDAL"</li>
                    </ul>
                    </li></ol>
                    <h3> What's new?</h3>

                    <ul>
                    <li>Badges are now awarded to all dogfooders who have ever been on the Playground leaderboard for completing the most surveys and utterances! (View <a href="https://fb.workplace.com/groups/307426913277698/posts/793471478006570/">announcement</a>).</li>
                    <li><b>Don't fall behind on the leaderboard!</b> Make sure you complete the latest homework: <a href="https://fb.workplace.com/groups/307426913277698/announcements">View pinned homework assignments</a> to complete this week's challenge and fill out the survey before the end of the week!</li>
                    </ol>
                    <p></p>
                    <p>Remember, the more feedback you can provide, the more you can help our Development/QA teams improve the Portal Voice Assistant Experience!</p>
                    <p>Be sure to keep engaging with the voice Assistant feature of your Portal, we may ask you to return your device to give another dogfooder the opportunity if your engagement score is too low! If you are having problems with your device, are no longer interested in participating in Playground dogfooding, or would like to refer a friend please contact us at <a href = "mailto: playground-ops@fb.com">playground-ops@fb.com</a>
                    <p> </p>
                    <p> </p>
                    <p>Happy Dogfooding!</p><br/>
                    <p>The Playground Team</p>
                </body>
            </html>
            """,
        "query": """
        ------------------------------------------------------------
        --------------QUERY BEGINS----------------------------------
                --------- add up metrics, weighted by weights given in the macros, to produce an engagement score for each device.
                WITH metrics_pull AS (
                    SELECT
                        device_serial_number,
                        SUM(
                            CASE
                                WHEN (
                                    metric_category = 'utterance_count_l7' AND ds IN (
                                        '<LATEST_DS:playground_engagement_metrics>',
                                        CAST(
                                            DATE '<LATEST_DS:playground_engagement_metrics>' -INTERVAL '7' DAY
                                                AS VARCHAR
                                        )
                                    )
                                ) THEN metric_value
                                ELSE 0
                            END
                        ) AS premium_utterance_count_l14,
                        SUM(
                            CASE
                                WHEN (
                                    metric_category = 'utterance_count_l7' AND ds IN (
                                        '<LATEST_DS:playground_engagement_metrics>',
                                        CAST(
                                            DATE '<LATEST_DS:playground_engagement_metrics>' -INTERVAL '7' DAY
                                                AS VARCHAR
                                        )
                                    ) AND metric_name IN (
                        -------------------------------------------------------------------------------------------------------------------
                        -------------------------------------------------------------------------------------------------------------------
                                        -----ENTER PREMIUM UTTERANCE NAMES BELOW, SEPARATED BY COMMAS
                                        -------------------------------------------------------
                                        ------------------------------------------------------
                                        'people',
                                        'weather',
                                        'sidechef',
                                        'calling_whatsapp',
                                        'room',
                                        'messaging',
                                        'reminder',
                                        'mask',
                                        'calling',
                                        'photos',
                                        'music',
                                        'podcast',
                                        'timer',
                                        'time',
                                        'alarm',
                                        'location',
                                        'pronunciation',
                                        'video',
                                        'restaurant',
                                        'people',
                                        'notion',
                                        'business',
                                        'transparency',
                                        'communities',
                                        'memory'
                                        -------------------------------------------------------------------------------------------------------------------
                        -------------------------------------------------------------------------------------------------------------------
                        -------------------------------------------------------------------------------------------------------------------
                                    )
                                ) THEN metric_value
                                ELSE 0
                            END
                        ) AS utterance_count_l14,
                        SUM(
                            CASE
                                WHEN (
                                    metric_category = 'survey_count_l28'
                                        AND ds = '<LATEST_DS:playground_engagement_metrics>'
                                ) THEN metric_value
                                ELSE 0
                            END
                        ) AS survey_count_l28
                    FROM playground_engagement_metrics
                    GROUP BY
                        device_serial_number
                ),
                engagement_scores AS (
                    SELECT
                        amt.owner_fbid,
                        set_agg(mtx.device_serial_number) AS devices,
                        SUM(
                            mtx.premium_utterance_count_l14 * (
                                2 -------------> premium utterance weight
                                -1
                            ) + mtx.utterance_count_l14 * 1 ---------------> utterance weight
                            + mtx.survey_count_l28 * 5 --------------> survey weight
                        ) AS engagement_score
                    FROM metrics_pull mtx
                    LEFT JOIN dim_aloha_asset_management amt
                        ON amt.serial_number = mtx.device_serial_number
                    WHERE
                        amt.ds = '<LATEST_DS:dim_aloha_asset_management>'
                    GROUP BY
                        amt.owner_fbid
                )
                --SELECT * FROM engagement_scores
                , engagement_percentiles AS (
                    SELECT
                        ROW_NUMBER() OVER (
                            ORDER BY
                                engagement_score
                        ) AS rownum,
                        owner_fbid,
                        devices,
                        engagement_score,
                        engagement_score + 15 AS goal_engagement_score,
                        RANK() OVER (
                            ORDER BY
                                engagement_score
                        ) AS rank,
                        PERCENT_RANK() OVER (
                            ORDER BY
                                engagement_score
                        ) AS percentile -- this computes their rank percentile = the % of people who have lower score.
                    FROM engagement_scores
                ),
                engagement_with_goals AS (
                    SELECT
                        me.owner_fbid,
                        me.devices,
                        me.engagement_score,
                        me.percentile,
                        COUNT(1) AS total_number_of_devices,
                        COUNT_IF(me.goal_engagement_score > them.engagement_score)
                            AS number_of_people_below_goal_score,
                        CAST(COUNT_IF(me.goal_engagement_score > them.engagement_score) AS DOUBLE) / CAST(
                            COUNT(1) AS DOUBLE
                        ) AS goal_percentile
                    FROM engagement_percentiles me
                    CROSS JOIN engagement_percentiles them
                    GROUP BY
                        1, 2, 3, 4
                )
                SELECT
                    devices[1] AS device_serial_number,
                    hr.preferred_first_name AS first_name,
                    owner_fbid AS FBID,
                    hr.work_email AS email,
                    CAST(engagement_score AS VARCHAR) AS engagement_score,
                    CASE
                        WHEN (percentile > 0.9) THEN CONCAT(
                            '&#128054; &#129377; &#127878; You''re on fire! You''re in the in the top ',
                            CAST(CAST(TRUNCATE(100 - percentile * 100) AS INTEGER) AS VARCHAR),
                            '% of all dogfooders. You are on your way to be one of our monthly champions!'
                        )
                        WHEN (percentile > 0.5) THEN CONCAT(
                            '&#128054; &#129377; &#128077; You''re doing good! You''re in the top ',
                            CAST(CAST(TRUNCATE(100 - percentile * 100) AS INTEGER) AS VARCHAR),
                            '% of all Playground dogfooders! But consider this: just 15 more points would have put you in the top ',
                            CAST(CAST(TRUNCATE(100 - goal_percentile * 100) AS INTEGER) AS VARCHAR),
                            '% this week! You could become one of our top participants!'
                        )
                        ELSE CONCAT(
                            '&#128054; &#129377; &#128542; Oh no:( You''re in the bottom ',
                            CAST(CAST(TRUNCATE(percentile * 100) AS INTEGER) AS VARCHAR),
                            '%! That means you have not been utilizing the Voice Assistant on your Portal much in the last couple weeks. But just think, 15 more points would have catapulted you into the top ',
                            CAST(CAST(TRUNCATE(100 - goal_percentile * 100) AS INTEGER) AS VARCHAR),
                            '% this week!'
                        )
                    END AS blurb
                FROM engagement_with_goals e
                LEFT JOIN d_employee_plus:hr hr
                    ON e.owner_fbid = hr.personal_fbid
                WHERE
                    hr.ds = '<LATEST_DS:d_employee_plus:hr>'
       ----------------END OF QUERY----------------------
        ----------------------------------------------------
        """,
        "columns": [
            "device_serial_number",
            "first_name",
            "FBID",
            "email",
            "engagement_score",
            "blurb",
        ],
        "sender": "Project Playground <playground-ops@fb.com>",
        "email_subject": "Project Playground Bi-Weekly Digest",
        "is_enabled": "FALSE",
        "create_task": "FALSE",
    },
    "PG_new_wake_word_announcement": {
        "cron_schedule": "0 16 * * 1",
        "email_message": """
            <html>
                <head>
                </head>
                <body>
                    <p>Hi All,</p>
                    <p>We’re excited to announce that beginning on Monday, August 24th, all Playground devices will switch their default wakeword from “Hey Portal” to “Hey Facebook”!</p>
                    <p><u>This means you will need to activate your Assistant with "Hey Facebook".</u> For example, "Hey Facebook, play workout music on iHeartRadio!"</p>
                    <p>Please Note: The 'Hey Facebook' wakeword is <u> CONFIDENTIAL, so please avoid using it in front of friends/family who haven't signed NDAs.</u></p>
                    <p>If for any reason you want to revert back to "Hey Portal...", you can follow the steps below:</p>
                    <ol>
                    <ol>
                    <li>Open Settings</li>
                    <li>Select Assistant</li>
                    <li>Select "Hey Portal"</li>
                    <li>Select Wake word</li>
                    <li>Choose "Hey Facebook" or "Hey Portal"</li>
                    </ol>
                    </ol>
                    <p>As you explore this new change, please continue to provide feedback via the Weekly Challenge surveys.</p>
                    <p>Best, The Playground Team</p>
                </body>
            </html>
            """,
        "query": """
                  WITH
                  ---- the latest list of active employees, their names, fbids and emails.
                  hr AS (
                      SELECT
                          preferred_first_name,
                          work_email,
                          personal_fbid,
                          location_country
                      FROM d_employee_plus:hr
                      WHERE
                          ds = '<LATEST_DS:d_employee_plus:hr>'
                          AND is_active = TRUE
                  ),
                  ----a list of assigned playground dogfood devices
                  --- and also their owners, their owners' emails and countries.
                  summary AS (
                      SELECT
                          adds.device_serial_number,
                          adds.owner_fbid AS FBID,
                          hr.preferred_first_name AS first_name,
                          hr.work_email AS email,
                          hr.location_country AS country
                      FROM aloha_device_dogfooding_summary adds
                      JOIN hr
                          ON adds.owner_fbid = hr.personal_fbid
                      WHERE
                          adds.ds = '<LATEST_DS:aloha_device_dogfooding_summary>'
                          AND adds.ota_channel_amt = 'Playground' --a device that received Playground ota software pushes
                          AND adds.allocation_team = 'Playground' --a device allocated to the Playground program.
                          AND adds.df_flag = 1 --device is flagged as dogfooding
                          AND adds.owner_fbid > 0 --device is assigned to somebody
                  )
                  SELECT
                      device_serial_number,
                      FBID,
                      first_name,
                      email
                  FROM summary
                      ----------------------------------------------------------------------------------
                      ----------------------------------------------------------------------------------
                      ------------Uncomment the line below for US-specific surveys--------------
                      ------------(uncommenting means removing the two dashes in front of it)---------
                      -------------------------------------------------------------------------------
                  WHERE
                      country IN ('United States')
                      ------------------------------------------------------------------------------
                      ----------------------------------------------------------------------------------
            """,
        "columns": ["device_serial_number", "FBID", "first_name", "email"],
        "sender": "The Portal Dogfood Survey Team <portaldogfoodingsurvey@fb.com>",
        "email_subject": "*Announcement* New default wake word for Playground devices",
        "is_enabled": "FALSE",
        "create_task": "FALSE",
    },
    "playground_weekly_survey_announcement": {
        "cron_schedule": "10 14 * * 2",
        "email_message": """
            <html>
                <body>
                    Hello {columns[first_name]},
                    <br/> <p> Thanks for your continued participation in Playground Dogfooding for Assistant on Portal!
                        <p>
                        <p>
                                New homework announcement! Please take some time to complete this brief survey reflecting on your experience with the new feature: <i>Smart Out of Coverage Handling with Response Variations</i>
                        <p>
                        <p>
                            <a href="https://fburl.com/51w491rl">Playground Dogfood Survey for week of 05/23/22.</a>
                            </p>
                            <p>
                            <h2>Now Testing: Smart Out of Coverage Handling with Response Variations (EN_US ONLY) </h2>

                            <h3>Assistant on Portal will inform you know when a feature is not currently supported</h3>
                            <p>Tell us about your experience in telling Assistant a command that is out of coverage, and note the response that you receive as Assistant handles your request. Please complete the homework for this feature in the link above, before the end of the week! Visit the <a href="https://fb.workplace.com/groups/307426913277698/permalink/968602443826805/"> homework post</a> for the video demo and more detailed instructions to complete the homework.</p>
                     <h3> TLDR; What is it?</h3>
            <p>Simply tell Assistant utterances not currently supported like 'Hey Portal, how is the traffic southbound on highway 101?' -or- 'Hey Portal, what’s the score of last night’s game' Assistant will respond and let you know if the command is not supported and is out of coverage. </p>

                    <h3> What Else?</h3>

                    <ul>
                    <li>Feature is available in EN_US.</li></br>
                    <li>Your feedback is greatly appreciated, feel free to provide details about your experience directly on the homework posts and in your survey response. Please be as detailed as possible and try the homework as many times as you'd like!</li></br>
                    <li>The more you try, the better for Assistant! If you see other issues on your Portal, please use the bugnub in the bottom right corner to report.</li></br>
                    <li>If you have other questions/comments, please post in the Project Playground Feedback group!</li></br>
                    </ul>

                    </p>
                    <p>
                            Happy Dogfooding!<br/><br/><br/>
                            Thank you,<br/><br/>
                            The Playground Team
                    </p>
                </body>
            </html>
            """,
        "query": """
            WITH
            ---- the latest list of active employees, their names, fbids and emails.
            hr AS (
                SELECT
                    preferred_first_name,
                    work_email,
                    personal_fbid,
                    location_country
                FROM d_employee_plus:hr
                WHERE
                    ds = '<LATEST_DS:d_employee_plus:hr>'
                    AND is_active = TRUE
            ),
            ----a list of assigned playground dogfood devices
            --- which have been online at least 1 day out of the last 28,
            --- and also their owners, their owners' emails and countries.
            summary AS (
                SELECT
                    adds.device_serial_number,
                    adds.owner_fbid AS FBID,
                    hr.preferred_first_name AS first_name,
                    hr.work_email AS email,
                    hr.location_country AS country
                FROM aloha_device_dogfooding_summary adds
                JOIN hr
                    ON adds.owner_fbid = hr.personal_fbid
                WHERE
                    adds.ds = '<LATEST_DS:aloha_device_dogfooding_summary>'
                    AND adds.ota_channel_amt = 'Playground' --a device that received Playground ota software pushes
                  --   AND (
                       --         adds.allocation_team = 'Playground'
                        --        OR adds.allocation_team = 'Workplace VC'
                         --   ) --a device allocated to the Playground program.
                            --AND adds.df_flag = 1             --device is flagged as dogfooding
                            AND adds.owner_fbid > 0 --device is assigned to somebody
                      --      AND adds.hardware_type IN ('ohana', 'omni')
                            
                 --   AND adds.device_online_l28 > 0   --device was online in the last 28 days
            )
            SELECT
                device_serial_number,
                FBID,
                first_name,
                email
            FROM summary
                        ----------------------------------------------------------------------------------
                        ----------------------------------------------------------------------------------
                        ------------Uncomment the line below for US-specific surveys--------------
                        ------------(uncommenting means removing the two dashes in front of it)---------
                        -------------------------------------------------------------------------------

                        --    WHERE country in ('United States')

                        ------------------------------------------------------------------------------
                        ----------------------------------------------------------------------------------
                """,
        "columns": ["device_serial_number", "FBID", "first_name", "email"],
        "sender": "Project Playground <playground-ops@fb.com>",
        "email_subject": "Playground Weekly Survey",
        "is_enabled": "FALSE",
        "create_task": "FALSE",
    },
    "playground_weekly_survey_reminder": {
        "cron_schedule": "10 14 * * 4",
        "email_message": """
                <html>
                    <head>
                    </head>
                    <body>
                        Hello {columns[first_name]},
                    <br/> <p> Thank you for your continued participation in Playground Dogfooding for Assistant on Portal.
            <br/> <p> This is a friendly reminder to please complete the Playground Weekly Survey that recently launched ON 05/23/22.
                    <p>
                    <p>Please take some time to complete this brief survey reflecting on your experience with the new feature: <i>Smart Out of Coverage Handling with Response Variations</i>
                        <p>
                        <p>
                            <a href="https://fburl.com/51w491rl">Playground Dogfood Survey for week of 05/23/22.</a>
                            </p>
                            <p>
                            <h2>Now Testing: Smart Out of Coverage Handling with Response Variations (EN_US ONLY) </h2>

                            <h3>Assistant on Portal will inform you know when a feature is not currently supported</h3>
                            <p>Tell us about your experience in telling Assistant a command that is out of coverage, and note the response that you receive as Assistant handles your request. Please complete the homework for this feature in the link above, before the end of the week! Visit the <a href="https://fb.workplace.com/groups/307426913277698/permalink/968602443826805/"> homework post</a> for the video demo.</p>
                     <h3> TLDR; What is it?</h3>
            <p>Simply tell Assistant utterances not currently supported like 'Hey Portal, how is the traffic southbound on highway 101?' -or- 'Hey Portal, what's the score of last night's game?' Assistant will respond and let you know if the command is not supported and is out of coverage. </p>

                    <h3> What Else?</h3>

                    <ul>
                    <li>Feature is available in EN_US.</li></br>
                    <li>Your feedback is greatly appreciated, feel free to provide details about your experience directly on the homework posts and in your survey response. Please be as detailed as possible and try the homework as many times as you'd like!</li></br>
                    <li>The more you try, the better for Assistant! If you see other issues on your Portal, please use the bugnub in the bottom right corner to report.</li></br>
                    <li>If you have other questions/comments, please post in the Project Playground Feedback group!</li></br>
                    </ul>

                    </p>
                    <p>
                            Happy Dogfooding!<br/><br/><br/>
                            Thank you,<br/><br/>
                            The Playground Team
                    </p>
                    </body>
                </html>
                """,
        "query": """
                WITH
                ---- the latest list of active employees, their names, fbids and emails.
                hr AS (
                    SELECT
                        preferred_first_name,
                        work_email,
                        personal_fbid,
                        location_country
                    FROM d_employee_plus:hr
                    WHERE
                        ds = '<LATEST_DS:d_employee_plus:hr>'
                        AND is_active = TRUE
                ),

                survey_responders AS (
                    SELECT user_id
                    FROM simon_responses_formatted:growth 
                    where survey_id =
                ---------------------------------------------------------------------------------------
                ---------------------------------------------------------------------------------------
                ----------------ENTER THE SURVEY ID BELOW: ------------------------------------

                            435806124874095

                ---------------------------------------------------------------------------------------
                ---------------------------------------------------------------------------------------
                ---------------------------------------------------------------------------------------
                    and ds > '<DATEID-90>'
                ),

                --a list of assigned playground dogfood devices
                --which have been online at least 1 day out of the last 28,
                --and also their owners, their owners' emails and countries.
                summary AS (
                    SELECT
                        adds.device_serial_number,
                        adds.owner_fbid AS FBID,
                        hr.preferred_first_name AS first_name,
                        hr.work_email AS email,
                        hr.location_country AS country
                    FROM aloha_device_dogfooding_summary adds
                    JOIN hr
                        ON adds.owner_fbid = hr.personal_fbid
                    WHERE
                        adds.ds = '<LATEST_DS:aloha_device_dogfooding_summary>'
                        AND adds.ota_channel_amt = 'Playground' --a device that received Playground ota software pushes
                     --   AND adds.allocation_team = 'Playground' --a device allocated to the Playground program.
                    --    AND adds.df_flag = 1             --device is flagged as dogfooding
                        AND adds.owner_fbid > 0          --device is assigned to somebody
                        --AND adds.device_online_l28 > 0   --device was online in the last 28 days
                        AND adds.owner_fbid not in (select * from survey_responders)
                )

                SELECT
                    device_serial_number,
                    FBID,
                    first_name,
                    email
                FROM summary
                ----------------------------------------------------------------------------------
                ----------------------------------------------------------------------------------
                ------------Uncomment the line below for US-specific surveys--------------
                ------------(uncommenting means removing the two dashes in front of it)---------
                -------------------------------------------------------------------------------

                    WHERE country in ('United States')

                ------------------------------------------------------------------------------
                ----------------------------------------------------------------------------------
                """,
        "columns": ["device_serial_number", "FBID", "first_name", "email"],
        "sender": "Project Playground <playground-ops@fb.com>",
        "email_subject": "*Reminder* Playground Weekly Survey",
        "is_enabled": "FALSE",
        "create_task": "FALSE",
    },
    "create_tasks": {
        "cron_schedule": "0 10 * * 3-5",
        "task_title": """It appears your {columns[device_type]} ({columns[device_serial_number]})
                            hasn't been plugged in for a while""",
        "task_descrption": """If you aren't enjoying the experience and would like to
                            return the device, please send an email to playground-ops@fb.com
                            and we will follow up with next steps""",
        "priority": "2",
        "subscibers": ["manojkk", "klawler", "bradleyprocopio"],
        "tags": ["2416408735254036"],
        "creator": "manojkk",
        "query": """
            SELECT
            serial AS device_serial_number,
            hardware_type AS device_type,
            '100001292485300' AS FBID
            FROM
            aloha_device_dogfooding_summary
            WHERE ds = '<LATEST_DS:aloha_device_dogfooding_summary>'
            AND owner_fbid in (35803977, 1349706199)
            LIMIT 5
            """,
        "columns": ["device_serial_number", "device_type", "FBID"],
        "is_enabled": "FALSE",
        "create_task": "FALSE",
    },
    "playground_weekly_tasks": {
        "cron_schedule": "0 10 * * 5",
        "task_title": """Playground Weekly Survey : Reminder""",
        "task_descrption": """Thank you for dogfooding Portal's Assistant!

                            This week, we asked you and other Playground users to test Local Q&A.

                            <a href="https://fb.workplace.com/groups/307426913277698/permalink/751426188877766">Homework challenge post</a>

                            Please take a few moments to complete this brief survey of your experience testing this feature:
                            <a href="https://www.internalfb.com/intern/survey/simon/take/?oid=173573854651845"> Playground Survey </a>
                         """,
        "priority": "0",
        "subscibers": ["purin", "klawler"],
        "tags": ["2416408735254036"],
        "creator": "purin",
        "query": """
             SELECT
                distro.owner_fbid AS FBID
            FROM (
                SELECT
                    amt.owner_fbid,
                    amt.serial_number AS device_serial_number,
                    amt.allocation_team AS project,
                    hr.preferred_first_name,
                    hr.preferred_last_name,
                    hr.unix_username,
                    hr.work_email
                FROM dim_aloha_asset_management amt
                JOIN (
                    SELECT
                        preferred_first_name,
                        preferred_last_name,
                        unix_username,
                        work_email,
                        personal_fbid
                    FROM d_employee_plus:hr
                    WHERE
                        ds = '<LATEST_DS:d_employee_plus:hr>'
                        AND is_active = TRUE
                ) hr
                    ON amt.owner_fbid = hr.personal_fbid
                WHERE
                    ds = '<DATEID-1>'
                    AND allocation_team = 'Playground'
                    AND ota_channel = 'Playground'
                    AND owner_fbid > 0
                    AND df_flag = 1
                    AND amt.owner_fbid NOT IN (100000268825948)
            ) distro
            LEFT JOIN (
                SELECT
                    *
                FROM simon_responses_formatted_non_bucketed:growth
                WHERE
                    survey_id = ---------------------------------------------------------------------------------------
                ---------------------------------------------------------------------------------------
                ----------------ENTER THE SURVEY ID BELOW: ------------------------------------

                            551007222780858

                ---------------------------------------------------------------------------------------
                ---------------------------------------------------------------------------------------
                ---------------------------------------------------------------------------------------
                AND ds > '<DATEID-30>'
            ) complete
                ON distro.owner_fbid = complete.user_id
            WHERE
                complete.user_id IS NULL
                AND distro.device_serial_number NOT IN (
                    SELECT
                        summary.device_serial_number
                    FROM (
                        SELECT
                            device_serial_number,
                            owner_fbid,
                            CONCAT(first_name, ' ', last_name) AS employee_name,
                            email,
                            device_online_last_action_date,
                            assigned_at_time
                        FROM aloha_device_dogfooding_summary
                        WHERE
                            ds = '<LATEST_DS:aloha_device_dogfooding_summary>'
                            AND ota_channel_amt = 'Playground'
                            AND allocation_team = 'Playground'
                            AND (
                                device_online_last_action_date < '<DATEID-30>'
                                OR device_online_last_action_date IS NULL
                            )
                            AND assigned_at_time < '<DATEID-30>'
                    ) summary
                    JOIN (
                        SELECT
                            AVG(request_count_overall_1d) AS assistant_use_average_daily,
                            AVG(overall_time_spent_min_1d) AS avg_time_spent_daily,
                            serial_number,
                            SUM(request_count_overall_1d) AS total_assistant_use
                        FROM aloha_long_term_df
                        GROUP BY
                            3
                    ) df
                        ON summary.device_serial_number = df.serial_number
                    JOIN (
                        SELECT
                            personal_fbid,
                            building_id
                        FROM d_employee_plus:hr
                        WHERE
                            ds = '<LATEST_DS:d_employee_plus:hr>'
                    ) e
                        ON e.personal_fbid = summary.owner_fbid
                    WHERE
                        total_assistant_use = 0
                        AND assistant_use_average_daily = 0
                        AND avg_time_spent_daily = 0
                    GROUP BY
                        1
                )
            GROUP BY
                1
                      """,
        "columns": ["FBID"],
        "is_enabled": "FALSE",
        "create_task": "FALSE",
    },
    "generate_weekly_email_super_user": {
        "cron_schedule": "0 16 * * 4",
        "email_message": """
            <html>
            <head>
            </head>
            <body>
            Hey {columns[first_name]}!<br/>
            <p>
            You're one of our top Dogfooders on your {columns[hardware_type]} ({columns[device_serial_number]}) over the last week - we’re impressed! Keep up the great work. Your engagement score for this week is {columns[df_points_7d]}, which puts you in the {columns[percentile]} percentile of Dogfooders!
            <p>
            <p>
            To see a more detailed breakdown of your device usage, please see your <a href="https://fburl.com/unidash/zx492wbb">personalized dashboard.</a> <b>Please keep in mind that these metrics do not account for WhatsApp usage.</b>
            <p>Engaging with your device doesn’t just help us improve Portal - it can earn you points to redeem for awesome swag! Learn more about our Dogfooding Swag Store <a href="https://fb.workplace.com/groups/1709552312652936/permalink/2958714477736707/">here.</a>
            <p>
            We sincerely appreciate your feedback and engagement, and encourage you to continue reporting bugs via Bugnub and posting about your experiences in the <a href="https://fb.workplace.com/groups/1959599607620319">Portal Feedback Workplace group</a>.
            <p>
            Best,<br/>
            The Portal Dogfooding Team
            </p>
            </body>
            </html>
            """,
        "query": """
            SELECT
                serial_number AS device_serial_number,
                hardware_type,
                first_name,
                owner_fbid AS FBID,
                work_email AS email,
                device_online_l7,
                df_points_7d,
                percentile
            FROM (
                SELECT
                    serial_number,
                    hardware_type,
                    first_name,
                    owner_fbid,
                    work_email,
                    device_online_l7,
                    df_points_7d,
                    ROUND(
                        (
                            PERCENT_RANK() OVER(
                                PARTITION BY
                                    ds
                                ORDER BY
                                    df_points_7d DESC,
                                    device_online_l7 DESC
                            )
                        ) * 100,
                        2
                    ) AS percentile
                FROM (
                    SELECT
                        ds,
                        serial_number,
                        hardware_type,
                        first_name,
                        owner_fbid,
                        work_email,
                        device_online_l7,
                        ROUND(SUM(metric_value_7d)) AS df_points_7d
                    FROM (
                        SELECT
                            amt.ds,
                            serial_number,
                            amt.first_name,
                            hardware_type,
                            owner_fbid,
                            work_email
                        FROM dim_aloha_asset_management amt
                        JOIN d_employee_plus:hr hr
                            ON amt.owner_fbid = hr.personal_fbid
                        WHERE
                            amt.ds = '<LATEST_DS:dim_aloha_asset_management>'
                            AND hr.ds = '<LATEST_DS:d_employee_plus:hr>'
                            AND amt.df_flag = 1
                            AND amt.edf_flag <> 1
                            AND amt.owner_fbid > 0
                            AND amt.secondary_owner_fbid IS NULL
                            AND ota_channel IN (
                                'Portal OTA Alpha',
                                'Portal OTA Beta',
                                'Prod (Restricted)',
                                'Portal DF Prod Hotfix'
                            )
                            AND allocation_team IN('Dogfood')
                            AND NOT CONTAINS(asset_tags, 1420923608029097) --task created for returns
                            AND NOT CONTAINS(asset_tags, 138060473031027) --recalls
                    ) amt
                    LEFT JOIN (
                        SELECT
                            device_serial_number,
                            last_action_date AS device_online_last_action_date,
                            first_action_date AS device_online_first_action_date,
                            l1 AS device_online_l1,
                            l7 AS device_online_l7,
                            l28 AS device_online_l28
                        FROM aloha_heartbeat_datelist_slim
                        WHERE
                            ds = '<LATEST_DS:aloha_heartbeat_datelist_slim>'
                    ) online
                        ON amt.serial_number = online.device_serial_number
                    LEFT JOIN (
                        SELECT
                            device_serial_number,
                            CASE
                                WHEN last_action_date = ds THEN 1
                                ELSE 0
                            END AS active_device_l1,
                            l7 AS active_device_l7,
                            l28 AS active_device_l28
                        FROM aloha_active_devices_datelist
                        WHERE
                            ds = '<LATEST_DS:aloha_active_devices_datelist>'
                    ) active
                        ON amt.serial_number = active.device_serial_number
                    LEFT JOIN (
                        SELECT
                            device_serial_number,
                            metric_name,
                            metric_value_7d * 0.1 AS metric_value_7d,
                            metric_value_28d * 0.1 AS metric_value_28d
                        FROM aloha_media_core_metrics_datelist_extension
                        WHERE
                            ds = '<LATEST_DS:aloha_media_core_metrics_datelist_extension>'
                            AND build = 'overall'
                            AND build = 'overall'
                            AND metric_name IN (
                                'mic_drop_timespent_min:performance',
                                'photobooth_timespent_min (overall)',
                                'ar_effects_time_spent_min (overall)',
                                'storytime_time_spent_min (overall)',
                                'storytime_time_spent_min_local (overall)',
                                '3p_app_time_spent_min (overall)',
                                'audio_consumption (overall)',
                                'browser_time_spent_min',
                                'video_consumption (overall)'
                                        )
                        UNION ALL

                        SELECT
                            device_serial_number,
                            metric_name,
                            metric_value_7d * 0.1 AS metric_value_7d,
                            metric_value_28d * 0.1 AS metric_value_28d
                        FROM aloha_portal_for_work_core_metrics_datelist_extension
                        WHERE
                            ds = '<LATEST_DS:aloha_portal_for_work_core_metrics_datelist_extension>'
                            AND build = 'overall'
                            AND metric_name IN ('talk_time_onevc (overall)', 'talk_time_total (overall)', 'call_count_total (overall)')

                        UNION ALL

                        SELECT
                            device_serial_number,
                            metric_name,
                            metric_value_7d * 0.1 AS metric_value_7d,
                            metric_value_28d * 0.1 AS metric_value_28d
                        FROM aloha_calling_actors_core_metrics_datelist_extension
                        WHERE
                            ds = '<LATEST_DS:aloha_calling_actors_core_metrics_datelist_extension>'
                            AND build = 'overall'
                            AND metric_name IN ('talk_time (overall)')
                            AND metric_category IN ('talk_time (min)', 'call_count')

                        UNION ALL

                        SELECT
                            device_serial_number,
                            'camera_ar_time_spent_min (overall)' AS metric_name,
                            SUM(metric_value_7d) * 0.1 AS metric_value_7d,
                            SUM(metric_value_28d) * 0.1 AS metric_value_28d
                        FROM (
                            SELECT
                                device_serial_number,
                                metric_name,
                                metric_value_7d,
                                metric_value_28d
                            FROM aloha_camera_ar_experiences_core_metrics_datelist_extension
                            WHERE
                                ds = '<LATEST_DS:aloha_camera_ar_experiences_core_metrics_datelist_extension>'
                                AND build = 'overall'
                                AND metric_name IN (
                                    'mic_drop_timespent_min:performance',
                                    'photobooth_timespent_min (overall)',
                                    'ar_effects_time_spent_min (overall)',
                                    'storytime_time_spent_min (overall)',
                                    'storytime_time_spent_min_local (overall)'
                                )
                        )
                        GROUP BY
                            1, 2

                        UNION ALL

                        SELECT
                            device_serial_number,
                            CASE
                                WHEN metric_name = 'request_count (overall)' THEN 'assistant_count (overall)'
                            END AS metric_name,
                            metric_value_7d * 5 AS metric_value_7d,
                            metric_value_28d * 5 AS metric_value_28d
                        FROM aloha_assistant_core_metrics_datelist_extension
                        WHERE
                            ds = '<LATEST_DS:aloha_assistant_core_metrics_datelist_extension>'
                            AND build = 'overall'
                            AND metric_name = 'request_count (overall)'

                        UNION ALL

                        SELECT
                            bn7.device_serial AS device_serial_number,
                            'bug_reports' AS metric_name,
                            bug_reports_7d AS metric_value_7d,
                            bug_reports_28d AS metric_value_28d
                        FROM (
                            SELECT
                                device_serial,
                                COUNT(bug_id) * 10 AS bug_reports_7d
                            FROM aloha_flytrap bn
                            WHERE
                                ds BETWEEN '<DATEID-7>' AND '<DATEID>'
                            GROUP BY
                                1
                        ) bn7
                        LEFT JOIN (
                            SELECT
                                device_serial,
                                COUNT(bug_id) * 10 AS bug_reports_28d
                            FROM aloha_flytrap bn
                            WHERE
                                ds BETWEEN '<DATEID-27>' AND '<DATEID>'
                            GROUP BY
                                1
                        ) bn30
                            ON bn7.device_serial = bn30.device_serial

                        UNION ALL

                        SELECT
                            serial_number AS device_serial_number,
                            'surveys_completed' AS metric_name,
                            survey_complete_l7 * 10 AS metric_value_7d,
                            survey_complete_l28 * 10 AS metric_value_28d
                        FROM (
                            SELECT
                                serial_number,
                                owner_fbid
                            FROM dim_aloha_asset_management
                            WHERE
                                ds = '<DATEID>'
                        ) amt
                        LEFT JOIN (
                            SELECT
                                user_id,
                                APPROX_DISTINCT(survey_id) AS survey_complete_l7
                            FROM simon_responses_formatted_non_bucketed:growth a
                            JOIN cdb.user_surveys.simon_id_index b
                                ON a.survey_id = b.id
                            WHERE
                                a.ds BETWEEN '<DATEID-7>' AND '<DATEID>'
                                AND b.keyval = 'survey_by_tag'
                                AND b.value = 'portal_df_survey'
                            GROUP BY
                                1
                            ORDER BY
                                2 DESC
                        ) s7
                            ON amt.owner_fbid = s7.user_id
                        LEFT JOIN (
                            SELECT
                                user_id,
                                APPROX_DISTINCT(survey_id) AS survey_complete_l28
                            FROM simon_responses_formatted_non_bucketed:growth a
                            JOIN cdb.user_surveys.simon_id_index b
                                ON a.survey_id = b.id
                            WHERE
                                a.ds BETWEEN '<DATEID-28>' AND '<DATEID>'
                                AND b.keyval = 'survey_by_tag'
                                AND b.value = 'portal_df_survey'
                            GROUP BY
                                1
                            ORDER BY
                                2 DESC
                        ) s28
                            ON amt.owner_fbid = s28.user_id

                        UNION ALL

                        SELECT
                            serial_number AS device_serial_number,
                            'feedback_group_posts' AS metric_name,
                            (
                                COUNT_IF(
                                    FROM_UNIXTIME(post_event_time) > DATE_ADD('day', -7, CURRENT_DATE)
                                )
                            ) * 10 AS metric_value_7d,
                            (
                                COUNT_IF(
                                    FROM_UNIXTIME(post_event_time) > DATE_ADD('day', -28, CURRENT_DATE)
                                )
                            ) * 10 AS metric_value_28d
                        FROM portal_feedback_posts f
                        JOIN d_employee_plus:hr hr
                            ON f.poster_unixname = hr.unix_username
                        JOIN dim_aloha_asset_management amt
                            ON hr.personal_fbid = amt.owner_fbid
                        WHERE
                            f.ds = '<LATEST_DS:portal_feedback_posts>'
                            AND hr.ds = '<LATEST_DS:d_employee_plus:hr>'
                            AND amt.ds = '<LATEST_DS:dim_aloha_asset_management>'
                        GROUP BY
                            1, 2
                    ) metrics
                        ON amt.serial_number = metrics.device_serial_number
                    GROUP BY
                        1, 2, 3, 4, 5, 6, 7
                )
            )
            WHERE
                df_points_7d > 50
            """,
        "columns": [
            "device_serial_number",
            "hardware_type",
            "first_name",
            "email",
            "FBID",
            "df_points_7d",
            "percentile",
        ],
        "sender": "Portal Dogfooding <portaldogfooding@fb.com>",
        "email_subject": "Portal Dogfooding Weekly Digest: You are doing great!({columns[hardware_type]})",
        "is_enabled": "FALSE",
        "create_task": "FALSE",
    },
    "generate_weekly_email_somewhat_engaged": {
        "cron_schedule": "0 16 * * 4",
        "email_message": """
            <html>
            <head>
            </head>
            <body>
            Hey {columns[first_name]}!<br/>
            <p>
            Our records show that you’ve been using your {columns[hardware_type]} ({columns[device_serial_number]}) a fair amount over the last week! Your engagement score for this week is {columns[df_points_7d]}, which puts you in the {columns[percentile]} percentile of dogfooders!
            <p>
            <p>
            To see a more detailed breakdown of your device usage, please see your <a href="https://fburl.com/unidash/zx492wbb">personalized dashboard</a>.
            <p><p>Engaging with your device doesn’t just help us improve Portal - it can earn you points to redeem for awesome swag! Learn more about our Dogfooding Swag Store <a href="https://fb.workplace.com/groups/1709552312652936/permalink/2958714477736707/">here.</a>
            <p>
            <b>Please keep in mind that these metrics do not account for WhatsApp usage.</b>
            <p>
            We appreciate your feedback and engagement, and encourage you to continue reporting bugs via Bugnub and posting about your experiences in the <a href="https://fb.workplace.com/groups/1959599607620319">Portal Feedback Workplace group</a>.
            <p>
            Best,<br/>
            The Portal Dogfooding Team
            </p>
            </body>
            </html>
            """,
        "query": """
            SELECT
                serial_number as device_serial_number,
                hardware_type,
                first_name,
                owner_fbid AS FBID,
                work_email AS email,
                device_online_l7,
                df_points_7d,
                percentile
            FROM (
                SELECT
                    serial_number,
                    hardware_type,
                    first_name,
                    owner_fbid,
                    work_email,
                    device_online_l7,
                    df_points_7d,
                    ROUND(
                        (
                            PERCENT_RANK() OVER(
                                PARTITION BY
                                    ds
                                ORDER BY
                                    df_points_7d DESC,
                                    device_online_l7 DESC
                            )
                        ) * 100,
                        2
                    ) AS percentile
                FROM (
                    SELECT
                        ds,
                        serial_number,
                        hardware_type,
                        first_name,
                        owner_fbid,
                        work_email,
                        device_online_l7,
                        ROUND(SUM(metric_value_7d)) AS df_points_7d
                    FROM (
                        SELECT
                            amt.ds,
                            serial_number,
                            amt.first_name,
                            hardware_type,
                            owner_fbid,
                            work_email
                        FROM dim_aloha_asset_management amt
                        JOIN d_employee_plus:hr hr
                            ON amt.owner_fbid = hr.personal_fbid
                        WHERE
                            amt.ds = '<LATEST_DS:dim_aloha_asset_management>'
                            AND hr.ds = '<LATEST_DS:d_employee_plus:hr>'
                            AND amt.df_flag = 1
                            AND amt.edf_flag <> 1
                            AND amt.owner_fbid > 0
                            AND amt.secondary_owner_fbid IS NULL
                            AND ota_channel IN (
                                'Portal OTA Alpha',
                                'Portal OTA Beta',
                                'Prod (Restricted)',
                                'Portal DF Prod Hotfix'
                            )
                            AND allocation_team IN('Dogfood')
                            AND NOT CONTAINS(asset_tags, 1420923608029097) --task created for returns
                            AND NOT CONTAINS(asset_tags, 138060473031027) --recalls
                    ) amt
                    LEFT JOIN (
                        SELECT
                            device_serial_number,
                            last_action_date AS device_online_last_action_date,
                            first_action_date AS device_online_first_action_date,
                            l1 AS device_online_l1,
                            l7 AS device_online_l7,
                            l28 AS device_online_l28
                        FROM aloha_heartbeat_datelist_slim
                        WHERE
                            ds = '<LATEST_DS:aloha_heartbeat_datelist_slim>'
                    ) online
                        ON amt.serial_number = online.device_serial_number
                    LEFT JOIN (
                        SELECT
                            device_serial_number,
                            CASE
                                WHEN last_action_date = ds THEN 1
                                ELSE 0
                            END AS active_device_l1,
                            l7 AS active_device_l7,
                            l28 AS active_device_l28
                        FROM aloha_active_devices_datelist
                        WHERE
                            ds = '<LATEST_DS:aloha_active_devices_datelist>'
                    ) active
                        ON amt.serial_number = active.device_serial_number
                    LEFT JOIN (
                        SELECT
                            device_serial_number,
                            metric_name,
                            metric_value_7d * 0.1 AS metric_value_7d,
                            metric_value_28d * 0.1 AS metric_value_28d
                        FROM aloha_media_core_metrics_datelist_extension
                        WHERE
                            ds = '<LATEST_DS:aloha_media_core_metrics_datelist_extension>'
                            AND build = 'overall'
                            AND build = 'overall'
                            AND metric_name IN (
                                'mic_drop_timespent_min:performance',
                                'photobooth_timespent_min (overall)',
                                'ar_effects_time_spent_min (overall)',
                                'storytime_time_spent_min (overall)',
                                'storytime_time_spent_min_local (overall)',
                                '3p_app_time_spent_min (overall)',
                                'audio_consumption (overall)',
                                'browser_time_spent_min',
                                'video_consumption (overall)'
                                        )
                            UNION ALL

                        SELECT
                            device_serial_number,
                            metric_name,
                            metric_value_7d * 0.1 AS metric_value_7d,
                            metric_value_28d * 0.1 AS metric_value_28d
                        FROM aloha_portal_for_work_core_metrics_datelist_extension
                        WHERE
                            ds = '<LATEST_DS:aloha_portal_for_work_core_metrics_datelist_extension>'
                            AND build = 'overall'
                            AND metric_name IN ('talk_time_onevc (overall)', 'talk_time_total (overall)', 'call_count_total (overall)')

                        UNION ALL

                        SELECT
                            device_serial_number,
                            metric_name,
                            metric_value_7d * 0.1 AS metric_value_7d,
                            metric_value_28d * 0.1 AS metric_value_28d
                        FROM aloha_calling_actors_core_metrics_datelist_extension
                        WHERE
                            ds = '<LATEST_DS:aloha_calling_actors_core_metrics_datelist_extension>'
                            AND build = 'overall'
                            AND metric_name IN ('talk_time (overall)')
                            AND metric_category IN ('talk_time (min)', 'call_count')

                        UNION ALL

                        SELECT
                            device_serial_number,
                            'camera_ar_time_spent_min (overall)' AS metric_name,
                            SUM(metric_value_7d) * 0.1 AS metric_value_7d,
                            SUM(metric_value_28d) * 0.1 AS metric_value_28d
                        FROM (
                            SELECT
                                device_serial_number,
                                metric_name,
                                metric_value_7d,
                                metric_value_28d
                            FROM aloha_camera_ar_experiences_core_metrics_datelist_extension
                            WHERE
                                ds = '<LATEST_DS:aloha_camera_ar_experiences_core_metrics_datelist_extension>'
                                AND build = 'overall'
                                AND metric_name IN (
                                    'mic_drop_timespent_min:performance',
                                    'photobooth_timespent_min (overall)',
                                    'ar_effects_time_spent_min (overall)',
                                    'storytime_time_spent_min (overall)',
                                    'storytime_time_spent_min_local (overall)'
                                )
                        )
                        GROUP BY
                            1, 2

                        UNION ALL

                        SELECT
                            device_serial_number,
                            CASE
                                WHEN metric_name = 'request_count (overall)' THEN 'assistant_count (overall)'
                            END AS metric_name,
                            metric_value_7d * 5 AS metric_value_7d,
                            metric_value_28d * 5 AS metric_value_28d
                        FROM aloha_assistant_core_metrics_datelist_extension
                        WHERE
                            ds = '<LATEST_DS:aloha_assistant_core_metrics_datelist_extension>'
                            AND build = 'overall'
                            AND metric_name = 'request_count (overall)'

                        UNION ALL

                        SELECT
                            bn7.device_serial AS device_serial_number,
                            'bug_reports' AS metric_name,
                            bug_reports_7d AS metric_value_7d,
                            bug_reports_28d AS metric_value_28d
                        FROM (
                            SELECT
                                device_serial,
                                COUNT(bug_id) * 10 AS bug_reports_7d
                            FROM aloha_flytrap bn
                            WHERE
                                ds BETWEEN '<DATEID-7>' AND '<DATEID>'
                            GROUP BY
                                1
                        ) bn7
                        LEFT JOIN (
                            SELECT
                                device_serial,
                                COUNT(bug_id) * 10 AS bug_reports_28d
                            FROM aloha_flytrap bn
                            WHERE
                                ds BETWEEN '<DATEID-27>' AND '<DATEID>'
                            GROUP BY
                                1
                        ) bn30
                            ON bn7.device_serial = bn30.device_serial

                        UNION ALL

                        SELECT
                            serial_number AS device_serial_number,
                            'surveys_completed' AS metric_name,
                            survey_complete_l7 * 10 AS metric_value_7d,
                            survey_complete_l28 * 10 AS metric_value_28d
                        FROM (
                            SELECT
                                serial_number,
                                owner_fbid
                            FROM dim_aloha_asset_management
                            WHERE
                                ds = '<DATEID>'
                        ) amt
                        LEFT JOIN (
                            SELECT
                                user_id,
                                APPROX_DISTINCT(survey_id) AS survey_complete_l7
                            FROM simon_responses_formatted_non_bucketed:growth a
                            JOIN cdb.user_surveys.simon_id_index b
                                ON a.survey_id = b.id
                            WHERE
                                a.ds BETWEEN '<DATEID-7>' AND '<DATEID>'
                                AND b.keyval = 'survey_by_tag'
                                AND b.value = 'portal_df_survey'
                            GROUP BY
                                1
                            ORDER BY
                                2 DESC
                        ) s7
                            ON amt.owner_fbid = s7.user_id
                        LEFT JOIN (
                            SELECT
                                user_id,
                                APPROX_DISTINCT(survey_id) AS survey_complete_l28
                            FROM simon_responses_formatted_non_bucketed:growth a
                            JOIN cdb.user_surveys.simon_id_index b
                                ON a.survey_id = b.id
                            WHERE
                                a.ds BETWEEN '<DATEID-28>' AND '<DATEID>'
                                AND b.keyval = 'survey_by_tag'
                                AND b.value = 'portal_df_survey'
                            GROUP BY
                                1
                            ORDER BY
                                2 DESC
                        ) s28
                            ON amt.owner_fbid = s28.user_id

                        UNION ALL

                        SELECT
                            serial_number AS device_serial_number,
                            'feedback_group_posts' AS metric_name,
                            (
                                COUNT_IF(
                                    FROM_UNIXTIME(post_event_time) > DATE_ADD('day', -7, CURRENT_DATE)
                                )
                            ) * 10 AS metric_value_7d,
                            (
                                COUNT_IF(
                                    FROM_UNIXTIME(post_event_time) > DATE_ADD('day', -28, CURRENT_DATE)
                                )
                            ) * 10 AS metric_value_28d
                        FROM portal_feedback_posts f
                        JOIN d_employee_plus:hr hr
                            ON f.poster_unixname = hr.unix_username
                        JOIN dim_aloha_asset_management amt
                            ON hr.personal_fbid = amt.owner_fbid
                        WHERE
                            f.ds = '<LATEST_DS:portal_feedback_posts>'
                            AND hr.ds = '<LATEST_DS:d_employee_plus:hr>'
                            AND amt.ds = '<LATEST_DS:dim_aloha_asset_management>'
                        GROUP BY
                            1, 2
                    ) metrics
                        ON amt.serial_number = metrics.device_serial_number
                    GROUP BY
                        1, 2, 3, 4, 5, 6, 7
                )
            )
            WHERE
                df_points_7d BETWEEN 16 AND 50
            """,
        "columns": [
            "device_serial_number",
            "hardware_type",
            "first_name",
            "email",
            "FBID",
            "df_points_7d",
            "percentile",
        ],
        "sender": "Portal Dogfooding <portaldogfooding@fb.com>",
        "email_subject": "Portal Dogfooding Weekly Digest: Keep it Up!({columns[hardware_type]})",
        "is_enabled": "FALSE",
        "create_task": "FALSE",
    },
    "generate_weekly_email_slightly_engaged": {
        "cron_schedule": "0 16 * * 4",
        "email_message": """
            <html>
            <head>
            </head>
            <body>Hey {columns[first_name]}!<br/>
            <p>Our records indicate that you've been slightly engaged with your {columns[hardware_type]} ({columns[device_serial_number]}) over the last week. Your engagement score is {columns[df_points_7d]}. Portal’s quality depends on continued feedback and engagement from our Dogfooders, including completion of surveys and filing bug reports. We hope to continue to hear from you!
            <p>To see a more detailed breakdown of your device usage, please see your <a href="https://fburl.com/unidash/zx492wbb">personalized dashboard</a>.
            <p>Engaging with your device doesn’t just help us improve Portal - it can earn you points to redeem for awesome swag! Learn more about our Dogfooding Swag Store <a href="https://fb.workplace.com/groups/1709552312652936/permalink/2958714477736707/">here.</a>
            <p>Please let us know if issues with your device prevent you from gaining the full Portal experience. <b>Keep in mind that these metrics do not account for WhatsApp usage.</b><p><i>If you feel this data is inaccurate, please let us know by replying to this email.</i><p>
            <p>We appreciate your input and encourage you to report bugs via Bugnub, complete surveys, and post about your experiences in the <a href="https://fb.workplace.com/groups/1959599607620319">Portal Feedback Workplace group</a>.
            <p>Best,<br/>The Portal Dogfooding Team
            </p>
            </body>
            </html>
            """,
        "query": """
            SELECT
                serial_number AS device_serial_number,
                hardware_type,
                first_name,
                owner_fbid AS FBID,
                work_email AS email,
                device_online_l7,
                df_points_7d,
                percentile
            FROM (
                SELECT
                    serial_number,
                    hardware_type,
                    first_name,
                    owner_fbid,
                    work_email,
                    device_online_l7,
                    df_points_7d,
                    ROUND(
                        (
                            PERCENT_RANK() OVER(
                                PARTITION BY
                                    ds
                                ORDER BY
                                    df_points_7d DESC,
                                    device_online_l7 DESC
                            )
                        ) * 100,
                        2
                    ) AS percentile
                FROM (
                    SELECT
                        ds,
                        serial_number,
                        hardware_type,
                        first_name,
                        owner_fbid,
                        work_email,
                        device_online_l7,
                        ROUND(SUM(metric_value_7d)) AS df_points_7d
                    FROM (
                        SELECT
                            amt.ds,
                            serial_number,
                            amt.first_name,
                            hardware_type,
                            owner_fbid,
                            work_email
                        FROM dim_aloha_asset_management amt
                        JOIN d_employee_plus:hr hr
                            ON amt.owner_fbid = hr.personal_fbid
                        WHERE
                            amt.ds = '<LATEST_DS:dim_aloha_asset_management>'
                            AND hr.ds = '<LATEST_DS:d_employee_plus:hr>'
                            AND amt.df_flag = 1
                            AND amt.edf_flag <> 1
                            AND amt.owner_fbid > 0
                            AND amt.secondary_owner_fbid IS NULL
                            AND ota_channel IN (
                                'Portal OTA Alpha',
                                'Portal OTA Beta',
                                'Prod (Restricted)',
                                'Portal DF Prod Hotfix'
                            )
                            AND allocation_team IN('Dogfood')
                            AND NOT CONTAINS(asset_tags, 1420923608029097) --task created for returns
                            AND NOT CONTAINS(asset_tags, 138060473031027) --recalls
                    ) amt
                    LEFT JOIN (
                        SELECT
                            device_serial_number,
                            last_action_date AS device_online_last_action_date,
                            first_action_date AS device_online_first_action_date,
                            l1 AS device_online_l1,
                            l7 AS device_online_l7,
                            l28 AS device_online_l28
                        FROM aloha_heartbeat_datelist_slim
                        WHERE
                            ds = '<LATEST_DS:aloha_heartbeat_datelist_slim>'
                    ) online
                        ON amt.serial_number = online.device_serial_number
                    LEFT JOIN (
                        SELECT
                            device_serial_number,
                            CASE
                                WHEN last_action_date = ds THEN 1
                                ELSE 0
                            END AS active_device_l1,
                            l7 AS active_device_l7,
                            l28 AS active_device_l28
                        FROM aloha_active_devices_datelist
                        WHERE
                            ds = '<LATEST_DS:aloha_active_devices_datelist>'
                    ) active
                        ON amt.serial_number = active.device_serial_number
                    LEFT JOIN (
                        SELECT
                            device_serial_number,
                            metric_name,
                            metric_value_7d * 0.1 AS metric_value_7d,
                            metric_value_28d * 0.1 AS metric_value_28d
                        FROM aloha_media_core_metrics_datelist_extension
                        WHERE
                            ds = '<LATEST_DS:aloha_media_core_metrics_datelist_extension>'
                            AND build = 'overall'
                            AND build = 'overall'
                            AND metric_name IN (
                                'mic_drop_timespent_min:performance',
                                'photobooth_timespent_min (overall)',
                                'ar_effects_time_spent_min (overall)',
                                'storytime_time_spent_min (overall)',
                                'storytime_time_spent_min_local (overall)',
                                '3p_app_time_spent_min (overall)',
                                'audio_consumption (overall)',
                                'browser_time_spent_min',
                                'video_consumption (overall)'
                                        )
                        UNION ALL

                        SELECT
                            device_serial_number,
                            metric_name,
                            metric_value_7d * 0.1 AS metric_value_7d,
                            metric_value_28d * 0.1 AS metric_value_28d
                        FROM aloha_portal_for_work_core_metrics_datelist_extension
                        WHERE
                            ds = '<LATEST_DS:aloha_portal_for_work_core_metrics_datelist_extension>'
                            AND build = 'overall'
                            AND metric_name IN ('talk_time_onevc (overall)', 'talk_time_total (overall)', 'call_count_total (overall)')

                        UNION ALL

                        SELECT
                            device_serial_number,
                            metric_name,
                            metric_value_7d * 0.1 AS metric_value_7d,
                            metric_value_28d * 0.1 AS metric_value_28d
                        FROM aloha_calling_actors_core_metrics_datelist_extension
                        WHERE
                            ds = '<LATEST_DS:aloha_calling_actors_core_metrics_datelist_extension>'
                            AND build = 'overall'
                            AND metric_name IN ('talk_time (overall)')
                            AND metric_category IN ('talk_time (min)', 'call_count')

                        UNION ALL

                        SELECT
                            device_serial_number,
                            'camera_ar_time_spent_min (overall)' AS metric_name,
                            SUM(metric_value_7d) * 0.1 AS metric_value_7d,
                            SUM(metric_value_28d) * 0.1 AS metric_value_28d
                        FROM (
                            SELECT
                                device_serial_number,
                                metric_name,
                                metric_value_7d,
                                metric_value_28d
                            FROM aloha_camera_ar_experiences_core_metrics_datelist_extension
                            WHERE
                                ds = '<LATEST_DS:aloha_camera_ar_experiences_core_metrics_datelist_extension>'
                                AND build = 'overall'
                                AND metric_name IN (
                                    'mic_drop_timespent_min:performance',
                                    'photobooth_timespent_min (overall)',
                                    'ar_effects_time_spent_min (overall)',
                                    'storytime_time_spent_min (overall)',
                                    'storytime_time_spent_min_local (overall)'
                                )
                        )
                        GROUP BY
                            1, 2

                        UNION ALL

                        SELECT
                            device_serial_number,
                            CASE
                                WHEN metric_name = 'request_count (overall)' THEN 'assistant_count (overall)'
                            END AS metric_name,
                            metric_value_7d * 5 AS metric_value_7d,
                            metric_value_28d * 5 AS metric_value_28d
                        FROM aloha_assistant_core_metrics_datelist_extension
                        WHERE
                            ds = '<LATEST_DS:aloha_assistant_core_metrics_datelist_extension>'
                            AND build = 'overall'
                            AND metric_name = 'request_count (overall)'

                        UNION ALL

                        SELECT
                            bn7.device_serial AS device_serial_number,
                            'bug_reports' AS metric_name,
                            bug_reports_7d AS metric_value_7d,
                            bug_reports_28d AS metric_value_28d
                        FROM (
                            SELECT
                                device_serial,
                                COUNT(bug_id) * 10 AS bug_reports_7d
                            FROM aloha_flytrap bn
                            WHERE
                                ds BETWEEN '<DATEID-7>' AND '<DATEID>'
                            GROUP BY
                                1
                        ) bn7
                        LEFT JOIN (
                            SELECT
                                device_serial,
                                COUNT(bug_id) * 10 AS bug_reports_28d
                            FROM aloha_flytrap bn
                            WHERE
                                ds BETWEEN '<DATEID-27>' AND '<DATEID>'
                            GROUP BY
                                1
                        ) bn30
                            ON bn7.device_serial = bn30.device_serial

                        UNION ALL

                        SELECT
                            serial_number AS device_serial_number,
                            'surveys_completed' AS metric_name,
                            survey_complete_l7 * 10 AS metric_value_7d,
                            survey_complete_l28 * 10 AS metric_value_28d
                        FROM (
                            SELECT
                                serial_number,
                                owner_fbid
                            FROM dim_aloha_asset_management
                            WHERE
                                ds = '<DATEID>'
                        ) amt
                        LEFT JOIN (
                            SELECT
                                user_id,
                                APPROX_DISTINCT(survey_id) AS survey_complete_l7
                            FROM simon_responses_formatted_non_bucketed:growth a
                            JOIN cdb.user_surveys.simon_id_index b
                                ON a.survey_id = b.id
                            WHERE
                                a.ds BETWEEN '<DATEID-7>' AND '<DATEID>'
                                AND b.keyval = 'survey_by_tag'
                                AND b.value = 'portal_df_survey'
                            GROUP BY
                                1
                            ORDER BY
                                2 DESC
                        ) s7
                            ON amt.owner_fbid = s7.user_id
                        LEFT JOIN (
                            SELECT
                                user_id,
                                APPROX_DISTINCT(survey_id) AS survey_complete_l28
                            FROM simon_responses_formatted_non_bucketed:growth a
                            JOIN cdb.user_surveys.simon_id_index b
                                ON a.survey_id = b.id
                            WHERE
                                a.ds BETWEEN '<DATEID-28>' AND '<DATEID>'
                                AND b.keyval = 'survey_by_tag'
                                AND b.value = 'portal_df_survey'
                            GROUP BY
                                1
                            ORDER BY
                                2 DESC
                        ) s28
                            ON amt.owner_fbid = s28.user_id

                        UNION ALL

                        SELECT
                            serial_number AS device_serial_number,
                            'feedback_group_posts' AS metric_name,
                            (
                                COUNT_IF(
                                    FROM_UNIXTIME(post_event_time) > DATE_ADD('day', -7, CURRENT_DATE)
                                )
                            ) * 10 AS metric_value_7d,
                            (
                                COUNT_IF(
                                    FROM_UNIXTIME(post_event_time) > DATE_ADD('day', -28, CURRENT_DATE)
                                )
                            ) * 10 AS metric_value_28d
                        FROM portal_feedback_posts f
                        JOIN d_employee_plus:hr hr
                            ON f.poster_unixname = hr.unix_username
                        JOIN dim_aloha_asset_management amt
                            ON hr.personal_fbid = amt.owner_fbid
                        WHERE
                            f.ds = '<LATEST_DS:portal_feedback_posts>'
                            AND hr.ds = '<LATEST_DS:d_employee_plus:hr>'
                            AND amt.ds = '<LATEST_DS:dim_aloha_asset_management>'
                        GROUP BY
                            1, 2
                    ) metrics
                        ON amt.serial_number = metrics.device_serial_number
                    GROUP BY
                        1, 2, 3, 4, 5, 6, 7
                )
            )
            WHERE
                df_points_7d BETWEEN 1 AND 15
            """,
        "columns": [
            "device_serial_number",
            "hardware_type",
            "first_name",
            "email",
            "FBID",
            "df_points_7d",
            "percentile",
        ],
        "sender": "Portal Dogfooding <portaldogfooding@fb.com>",
        "email_subject": "Portal Dogfooding Weekly Digest: Thanks for your feedback!({columns[hardware_type]}) ",
        "is_enabled": "FALSE",
        "create_task": "FALSE",
    },
    "generate_weekly_email_not_engaged": {
        "cron_schedule": "0 16 * * 4",
        "email_message": """
            <html>
            <head>
            </head>
            <body>
            Hey {columns[first_name]}!<br/>
            <p>
            We'd love to hear from you! We noticed that you haven't engaged with your {columns[hardware_type]} ({columns[device_serial_number]}) over the last week.
            <p>
           Your feedback is important to us! Please let us know if any issues prevent you from utilizing the full Portal experience, or if you are no longer interested in dogfooding.
            <p>
            <p>Engaging with your device doesn’t just help us improve Portal - it can earn you points to redeem for awesome swag! Learn more about our Dogfooding Swag Store <a href="https://fb.workplace.com/groups/1709552312652936/permalink/2958714477736707/">here.</a>
            <b>Please note that our metrics don't include WhatsApp usage.</b>
            <p>
            <i>
            If you feel this data is inaccurate, please let us know by replying to this email.</i>
            <p>
            We sincerely appreciate your input and encourage you to report bugs via Bugnub, complete surveys, and post about your experiences in the <a href="https://fb.workplace.com/groups/1959599607620319">Portal Feedback Workplace group</a>.
            <p>
            Best,<br/>
            The Portal Dogfooding Team
            </p>
            </body>
            </html>
            """,
        "query": """
            SELECT
                serial_number as device_serial_number,
                hardware_type,
                first_name,
                owner_fbid AS FBID,
                work_email AS email,
                device_online_l7,
                df_points_7d,
                percentile
            FROM (
                SELECT
                    serial_number,
                    hardware_type,
                    first_name,
                    owner_fbid,
                    work_email,
                    device_online_l7,
                    df_points_7d,
                    ROUND(
                        (
                            PERCENT_RANK() OVER(
                                PARTITION BY
                                    ds
                                ORDER BY
                                    df_points_7d DESC,
                                    device_online_l7 DESC
                            )
                        ) * 100,
                        2
                    ) AS percentile
                FROM (
                    SELECT
                        ds,
                        serial_number,
                        hardware_type,
                        first_name,
                        owner_fbid,
                        work_email,
                        device_online_l7,
                        ROUND(SUM(metric_value_7d)) AS df_points_7d
                    FROM (
                        SELECT
                            amt.ds,
                            serial_number,
                            amt.first_name,
                            hardware_type,
                            owner_fbid,
                            work_email
                        FROM dim_aloha_asset_management amt
                        JOIN d_employee_plus:hr hr
                            ON amt.owner_fbid = hr.personal_fbid
                        WHERE
                            amt.ds = '<LATEST_DS:dim_aloha_asset_management>'
                            AND hr.ds = '<LATEST_DS:d_employee_plus:hr>'
                            AND amt.df_flag = 1
                            AND amt.edf_flag <> 1
                            AND amt.owner_fbid > 0
                            AND date (SUBSTR(assigned_at_time, 1, 10)) < date('<DATEID-12>')
                            AND amt.secondary_owner_fbid IS NULL
                            AND ota_channel IN (
                                'Portal OTA Alpha',
                                'Portal OTA Beta',
                                'Prod (Restricted)',
                                'Portal DF Prod Hotfix'
                            )
                            AND allocation_team IN('Dogfood')
                            AND NOT CONTAINS(asset_tags, 1420923608029097) --task created for returns
                            AND NOT CONTAINS(asset_tags, 138060473031027) --recalls
                    ) amt
                    LEFT JOIN (
                        SELECT
                            device_serial_number,
                            last_action_date AS device_online_last_action_date,
                            first_action_date AS device_online_first_action_date,
                            l1 AS device_online_l1,
                            l7 AS device_online_l7,
                            l28 AS device_online_l28
                        FROM aloha_heartbeat_datelist_slim
                        WHERE
                            ds = '<LATEST_DS:aloha_heartbeat_datelist_slim>'
                    ) online
                        ON amt.serial_number = online.device_serial_number
                    LEFT JOIN (
                        SELECT
                            device_serial_number,
                            CASE
                                WHEN last_action_date = ds THEN 1
                                ELSE 0
                            END AS active_device_l1,
                            l7 AS active_device_l7,
                            l28 AS active_device_l28
                        FROM aloha_active_devices_datelist
                        WHERE
                            ds = '<LATEST_DS:aloha_active_devices_datelist>'
                    ) active
                        ON amt.serial_number = active.device_serial_number
                    LEFT JOIN (
                        SELECT
                            device_serial_number,
                            metric_name,
                            metric_value_7d * 0.1 AS metric_value_7d,
                            metric_value_28d * 0.1 AS metric_value_28d
                        FROM aloha_media_core_metrics_datelist_extension
                        WHERE
                            ds = '<LATEST_DS:aloha_media_core_metrics_datelist_extension>'
                            AND build = 'overall'
                            AND build = 'overall'
                            AND metric_name IN (
                                'mic_drop_timespent_min:performance',
                                'photobooth_timespent_min (overall)',
                                'ar_effects_time_spent_min (overall)',
                                'storytime_time_spent_min (overall)',
                                'storytime_time_spent_min_local (overall)',
                                '3p_app_time_spent_min (overall)',
                                'audio_consumption (overall)',
                                'browser_time_spent_min',
                                'video_consumption (overall)'
                                        )
                        UNION ALL

                        SELECT
                            device_serial_number,
                            metric_name,
                            metric_value_7d * 0.1 AS metric_value_7d,
                            metric_value_28d * 0.1 AS metric_value_28d
                        FROM aloha_portal_for_work_core_metrics_datelist_extension
                        WHERE
                            ds = '<LATEST_DS:aloha_portal_for_work_core_metrics_datelist_extension>'
                            AND build = 'overall'
                            AND metric_name IN ('talk_time_onevc (overall)', 'talk_time_total (overall)', 'call_count_total (overall)')

                        UNION ALL

                        SELECT
                            device_serial_number,
                            metric_name,
                            metric_value_7d * 0.1 AS metric_value_7d,
                            metric_value_28d * 0.1 AS metric_value_28d
                        FROM aloha_calling_actors_core_metrics_datelist_extension
                        WHERE
                            ds = '<LATEST_DS:aloha_calling_actors_core_metrics_datelist_extension>'
                            AND build = 'overall'
                            AND metric_name IN ('talk_time (overall)')
                            AND metric_category IN ('talk_time (min)', 'call_count')

                        UNION ALL

                        SELECT
                            device_serial_number,
                            'camera_ar_time_spent_min (overall)' AS metric_name,
                            SUM(metric_value_7d) * 0.1 AS metric_value_7d,
                            SUM(metric_value_28d) * 0.1 AS metric_value_28d
                        FROM (
                            SELECT
                                device_serial_number,
                                metric_name,
                                metric_value_7d,
                                metric_value_28d
                            FROM aloha_camera_ar_experiences_core_metrics_datelist_extension
                            WHERE
                                ds = '<LATEST_DS:aloha_camera_ar_experiences_core_metrics_datelist_extension>'
                                AND build = 'overall'
                                AND metric_name IN (
                                    'mic_drop_timespent_min:performance',
                                    'photobooth_timespent_min (overall)',
                                    'ar_effects_time_spent_min (overall)',
                                    'storytime_time_spent_min (overall)',
                                    'storytime_time_spent_min_local (overall)'
                                )
                        )
                        GROUP BY
                            1, 2

                        UNION ALL

                        SELECT
                            device_serial_number,
                            CASE
                                WHEN metric_name = 'request_count (overall)' THEN 'assistant_count (overall)'
                            END AS metric_name,
                            metric_value_7d * 5 AS metric_value_7d,
                            metric_value_28d * 5 AS metric_value_28d
                        FROM aloha_assistant_core_metrics_datelist_extension
                        WHERE
                            ds = '<LATEST_DS:aloha_assistant_core_metrics_datelist_extension>'
                            AND build = 'overall'
                            AND metric_name = 'request_count (overall)'

                        UNION ALL

                        SELECT
                            bn7.device_serial AS device_serial_number,
                            'bug_reports' AS metric_name,
                            bug_reports_7d AS metric_value_7d,
                            bug_reports_28d AS metric_value_28d
                        FROM (
                            SELECT
                                device_serial,
                                COUNT(bug_id) * 10 AS bug_reports_7d
                            FROM aloha_flytrap bn
                            WHERE
                                ds BETWEEN '<DATEID-7>' AND '<DATEID>'
                            GROUP BY
                                1
                        ) bn7
                        LEFT JOIN (
                            SELECT
                                device_serial,
                                COUNT(bug_id) * 10 AS bug_reports_28d
                            FROM aloha_flytrap bn
                            WHERE
                                ds BETWEEN '<DATEID-27>' AND '<DATEID>'
                            GROUP BY
                                1
                        ) bn30
                            ON bn7.device_serial = bn30.device_serial

                        UNION ALL

                        SELECT
                            serial_number AS device_serial_number,
                            'surveys_completed' AS metric_name,
                            survey_complete_l7 * 10 AS metric_value_7d,
                            survey_complete_l28 * 10 AS metric_value_28d
                        FROM (
                            SELECT
                                serial_number,
                                owner_fbid
                            FROM dim_aloha_asset_management
                            WHERE
                                ds = '<DATEID>'
                        ) amt
                        LEFT JOIN (
                            SELECT
                                user_id,
                                APPROX_DISTINCT(survey_id) AS survey_complete_l7
                            FROM simon_responses_formatted_non_bucketed:growth a
                            JOIN cdb.user_surveys.simon_id_index b
                                ON a.survey_id = b.id
                            WHERE
                                a.ds BETWEEN '<DATEID-7>' AND '<DATEID>'
                                AND b.keyval = 'survey_by_tag'
                                AND b.value = 'portal_df_survey'
                            GROUP BY
                                1
                            ORDER BY
                                2 DESC
                        ) s7
                            ON amt.owner_fbid = s7.user_id
                        LEFT JOIN (
                            SELECT
                                user_id,
                                APPROX_DISTINCT(survey_id) AS survey_complete_l28
                            FROM simon_responses_formatted_non_bucketed:growth a
                            JOIN cdb.user_surveys.simon_id_index b
                                ON a.survey_id = b.id
                            WHERE
                                a.ds BETWEEN '<DATEID-28>' AND '<DATEID>'
                                AND b.keyval = 'survey_by_tag'
                                AND b.value = 'portal_df_survey'
                            GROUP BY
                                1
                            ORDER BY
                                2 DESC
                        ) s28
                            ON amt.owner_fbid = s28.user_id

                        UNION ALL

                        SELECT
                            serial_number AS device_serial_number,
                            'feedback_group_posts' AS metric_name,
                            (
                                COUNT_IF(
                                    FROM_UNIXTIME(post_event_time) > DATE_ADD('day', -7, CURRENT_DATE)
                                )
                            ) * 10 AS metric_value_7d,
                            (
                                COUNT_IF(
                                    FROM_UNIXTIME(post_event_time) > DATE_ADD('day', -28, CURRENT_DATE)
                                )
                            ) * 10 AS metric_value_28d
                        FROM portal_feedback_posts f
                        JOIN d_employee_plus:hr hr
                            ON f.poster_unixname = hr.unix_username
                        JOIN dim_aloha_asset_management amt
                            ON hr.personal_fbid = amt.owner_fbid
                        WHERE
                            f.ds = '<LATEST_DS:portal_feedback_posts>'
                            AND hr.ds = '<LATEST_DS:d_employee_plus:hr>'
                            AND amt.ds = '<LATEST_DS:dim_aloha_asset_management>'
                        GROUP BY
                            1, 2
                    ) metrics
                        ON amt.serial_number = metrics.device_serial_number
                    GROUP BY
                        1, 2, 3, 4, 5, 6, 7
                )
            )
            WHERE
                df_points_7d = 0
                OR df_points_7d IS NULL
            """,
        "columns": [
            "device_serial_number",
            "hardware_type",
            "first_name",
            "email",
            "FBID",
            "df_points_7d",
            "percentile",
        ],
        "sender": "Portal Dogfooding <portaldogfooding@fb.com>",
        "email_subject": "Portal Dogfooding Weekly Digest: We haven’t heard from you!({columns[hardware_type]})",
        "is_enabled": "FALSE",
        "create_task": "FALSE",
    },
    "generate_portal_df_survey_luma_core_aug15": {
        "cron_schedule": "0 10 * * 1",
        "email_message": """
            <html><head></head>
            <body>
            <br><table style="width:50%" align="center">
              <tbody><tr>
                <th colspan="3"><h1 style="font-family:arial;font-weight:normal">Thank you for Dogfooding {columns[device_type]}!</h1></th>
              </tr>
                <tr>
                <th colspan="3"><h2 style="font-family:arial;font-weight:normal">Hello {columns[first_name]}</h2></th>
                </tr>
                <tr><th colspan="2"><p style="font-family:arial;font-weight:normal">It's that time of the month! We would love to hear from you about your experience with <b>Portal's core software</b>!</p><br></th>
                </tr><tr>
                <th colspan="2"><p style="font-family:arial;font-weight:normal">Please take a few moments to complete this survey on the <b>quality of Portal's core software</b> by EOD Wednesday, 8/17 &#9200. Core surveys help us track Portal’s health over time, and your feedback is critical! Click the button below to begin the survey.</p></th>
              </tr>
                <tr><td></td>
                <td><br><p style="text-align:center;"> <a href="https://www.facebook.com/survey/?oid=3286756344904672"> <img src="https://i.imgur.com/riIgnG1.png" width="245" height="80"> </a></p><br></td>
                <td></td>
              </tr>
               <tr>
                <th colspan="3"><p style="font-family:arial;font-weight:normal">Responding to Dogfooding surveys now earns you engagement points which you can redeem for awesome items in the Swag Store! Complete this survey, create a Swag Store account, <a href="https://portal.mypropago.com"> visit this link</a>, and check out the awesome items you can earn just by Dogfooding Portal! For more information about the Swag Store, <a href="https://www.internalfb.com/intern/wiki/Portal/Portal_Dogfooding/Dogfooding/Swag_Store/"> check out the wiki</a>!<br></p></th>
              </tr>
               <tr>
               <th colspan="3"><p style="font-family:arial;font-weight:normal"><b><br>Issues with Portal?</b><br>If you have problems with your Portal {columns[device_serial_number]}, or have any questions/comments, please post in <a href="https://fb.workplace.com/groups/1959599607620319">the Portal Feedback group</a>.</p></th>
               </tr>
               <tr>
               </tr>
               <tr>
               <th colspan="3"><p align="left" style="font-family:arial;font-weight:normal"><br>Best regards,<br>The Portal Dogfooding Survey Team</p></th>
            </tr></tbody></table>
            </body></html>
            """,
        "query": """
            WITH df AS (
        SELECT
            MAX(a.serial_number) AS device_serial_number,
            CASE 
            WHEN a.hardware_type = 'aloha'
            THEN 'Aloha'
            WHEN a.hardware_type = 'ohana'
            THEN 'Ohana'
            WHEN a.hardware_type = 'omni'
            THEN 'Omni'
            WHEN a.hardware_type = 'atlas'
            THEN 'Atlas'
            WHEN a.hardware_type = 'catalina'
            THEN 'Catalina'
            WHEN a.hardware_type = 'tate'
            THEN 'Tate'
            WHEN a.hardware_type = 'luma'
            THEN 'Luma'
            WHEN a.hardware_type IS NULL
            THEN 'Aloha'
            ELSE a.hardware_type
            END AS device_type,
            a.first_name,
            a.owner_fbid AS FBID,
            a.first_setup_time,
            a.hardware_build,
            a.allocation_team
        FROM dim_aloha_asset_management a
        JOIN dim_aloha_devices b on a.serial_number = b.device_serial_number
        WHERE
            a.ds = '<LATEST_DS:dim_aloha_asset_management>'
            AND b.ds = '<LATEST_DS:dim_aloha_devices>'
            AND a.secondary_owner_fbid IS NULL
            AND a.df_flag = 1
            AND a.edf_flag = 0
            AND a.hardware_type in ('luma')
            --AND b.active_device_l28 > 0
            AND a.ota_channel in ('Portal Beta Canary','Portal OTA Beta') 
            OR a.owner_fbid in (1659697886,1599726643,1639302470,515420376,671368390)
            AND a.owner_fbid NOT IN (567957396, 627847099)
            AND a.owner_fbid NOT IN (4)
            AND a.state in ('ASSIGNED')
        GROUP BY
          2, 3, 4, 5, 6, 7
        ),

df2 as (
    SELECT 
        FBID, 
        first_name AS first_name, 
        MAX(device_serial_number) as device_serial_number, 
        MAX(first_setup_time) AS first_setup_time,
        MAX(device_type) AS device_type,
        MAX(allocation_team) AS allocation_team
    FROM df
    GROUP BY 1,2),

df3 as (
    SELECT FBID, first_name, device_serial_number, device_type
    FROM df2
    WHERE allocation_team in ('Dogfood')
),

df4 as (
SELECT 
    df3.*,
    hr.work_email AS email
FROM df3
LEFT JOIN d_employee_plus:hr hr
ON df3.FBID = hr.personal_fbid
WHERE
ds = '<LATEST_DS:d_employee_plus:hr>'
AND termination_date IS NULL
AND work_email NOT IN (
    'mz@fb.com', 'shigongliu@fb.com','markriseley@fb.com','rfeliu@fb.com','opuada@fb.com','klur@fb.com','gegbo@fb.com','alonrz@fb.com','bdahi@fb.com','afinkelstein@fb.com','euanair@fb.com','akramer@fb.com','staceyr@fb.com','szhuk@fb.com','masa@fb.com','huirongyang@fb.com','harshkang@fb.com','ayy@fb.com','brandiwolff@fb.com','kfischer@fb.com','kendrad@fb.com','weizeng@fb.com','tjloving@fb.com','amyhayes@fb.com','kichoi@fb.com','cravennn@fb.com','bbennett@fb.com','noambe@fb.com'))

SELECT * FROM df4
    """,
        "columns": [
            "device_serial_number",
            "device_type",
            "first_name",
            "email",
            "FBID",
        ],
        "sender": "The Portal Dogfood Survey Team <portaldogfoodingsurvey@fb.com>",
        "email_subject": "Luma Core Survey August 2022 - Please Complete by EOD Wednesday, 8/17",
        "is_enabled": "FALSE",
        "create_task": "FALSE",
    },
    "generate_portal_df_survey_Luma_Core_survey_august_reminder_aug16": {
        "cron_schedule": "0 10 * * 2",
        "email_message": """
            <html><head></head>
            <body>
            <br><table style="width:50%" align="center">
              <tbody><tr>
                <th colspan="3"><h1 style="font-family:arial;font-weight:normal">Thank you for Dogfooding {columns[device_type]}!</h1></th>
              </tr>
                <tr>
                <th colspan="3"><h2 style="font-family:arial;font-weight:normal">Hello {columns[first_name]}</h2></th>
                </tr>
                <tr><th colspan="2"><p style="font-family:arial;font-weight:normal">This is a friendly reminder to please complete the <b>Portal core software survey</b>.</p><br></th>
                </tr><tr>
                <th colspan="2"><p style="font-family:arial;font-weight:normal">Core surveys help us track Portal’s health over time, and your feedback is critical! Please complete the survey by EOD tomorrow. Click the button below to begin the survey; if you already completed the survey this morning, kindly disregard this message.</p></th>
              </tr>
                <tr><td></td>
                <td><br><p style="text-align:center;"> <a href="https://www.facebook.com/survey/?oid=3286756344904672"> <img src="https://i.imgur.com/riIgnG1.png" width="245" height="80"> </a></p><br></td>
                <td></td>
              </tr>
               <tr>
                <th colspan="3"><p style="font-family:arial;font-weight:normal">Responding to Dogfooding surveys now earns you engagement points which you can redeem for awesome items in the Swag Store! Complete this survey, create a Swag Store account, <a href="https://portal.mypropago.com"> visit this link</a>, and check out the awesome items you can earn just by Dogfooding Portal! For more information about the Swag Store, <a href="https://www.internalfb.com/intern/wiki/Portal/Portal_Dogfooding/Dogfooding/Swag_Store/"> check out the wiki</a>!<br></p></th>
              </tr>
               <tr>
               <th colspan="3"><p style="font-family:arial;font-weight:normal"><b><br>Issues with Portal?</b><br>If you have problems with your Portal {columns[device_serial_number]}, or have any questions/comments, please post in <a href="https://fb.workplace.com/groups/1959599607620319">the Portal Feedback group</a>.</p></th>
               </tr>
               <tr>
               </tr>
               <tr>
               <th colspan="3"><p align="left" style="font-family:arial;font-weight:normal"><br>Best regards,<br>The Portal Dogfooding Survey Team</p></th>
            </tr></tbody></table>
            </body></html>
            """,
        "query": """
WITH q1 AS (
    SELECT
            MAX(a.device_serial_number) AS device_serial_number,
            b.hardware_type AS device_type,
            a.FBID,
            a.recipients AS email
        FROM aloha_dogfooding_email_recipients a
        JOIN dim_aloha_asset_management b on b.serial_number = a.device_serial_number
        WHERE
            a.ds = '2022-08-15' -- updated
            AND a.category_name like '%luma_core_aug15%' -- updated
        GROUP BY 2, 3, 4
    ),

q2 AS (
    SELECT
            preferred_first_name AS first_name,
            preferred_last_name,
            unix_username,
            work_email,
            personal_fbid
        FROM d_employee_plus:hr
        WHERE
            ds = '<LATEST_DS:d_employee_plus:hr>'
            AND is_active = TRUE
    ),

q3 AS (
    SELECT
        q1.FBID,
        q1.device_serial_number,
        CASE 
            WHEN q1.device_type = 'aloha'
            THEN 'Aloha'
            WHEN q1.device_type = 'ohana'
            THEN 'Ohana'
            WHEN q1.device_type = 'omni'
            THEN 'Omni'
            WHEN q1.device_type = 'atlas'
            THEN 'Atlas'
            WHEN q1.device_type = 'catalina'
            THEN 'Catalina'
            WHEN q1.device_type = 'tate'
            THEN 'Tate'
            WHEN q1.device_type = 'luma'
            THEN 'Luma'
            WHEN q1.device_type IS NULL
            THEN 'Aloha'
            ELSE q1.device_type
            END AS device_type,
        q2.first_name,
        q1.email
    from q1
    left join q2
    on q1.FBID = q2.personal_fbid
)

SELECT FBID, device_serial_number, device_type, first_name, email from q3
LEFT JOIN (
    SELECT
        *
    FROM simon_responses_formatted:growth
    WHERE
        survey_id = 3286756344904672 -- updated
        AND ds > '<DATEID-6>'
) complete
    ON q3.FBID = complete.user_id
WHERE
    complete.user_id IS NULL
        """,
        "columns": ["device_serial_number", "device_type", "FBID", "first_name", "email"],
        "sender": "The Portal Dogfood Survey Team <portaldogfoodingsurvey@fb.com>",
        "email_subject": "*REMINDER*: Please complete the August 2022 Luma Core Survey by EOD Tomorrow",
        "is_enabled": "FALSE",
        "create_task": "FALSE",
    },
    "generate_portal_df_survey_Luma_Core_survey_august_reminder_aug17": {
        "cron_schedule": "0 10 * * 3",
        "email_message": """
            <html><head></head>
            <body>
            <br><table style="width:50%" align="center">
              <tbody><tr>
                <th colspan="3"><h1 style="font-family:arial;font-weight:normal">Thank you for Dogfooding {columns[device_type]}!</h1></th>
              </tr>
                <tr>
                <th colspan="3"><h2 style="font-family:arial;font-weight:normal">Hello {columns[first_name]}</h2></th>
                </tr>
                <tr><th colspan="2"><p style="font-family:arial;font-weight:normal">This is a friendly reminder to please complete the <b>Portal core software survey</b>.</p><br></th>
                </tr><tr>
                <th colspan="2"><p style="font-family:arial;font-weight:normal">Core surveys help us track Portal’s health over time, and your feedback is critical! Please complete the survey by EOD today. Click the button below to begin the survey; if you already completed the survey this morning, kindly disregard this message.</p></th>
              </tr>
                <tr><td></td>
                <td><br><p style="text-align:center;"> <a href="https://www.facebook.com/survey/?oid=3286756344904672"> <img src="https://i.imgur.com/riIgnG1.png" width="245" height="80"> </a></p><br></td>
                <td></td>
              </tr>
               <tr>
                <th colspan="3"><p style="font-family:arial;font-weight:normal">Responding to Dogfooding surveys now earns you engagement points which you can redeem for awesome items in the Swag Store! Complete this survey, create a Swag Store account, <a href="https://portal.mypropago.com"> visit this link</a>, and check out the awesome items you can earn just by Dogfooding Portal! For more information about the Swag Store, <a href="https://www.internalfb.com/intern/wiki/Portal/Portal_Dogfooding/Dogfooding/Swag_Store/"> check out the wiki</a>!<br></p></th>
              </tr>
               <tr>
               <th colspan="3"><p style="font-family:arial;font-weight:normal"><b><br>Issues with Portal?</b><br>If you have problems with your Portal {columns[device_serial_number]}, or have any questions/comments, please post in <a href="https://fb.workplace.com/groups/1959599607620319">the Portal Feedback group</a>.</p></th>
               </tr>
               <tr>
               </tr>
               <tr>
               <th colspan="3"><p align="left" style="font-family:arial;font-weight:normal"><br>Best regards,<br>The Portal Dogfooding Survey Team</p></th>
            </tr></tbody></table>
            </body></html>
            """,
        "query": """
WITH q1 AS (
    SELECT
            MAX(a.device_serial_number) AS device_serial_number,
            b.hardware_type AS device_type,
            a.FBID,
            a.recipients AS email
        FROM aloha_dogfooding_email_recipients a
        JOIN dim_aloha_asset_management b on b.serial_number = a.device_serial_number
        WHERE
            a.ds = '2022-08-15' -- updated
            AND a.category_name like '%luma_core_aug15%' -- updated
        GROUP BY 2, 3, 4
    ),

q2 AS (
    SELECT
            preferred_first_name AS first_name,
            preferred_last_name,
            unix_username,
            work_email,
            personal_fbid
        FROM d_employee_plus:hr
        WHERE
            ds = '<LATEST_DS:d_employee_plus:hr>'
            AND is_active = TRUE
    ),

q3 AS (
    SELECT
        q1.FBID,
        q1.device_serial_number,
        CASE 
            WHEN q1.device_type = 'aloha'
            THEN 'Aloha'
            WHEN q1.device_type = 'ohana'
            THEN 'Ohana'
            WHEN q1.device_type = 'omni'
            THEN 'Omni'
            WHEN q1.device_type = 'atlas'
            THEN 'Atlas'
            WHEN q1.device_type = 'catalina'
            THEN 'Catalina'
            WHEN q1.device_type = 'tate'
            THEN 'Tate'
            WHEN q1.device_type = 'luma'
            THEN 'Luma'
            WHEN q1.device_type IS NULL
            THEN 'Aloha'
            ELSE q1.device_type
            END AS device_type,
        q2.first_name,
        q1.email
    from q1
    left join q2
    on q1.FBID = q2.personal_fbid
)

SELECT FBID, device_serial_number, device_type, first_name, email from q3
LEFT JOIN (
    SELECT
        *
    FROM simon_responses_formatted:growth
    WHERE
        survey_id = 3286756344904672 -- updated
        AND ds > '<DATEID-6>'
) complete
    ON q3.FBID = complete.user_id
WHERE
    complete.user_id IS NULL
        """,
        "columns": ["device_serial_number", "device_type", "FBID", "first_name", "email"],
        "sender": "The Portal Dogfood Survey Team <portaldogfoodingsurvey@fb.com>",
        "email_subject": "*FINAL REMINDER*: Please complete the August 2022 Luma Core Survey by EOD Today",
        "is_enabled": "FALSE",
        "create_task": "FALSE",
    },
    
    "generate_portal_df_survey_Arches_Core_aug24": {
        "cron_schedule": "0 10 * * 3",
        "email_message": """
            <html><head></head>
            <body>
            <br><table style="width:50%" align="center">
              <tbody><tr>
                <th colspan="3"><h1 style="font-family:arial;font-weight:normal">Thank you for Dogfooding Arches!</h1></th>
              </tr>
                <tr>
                <th colspan="3"><h2 style="font-family:arial;font-weight:normal">Hello {columns[first_name]}</h2></th>
                </tr>
                <tr><th colspan="2"><p style="font-family:arial;font-weight:normal">We would love to hear from you about your experience with <b>Portal's core software</b>!</p><br></th>
                </tr><tr>
                <th colspan="2"><p style="font-family:arial;font-weight:normal">Please take a few moments to complete this survey on the <b>quality of Portal's core software</b>&#9200. Core surveys help us track Portal’s health over time, and your feedback is critical! Click the button below to begin the survey.</p></th>
              </tr>
                <tr><td></td>
                <td><br><p style="text-align:center;"> <a href="https://www.facebook.com/survey/?oid=515733866943967"> <img src="https://i.imgur.com/riIgnG1.png" width="245" height="80"> </a></p><br></td>
                <td></td>
              </tr>
               <tr>
                <th colspan="3"><p style="font-family:arial;font-weight:normal">Responding to Dogfooding surveys now earns you engagement points which you can redeem for awesome items in the Swag Store! Complete this survey, create a Swag Store account, <a href="https://portal.mypropago.com"> visit this link</a>, and check out the awesome items you can earn just by Dogfooding Portal! For more information about the Swag Store, <a href="https://www.internalfb.com/intern/wiki/Portal/Portal_Dogfooding/Dogfooding/Swag_Store/"> check out the wiki</a>!<br></p></th>
              </tr>
               <tr>
               <th colspan="3"><p style="font-family:arial;font-weight:normal"><b><br>Issues with Portal?</b><br>If you have problems with your Portal {columns[device_serial_number]}, or have any questions/comments, please post in <a href="https://fb.workplace.com/groups/1959599607620319">the Portal Feedback group</a>.</p></th>
               </tr>
               <tr>
               </tr>
               <tr>
               <th colspan="3"><p align="left" style="font-family:arial;font-weight:normal"><br>Best regards,<br>The Portal Dogfooding Survey Team</p></th>
            </tr></tbody></table>
            </body></html>
            """,
        "query": """
            WITH df AS (
        SELECT
            MAX(a.serial_number) AS device_serial_number, -- The CASE WHEN statement here makes device aliases capitalized so that the email text looks good in the header
            CASE 
            WHEN a.hardware_type = 'aloha'
            THEN 'Aloha'
            WHEN a.hardware_type = 'ohana'
            THEN 'Ohana'
            WHEN a.hardware_type = 'omni'
            THEN 'Omni'
            WHEN a.hardware_type = 'atlas'
            THEN 'Atlas'
            WHEN a.hardware_type = 'catalina'
            THEN 'Catalina'
            WHEN a.hardware_type = 'tate'
            THEN 'Tate'
            WHEN a.hardware_type = 'luma'
            THEN 'Luma'
            WHEN a.hardware_type IS NULL -- this is the only non-cosmetic part of the CASE WHEN and should be retained always. Some Alohas have no device_type value in the db, and NULLS can mess up the config
            THEN 'Aloha'
            ELSE a.hardware_type
            END AS device_type,
            a.first_name,
            a.owner_fbid AS FBID, -- Alias as FBID in order to match with Columns specified in Config
            a.first_setup_time,
            a.hardware_build,
            a.allocation_team
        FROM dim_aloha_asset_management a
        JOIN dim_aloha_devices b on a.serial_number = b.device_serial_number
        WHERE
            a.ds = '<LATEST_DS:dim_aloha_asset_management>'
            AND b.ds = '<LATEST_DS:dim_aloha_devices>'
            AND a.secondary_owner_fbid IS NULL
            AND a.df_flag = 1
            AND a.edf_flag = 0
            AND a.hardware_type ='luma' -- device types you want to include in the distribution
            --AND b.active_device_l28 > 0 -- usually this line will stay commented out for distribution. I use this to check what the denom should be for the active response rate in Task Log.
            AND a.ota_channel='Portal Beta Canary' -- Channels you want to include in distribution. Be sure everything is spelled right & formatted correctly here, some channels include a space in front of the name.
            AND a.comment LIKE '%6GB%'
            OR a.owner_fbid in (1659697886,1639302470,671368390,6410940) -- These are Saurabh Bhandari, Trip, Anju, and Joe Sena's FBIDs. Check and see if Saurabh still wants to receive surveys and whether Joe wants to be included.
            AND a.owner_fbid NOT IN (567957396, 627847099) 
            AND a.owner_fbid NOT IN (4) -- MZ
            AND a.state in ('ASSIGNED')
        GROUP BY
          2, 3, 4, 5, 6, 7
        ),

df2 as ( -- This subquery deduplicates any users that may have multiple devices / different channel allocations.
    SELECT 
        FBID, -- note how FBID passes through from df, so no further aliasing is required
        first_name AS first_name, 
        MAX(device_serial_number) as device_serial_number, 
        MAX(first_setup_time) AS first_setup_time,
        MAX(device_type) AS device_type,
        MAX(allocation_team) AS allocation_team
    FROM df
    GROUP BY 1,2),

df3 as ( -- this subquery further filters devices down to those allocated to Dogfooding. 
    SELECT FBID, first_name, device_serial_number, device_type
    FROM df2
    WHERE allocation_team in ('Dogfood') -- This is a failsafe on the df_flag = 1 condition from the subquery df 
),

df4 as ( -- this subquery adds in user emails and makes sure we aren't surveying 
SELECT 
    df3.*,
    hr.work_email AS email
FROM df3
LEFT JOIN d_employee_plus:hr hr
ON df3.FBID = hr.personal_fbid
WHERE
ds = '<LATEST_DS:d_employee_plus:hr>'
AND termination_date IS NULL
AND work_email NOT IN (
    'mz@fb.com', 'shigongliu@fb.com','markriseley@fb.com','rfeliu@fb.com','opuada@fb.com','klur@fb.com','gegbo@fb.com','alonrz@fb.com','bdahi@fb.com','afinkelstein@fb.com','euanair@fb.com','akramer@fb.com','staceyr@fb.com','szhuk@fb.com','masa@fb.com','huirongyang@fb.com','harshkang@fb.com','ayy@fb.com','brandiwolff@fb.com','kfischer@fb.com','kendrad@fb.com','weizeng@fb.com','tjloving@fb.com','amyhayes@fb.com','kichoi@fb.com','cravennn@fb.com','bbennett@fb.com','noambe@fb.com'))

SELECT * FROM df4
    """,
        "columns": [
            "device_serial_number",
            "device_type",
            "first_name",
            "email",
            "FBID",
        ],
        "sender": "The Portal Dogfood Survey Team <portaldogfoodingsurvey@fb.com>",
        "email_subject": "Arches Core Survey August 2022",
        "is_enabled": "FALSE",
        "create_task": "FALSE",
    },
    "generate_portal_df_survey_Arches_Core_survey_reminder_aug25": {
        "cron_schedule": "0 10 * * 4",
        "email_message": """
            <html><head></head>
            <body>
            <br><table style="width:50%" align="center">
              <tbody><tr>
                <th colspan="3"><h1 style="font-family:arial;font-weight:normal">Thank you for Dogfooding Arches!</h1></th>
              </tr>
                <tr>
                <th colspan="3"><h2 style="font-family:arial;font-weight:normal">Hello {columns[first_name]}</h2></th>
                </tr>
                <tr><th colspan="2"><p style="font-family:arial;font-weight:normal">This is a friendly reminder to please complete the <b>Portal core software survey</b>.</p><br></th>
                </tr><tr>
                <th colspan="2"><p style="font-family:arial;font-weight:normal">Core surveys help us track Portal’s health over time, and your feedback is critical! Please help us by completing the survey. Click the button below to begin the survey; if you already completed the survey this morning, kindly disregard this message.</p></th>
              </tr>
                <tr><td></td>
                <td><br><p style="text-align:center;"> <a href="https://www.facebook.com/survey/?oid=515733866943967"> <img src="https://i.imgur.com/riIgnG1.png" width="245" height="80"> </a></p><br></td>
                <td></td>
              </tr>
               <tr>
                <th colspan="3"><p style="font-family:arial;font-weight:normal">Responding to Dogfooding surveys now earns you engagement points which you can redeem for awesome items in the Swag Store! Complete this survey, create a Swag Store account, <a href="https://portal.mypropago.com"> visit this link</a>, and check out the awesome items you can earn just by Dogfooding Portal! For more information about the Swag Store, <a href="https://www.internalfb.com/intern/wiki/Portal/Portal_Dogfooding/Dogfooding/Swag_Store/"> check out the wiki</a>!<br></p></th>
              </tr>
               <tr>
               <th colspan="3"><p style="font-family:arial;font-weight:normal"><b><br>Issues with Portal?</b><br>If you have problems with your Portal {columns[device_serial_number]}, or have any questions/comments, please post in <a href="https://fb.workplace.com/groups/1959599607620319">the Portal Feedback group</a>.</p></th>
               </tr>
               <tr>
               </tr>
               <tr>
               <th colspan="3"><p align="left" style="font-family:arial;font-weight:normal"><br>Best regards,<br>The Portal Dogfooding Survey Team</p></th>
            </tr></tbody></table>
            </body></html>
            """,
        "query": """
WITH q1 AS (
    SELECT
            MAX(a.device_serial_number) AS device_serial_number,
            b.hardware_type AS device_type,
            a.FBID,
            a.recipients AS email
        FROM aloha_dogfooding_email_recipients a
        JOIN dim_aloha_asset_management b on b.serial_number = a.device_serial_number
        WHERE
            a.ds = '2022-08-24' -- update this to match the day that the INITIAL SURVEY EMAIL was sent
            AND a.category_name like '%Arches_Core_aug24%' -- this should also match the INITIAL survey instance's name in the config. I always try and end those instances with a _date tag for consistency's sake.
        GROUP BY 2, 3, 4
    ),

q2 AS (
    SELECT
            preferred_first_name AS first_name,
            preferred_last_name,
            unix_username,
            work_email,
            personal_fbid
        FROM d_employee_plus:hr
        WHERE
            ds = '<LATEST_DS:d_employee_plus:hr>'
            AND is_active = TRUE -- filtering out recipients who are no longer with Meta.
    ),

q3 AS (
    SELECT
        q1.FBID,
        q1.device_serial_number,
        CASE 
            WHEN q1.device_type = 'aloha' -- same as in initial distro - capitalizing device names for formatting reasons.
            THEN 'Aloha'
            WHEN q1.device_type = 'ohana'
            THEN 'Ohana'
            WHEN q1.device_type = 'omni'
            THEN 'Omni'
            WHEN q1.device_type = 'atlas'
            THEN 'Atlas'
            WHEN q1.device_type = 'catalina'
            THEN 'Catalina'
            WHEN q1.device_type = 'tate'
            THEN 'Tate'
            WHEN q1.device_type = 'luma'
            THEN 'Luma'
            WHEN q1.device_type IS NULL
            THEN 'Aloha'
            ELSE q1.device_type
            END AS device_type,
        q2.first_name,
        q1.email
    from q1
    left join q2
    on q1.FBID = q2.personal_fbid
)

SELECT FBID, device_serial_number, device_type, first_name, email from q3
LEFT JOIN (
    SELECT
        *
    FROM simon_responses_formatted:growth -- updated as of 8/10/22. Old table is being deprecated
    WHERE
        survey_id = 734059467904265 -- update this value with the Simon ID (from task log column C).
        AND ds > '<DATEID-6>'
) complete
    ON q3.FBID = complete.user_id
WHERE
    complete.user_id IS NULL
        """,
        "columns": ["device_serial_number", "device_type", "FBID", "first_name", "email"],
        "sender": "The Portal Dogfood Survey Team <portaldogfoodingsurvey@fb.com>",
        "email_subject": "*REMINDER*: Please complete the August 2022 Arches Core Survey",
        "is_enabled": "FALSE",
        "create_task": "FALSE",
    },
    "generate_portal_df_survey_Arches_Core_survey_reminder_aug26": {
        "cron_schedule": "0 10 * * 5",
        "email_message": """
            <html><head></head>
            <body>
            <br><table style="width:50%" align="center">
              <tbody><tr>
                <th colspan="3"><h1 style="font-family:arial;font-weight:normal">Thank you for Dogfooding {columns[device_type]}!</h1></th>
              </tr>
                <tr>
                <th colspan="3"><h2 style="font-family:arial;font-weight:normal">Hello {columns[first_name]}</h2></th>
                </tr>
                <tr><th colspan="2"><p style="font-family:arial;font-weight:normal">This is a friendly reminder to please complete the <b>Portal core software survey</b>.</p><br></th>
                </tr><tr>
                <th colspan="2"><p style="font-family:arial;font-weight:normal">Core surveys help us track Portal’s health over time, and your feedback is critical! Please help us by completing the survey. Click the button below to begin the survey; if you already completed the survey this morning, kindly disregard this message.</p></th>
              </tr>
                <tr><td></td>
                <td><br><p style="text-align:center;"> <a href="https://www.facebook.com/survey/?oid=515733866943967"> <img src="https://i.imgur.com/riIgnG1.png" width="245" height="80"> </a></p><br></td>
                <td></td>
              </tr>
               <tr>
                <th colspan="3"><p style="font-family:arial;font-weight:normal">Responding to Dogfooding surveys now earns you engagement points which you can redeem for awesome items in the Swag Store! Complete this survey, create a Swag Store account, <a href="https://portal.mypropago.com"> visit this link</a>, and check out the awesome items you can earn just by Dogfooding Portal! For more information about the Swag Store, <a href="https://www.internalfb.com/intern/wiki/Portal/Portal_Dogfooding/Dogfooding/Swag_Store/"> check out the wiki</a>!<br></p></th>
              </tr>
               <tr>
               <th colspan="3"><p style="font-family:arial;font-weight:normal"><b><br>Issues with Portal?</b><br>If you have problems with your Portal {columns[device_serial_number]}, or have any questions/comments, please post in <a href="https://fb.workplace.com/groups/1959599607620319">the Portal Feedback group</a>.</p></th>
               </tr>
               <tr>
               </tr>
               <tr>
               <th colspan="3"><p align="left" style="font-family:arial;font-weight:normal"><br>Best regards,<br>The Portal Dogfooding Survey Team</p></th>
            </tr></tbody></table>
            </body></html>
            """,
        "query": """
WITH q1 AS (
    SELECT
            MAX(a.device_serial_number) AS device_serial_number,
            b.hardware_type AS device_type,
            a.FBID,
            a.recipients AS email
        FROM aloha_dogfooding_email_recipients a
        JOIN dim_aloha_asset_management b on b.serial_number = a.device_serial_number
        WHERE
            a.ds = '2022-08-24' -- update this to match the day that the INITIAL SURVEY EMAIL was sent
            AND a.category_name like '%Arches_Core_aug24%' -- this should also match the INITIAL survey instance's name in the config. I always try and end those instances with a _date tag for consistency's sake.
        GROUP BY 2, 3, 4
    ),

q2 AS (
    SELECT
            preferred_first_name AS first_name,
            preferred_last_name,
            unix_username,
            work_email,
            personal_fbid
        FROM d_employee_plus:hr
        WHERE
            ds = '<LATEST_DS:d_employee_plus:hr>'
            AND is_active = TRUE -- filtering out recipients who are no longer with Meta.
    ),

q3 AS (
    SELECT
        q1.FBID,
        q1.device_serial_number,
        CASE 
            WHEN q1.device_type = 'aloha' -- same as in initial distro - capitalizing device names for formatting reasons.
            THEN 'Aloha'
            WHEN q1.device_type = 'ohana'
            THEN 'Ohana'
            WHEN q1.device_type = 'omni'
            THEN 'Omni'
            WHEN q1.device_type = 'atlas'
            THEN 'Atlas'
            WHEN q1.device_type = 'catalina'
            THEN 'Catalina'
            WHEN q1.device_type = 'tate'
            THEN 'Tate'
            WHEN q1.device_type = 'luma'
            THEN 'Luma'
            WHEN q1.device_type IS NULL
            THEN 'Aloha'
            ELSE q1.device_type
            END AS device_type,
        q2.first_name,
        q1.email
    from q1
    left join q2
    on q1.FBID = q2.personal_fbid
)

SELECT FBID, device_serial_number, device_type, first_name, email from q3
LEFT JOIN (
    SELECT
        *
    FROM simon_responses_formatted:growth -- updated as of 8/10/22. Old table is being deprecated
    WHERE
        survey_id = 734059467904265 -- update this value with the Simon ID (from task log column C).
        AND ds > '<DATEID-6>'
) complete
    ON q3.FBID = complete.user_id
WHERE
    complete.user_id IS NULL
        """,
        "columns": ["device_serial_number", "device_type", "FBID", "first_name", "email"],
        "sender": "The Portal Dogfood Survey Team <portaldogfoodingsurvey@fb.com>",
        "email_subject": "*REMINDER*: Please complete the August 2022 Arches Core Survey",
        "is_enabled": "FALSE",
        "create_task": "FALSE",
    },  
    "generate_portal_df_survey_tate_luma_connectivity_sep12": {
        "cron_schedule": "0 10 * * 1",
        "email_message": """
            <html><head></head>
            <body>
            <br><table style="width:50%" align="center">
              <tbody><tr>
                <th colspan="3"><h1 style="font-family:arial;font-weight:normal">Thank you for Dogfooding {columns[device_type]}!</h1></th>
              </tr>
                <tr>
                <th colspan="3"><h2 style="font-family:arial;font-weight:normal">Hello {columns[first_name]}</h2></th>
                </tr>
                <tr><th colspan="2"><p style="font-family:arial;font-weight:normal">We are interested in your experience with <b>Wi-Fi Connectivity on your Portal!!!</b></p><br></th>
                </tr><tr>
                <th colspan="2"><p style="font-family:arial;font-weight:normal">Please take a few moments to complete this survey by EOD Wednesday, September 14. Your feedback helps improve Portal for everyone, and now is your chance to make your voice heard! Click the button below to begin the survey.</p></th>
              </tr>
                <tr><td></td>
                <td><br><p style="text-align:center;"> <a href="https://www.facebook.com/survey/?oid=342825784608683"> <img src="https://i.imgur.com/riIgnG1.png" width="245" height="80"> </a></p><br></td>
                <td></td>
              </tr>
               <tr>
                <th colspan="3"><p style="font-family:arial;font-weight:normal">Responding to Dogfooding surveys now earns you engagement points which you can redeem for awesome items in the Swag Store! Complete this survey, create a Swag Store account, <a href="https://portal.mypropago.com"> visit this link</a>, and check out the awesome items you can earn just by Dogfooding Portal! For more information about the Swag Store, <a href="https://www.internalfb.com/intern/wiki/Portal/Portal_Dogfooding/Dogfooding/Swag_Store/"> check out the wiki</a>!<br></p></th>
              </tr>
               <tr>
               <th colspan="3"><p style="font-family:arial;font-weight:normal"><b><br>Issues with Portal?</b><br>If you have problems with your Portal {columns[device_serial_number]}, or have any questions/comments, please post in <a href="https://fb.workplace.com/groups/1959599607620319">the Portal Feedback group</a>.</p></th>
               </tr>
               <tr>
               </tr>
               <tr>
               <th colspan="3"><p align="left" style="font-family:arial;font-weight:normal"><br>Best regards,<br>The Portal Dogfooding Survey Team</p></th>
            </tr></tbody></table>
            </body></html>
            """,
        "query": """
WITH df AS (
        SELECT
            MAX(a.serial_number) AS device_serial_number,
            CASE 
            WHEN a.hardware_type = 'aloha'
            THEN 'Aloha'
            WHEN a.hardware_type = 'ohana'
            THEN 'Ohana'
            WHEN a.hardware_type = 'omni'
            THEN 'Omni'
            WHEN a.hardware_type = 'atlas'
            THEN 'Atlas'
            WHEN a.hardware_type = 'catalina'
            THEN 'Catalina'
            WHEN a.hardware_type = 'tate'
            THEN 'Tate'
            WHEN a.hardware_type = 'luma'
            THEN 'Luma'
            WHEN a.hardware_type IS NULL
            THEN 'Aloha'
            ELSE a.hardware_type
            END AS device_type,
            a.first_name,
            a.owner_fbid AS FBID,
            a.first_setup_time,
            a.hardware_build,
            a.allocation_team
        FROM dim_aloha_asset_management a
        JOIN dim_aloha_devices b on a.serial_number = b.device_serial_number
        WHERE
            a.ds = '<LATEST_DS:dim_aloha_asset_management>'
            AND b.ds = '<LATEST_DS:dim_aloha_devices>'
            AND a.secondary_owner_fbid IS NULL
            AND a.df_flag = 1
            AND a.edf_flag = 0
            AND a.hardware_type in ('tate','luma')
            --AND b.active_device_l28 > 0
            AND a.ota_channel in ('Portal Beta Canary','Portal OTA Beta') 
            OR a.owner_fbid in (1659697886,1599726643,1639302470,515420376)
            AND a.owner_fbid NOT IN (567957396, 627847099)
            AND a.owner_fbid NOT IN (4)
            AND a.state in ('ASSIGNED')
        GROUP BY
          2, 3, 4, 5, 6, 7
        ),

df2 as (
    SELECT 
        FBID, 
        first_name AS first_name, 
        MAX(device_serial_number) as device_serial_number, 
        MAX(first_setup_time) AS first_setup_time,
        MAX(device_type) AS device_type,
        MAX(allocation_team) AS allocation_team
    FROM df
    GROUP BY 1,2),

df3 as (
    SELECT FBID, first_name, device_serial_number, device_type
    FROM df2
    WHERE allocation_team in ('Dogfood')
),

df4 as (
SELECT 
    df3.*,
    hr.work_email AS email
FROM df3
LEFT JOIN d_employee_plus:hr hr
ON df3.FBID = hr.personal_fbid
WHERE
ds = '<LATEST_DS:d_employee_plus:hr>'
AND termination_date IS NULL
AND work_email NOT IN (
    'mz@fb.com', 'shigongliu@fb.com','markriseley@fb.com','rfeliu@fb.com','opuada@fb.com','klur@fb.com','gegbo@fb.com','alonrz@fb.com','bdahi@fb.com','afinkelstein@fb.com','euanair@fb.com','akramer@fb.com','staceyr@fb.com','szhuk@fb.com','masa@fb.com','huirongyang@fb.com','harshkang@fb.com','ayy@fb.com','brandiwolff@fb.com','kfischer@fb.com','kendrad@fb.com','weizeng@fb.com','tjloving@fb.com','amyhayes@fb.com','kichoi@fb.com','cravennn@fb.com','bbennett@fb.com','noambe@fb.com'))

SELECT * FROM df4
    """,
        "columns": [
            "device_serial_number",
            "device_type",
            "first_name",
            "email",
            "FBID",
        ],
        "sender": "The Portal Dogfood Survey Team <portaldogfoodingsurvey@fb.com>",
        "email_subject": "Please Complete the Portal Wi-Fi Connectivity Survey by EOD Wednesday",
        "is_enabled": "TRUE",
        "create_task": "FALSE",
    },
    "generate_portal_df_survey_tate_luma_connectivity_reminder_sept13": {
        "cron_schedule": "0 10 * * 2",
        "email_message": """
            <html><head></head>
            <body>
            <br><table style="width:50%" align="center">
              <tbody><tr>
                <th colspan="3"><h1 style="font-family:arial;font-weight:normal">Thank you for Dogfooding {columns[device_type]}!</h1></th>
              </tr>
                <tr>
                <th colspan="3"><h2 style="font-family:arial;font-weight:normal">Hello {columns[first_name]}</h2></th>
                </tr>
                <tr><th colspan="2"><p style="font-family:arial;font-weight:normal">This is a final, friendly reminder to please complete the <b>Portal Wi-Fi Connectivity survey.</b></p><br></th>
                </tr><tr>
                <th colspan="2"><p style="font-family:arial;font-weight:normal">The survey should only take a few minutes to complete, and your feedback is extremely important to the Portal team. Your feedback helps improve Portal for everyone! <b>Please complete the survey by EOD Wednesday</b>. Click the button below to begin the survey; if you already completed the survey this morning, kindly disregard this message.</p></th>
              </tr>
                <tr><td></td>
                <td><br><p style="text-align:center;"> <a href="https://www.facebook.com/survey/?oid=342825784608683"> <img src="https://i.imgur.com/riIgnG1.png" width="245" height="80"> </a></p><br></td>
                <td></td>
              </tr>
               <tr>
                <th colspan="3"><p style="font-family:arial;font-weight:normal">Responding to Dogfooding surveys now earns you engagement points which you can redeem for awesome items in the Swag Store! Complete this survey, create a Swag Store account, <a href="https://portal.mypropago.com"> visit this link</a>, and check out the awesome items you can earn just by Dogfooding Portal! For more information about the Swag Store, <a href="https://www.internalfb.com/intern/wiki/Portal/Portal_Dogfooding/Dogfooding/Swag_Store/"> check out the wiki</a>!<br></p></th>
              </tr>
               <tr>
               <th colspan="3"><p style="font-family:arial;font-weight:normal"><b><br>Issues with Portal?</b><br>If you have problems with your Portal {columns[device_serial_number]}, or have any questions/comments, please post in <a href="https://fb.workplace.com/groups/1959599607620319">the Portal Feedback group</a>.</p></th>
               </tr>
               <tr>
               </tr>
               <tr>
               <th colspan="3"><p align="left" style="font-family:arial;font-weight:normal"><br>Best regards,<br>The Portal Dogfooding Survey Team</p></th>
            </tr></tbody></table>
            </body></html>
            """,
        "query": """
           WITH q1 AS (
    SELECT
            MAX(a.device_serial_number) AS device_serial_number,
            b.hardware_type AS device_type,
            a.FBID,
            a.recipients AS email
        FROM aloha_dogfooding_email_recipients a
        JOIN dim_aloha_asset_management b on b.serial_number = a.device_serial_number
        WHERE
            a.ds = '2022-09-12' -- updated
            AND a.category_name like '%tate_luma_connectivity_sept12%' -- updated
        GROUP BY 2, 3, 4
    ),

q2 AS (
    SELECT
            preferred_first_name AS first_name,
            preferred_last_name,
            unix_username,
            work_email,
            personal_fbid
        FROM d_employee_plus:hr
        WHERE
            ds = '<LATEST_DS:d_employee_plus:hr>'
            AND is_active = TRUE
    ),

q3 AS (
    SELECT
        q1.FBID,
        q1.device_serial_number,
        CASE 
            WHEN q1.device_type = 'aloha'
            THEN 'Aloha'
            WHEN q1.device_type = 'ohana'
            THEN 'Ohana'
            WHEN q1.device_type = 'omni'
            THEN 'Omni'
            WHEN q1.device_type = 'atlas'
            THEN 'Atlas'
            WHEN q1.device_type = 'catalina'
            THEN 'Catalina'
            WHEN q1.device_type = 'tate'
            THEN 'Tate'
            WHEN q1.device_type = 'luma'
            THEN 'Luma'
            WHEN q1.device_type IS NULL
            THEN 'Aloha'
            ELSE q1.device_type
            END AS device_type,
        q2.first_name,
        q1.email
    from q1
    left join q2
    on q1.FBID = q2.personal_fbid
)

SELECT FBID, device_serial_number, device_type, first_name, email from q3
LEFT JOIN (
    SELECT
        *
    FROM simon_responses_formatted:growth
    WHERE
        survey_id = 342825784608683 -- updated
        AND ds > '<DATEID-6>'
) complete
    ON q3.FBID = complete.user_id
WHERE
    complete.user_id IS NULL
            """,
        "columns": ["device_serial_number", "device_type", "FBID", "first_name", "email"],
        "sender": "The Portal Dogfood Survey Team <portaldogfoodingsurvey@fb.com>",
        "email_subject": "REMINDER: Please Complete the Portal Wi-Fi Connectivity Survey by EOD Wednesday",
        "is_enabled": "TRUE",
        "create_task": "FALSE",
    },
    "generate_portal_df_survey_portal_test_reminder": {
        "cron_schedule": "0 14 * * 3",
        "email_message": """
            <html>
                <head>
                <meta charset="UTF-8">
                </head>
                <body>
                    <p>&#128075&#128075 Hello {columns[first_name]},</p>
            <br/> <p>&#10071This is a friendly reminder for the Portal Camera Feedback Survey!
            <p> If you have not responded to the survey yet, please use the following survey link and share your thoughts about &#128247 Portal camera's performance!<p>
                <p>
                        <a href="https://fburl.com/portal_camera_feedback_feb21"> https://fburl.com/portal_camera_feedback_feb21</a><p>
                </br>
                </p>
                    </br>
                    </p>
                    <p>
                        Thank you,<br/>
                        The Portal Dogfood Survey Team
                    </p>
                </body>
            </html>
            """,
        "query": """
        SELECT
    owner_fbid AS FBID,
    device_serial_number,
    first_name,
    email
    FROM aloha_device_dogfooding_summary
    WHERE ds='<LATEST_DS:aloha_device_dogfooding_summary>'
    AND owner_fbid = 100001927815295
    """,
        "columns": ["device_serial_number", "FBID", "first_name", "email"],
        "sender": "The Portal Dogfood Survey Team <portaldogfoodingsurvey@fb.com>",
        "email_subject": "REMINDER: Portal Reminder Test: Please respond by Sunday, 2/28",
        "is_enabled": "FALSE",
        "create_task": "FALSE",
    },
    "generate_portal_df_survey_Portal_core_survey_nov8": {
        "cron_schedule": "0 10 * * 1",
        "email_message": """
            <html>
                    <head>
                     <meta charset="UTF-8">
                    </head>
                    <body>
                        &#128075&#128075 Hi {columns[first_name]},<br/>
                        <p>
                        Thanks for dogfooding Portal ({columns[device_type]}) ({columns[device_serial_number]})!
                        <p>
                        <p>
                        It's that time of the month! We would love to hear from you about your experience with Portal's core software!
                        Please take a few moments to complete this survey on the <b>quality of Portal software</b> by EOD Wednesday, 11/10 &#9200.<br/>

                        <a href="https://www.facebook.com/survey/?oid=911341053153252"> Click here to begin survey!</a>
                        </p>
                       <p>
                       Responding to Dogfooding surveys now earns you engagement points which you can redeem for awesome items in the Swag Store! 
                    Complete this survey, create a Swag Store account, <a href="https://portal.mypropago.com"> visit this link</a>, 
                    and check out the awesome items you can earn just by Dogfooding Portal! 
                    For more information about the Swag Store, <a href="https://www.internalfb.com/intern/wiki/Portal/Portal_Dogfooding/Dogfooding/Swag_Store/"> check out the wiki</a>!
                        <p>
                        <br>
                            Best,<br/>
                            <p>
                            The Portal Dogfood Survey Team
                        </p>
                    </body>
            </html>
            """,
        "query": """
        WITH df AS (
        SELECT
            MAX(serial_number) AS device_serial_number,
            hardware_type AS device_type,
            first_name,
            owner_fbid AS FBID,
            first_setup_time,
            hardware_build
        FROM dim_aloha_asset_management_from_track_at a
        JOIN dim_aloha_devices b on a.serial_number = b.device_serial_number
        WHERE
            a.ds = '<LATEST_DS:aloha_device_dogfooding_summary>'
            AND a.df_flag = 1
            AND a.secondary_owner_fbid IS NULL
            AND a.edf_flag = 0
            AND allocation_team NOT IN ('EDF', 'Leads/XFN', 'Workplace VC')
            AND hardware_type in ('aloha', 'ohana')
            --AND b.active_device_l28 > 0
            AND ota_channel in ('Portal OTA Beta')
            OR owner_fbid = 1659697886
            AND NOT CONTAINS(asset_tags, 138060473031027) --recall tag
            AND NOT CONTAINS(asset_tags, 1420923608029097) --return task created tag
            AND NOT CONTAINS(asset_tags, 2220216648035975) --recall waived
            AND owner_fbid NOT IN (567957396, 627847099)
            AND owner_fbid NOT IN (4)
        GROUP BY
          2, 3, 4, 5,6
        ),

df2 as (
    SELECT 
        FBID, 
        first_name AS first_name, 
        MAX(device_serial_number) as device_serial_number, 
        MAX(first_setup_time) AS first_setup_time,
        MAX(device_type) AS device_type
    FROM df
    GROUP BY 1,2),

df3 as (
    SELECT FBID, first_name, device_serial_number, device_type
    FROM df2
)


SELECT 
    df3.*,
    hr.work_email AS email
FROM df3
LEFT JOIN d_employee_plus:hr hr
ON df3.FBID = hr.personal_fbid
WHERE
ds = '<LATEST_DS:d_employee_plus:hr>'
AND termination_date IS NULL
AND work_email NOT IN ('mz@fb.com', 'rfeliu@fb.com', 'chrismarra@fb.com')
    """,
        "columns": [
            "device_serial_number",
            "device_type",
            "first_name",
            "email",
            "FBID",
        ],
        "sender": "The Portal Dogfood Survey Team <portaldogfoodingsurvey@fb.com>",
        "email_subject": "Portal Core Software Feedback Survey November 2021: Response Requested by 11/10",
        "is_enabled": "FALSE",
        "create_task": "FALSE",
    },
    "generate_portal_df_survey_blend_dewarp_aug29": {
        "cron_schedule": "0 10 * * 1",
        "email_message": """
            <html><head></head>
            <body>
            <br><table style="width:50%" align="center">
              <tbody><tr>
                <th colspan="3"><h1 style="font-family:arial;font-weight:normal">Thank you for Dogfooding {columns[device_type]}!</h1></th>
              </tr>
                <tr>
                <th colspan="3"><h2 style="font-family:arial;font-weight:normal">Hello {columns[first_name]}</h2></th>
                </tr>
                <tr><th colspan="2"><p style="font-family:arial;font-weight:normal">We are interested in your experience with <b>Blend Dewarp, a feature that impacts your self view in apps that use the camera!</b></p><br></th>
                </tr><tr>
                <th colspan="2"><p style="font-family:arial;font-weight:normal">Please take a few moments to complete this survey. Your feedback helps improve Portal for everyone, and now is your chance to make your voice heard! Click the button below to begin the survey.</p></th>
              </tr>
                <tr><td></td>
                <td><br><p style="text-align:center;"> <a href="https://www.facebook.com/survey/?oid=1755442131467609"> <img src="https://i.imgur.com/riIgnG1.png" width="245" height="80"> </a></p><br></td>
                <td></td>
              </tr>
               <tr>
                <th colspan="3"><p style="font-family:arial;font-weight:normal">Responding to Dogfooding surveys now earns you engagement points which you can redeem for awesome items in the Swag Store! Complete this survey, create a Swag Store account, <a href="https://portal.mypropago.com"> visit this link</a>, and check out the awesome items you can earn just by Dogfooding Portal! For more information about the Swag Store, <a href="https://www.internalfb.com/intern/wiki/Portal/Portal_Dogfooding/Dogfooding/Swag_Store/"> check out the wiki</a>!<br></p></th>
              </tr>
               <tr>
               <th colspan="3"><p style="font-family:arial;font-weight:normal"><b><br>Issues with Portal?</b><br>If you have problems with your Portal {columns[device_serial_number]}, or have any questions/comments, please post in <a href="https://fb.workplace.com/groups/1959599607620319">the Portal Feedback group</a>.</p></th>
               </tr>
               <tr>
               </tr>
               <tr>
               <th colspan="3"><p align="left" style="font-family:arial;font-weight:normal"><br>Best regards,<br>The Portal Dogfooding Survey Team</p></th>
            </tr></tbody></table>
            </body></html>
            """,
        "query": """
         WITH df AS ( -- begin first subquery - getting device information
        SELECT
            MAX(a.serial_number) AS device_serial_number, -- The CASE WHEN statement here makes device aliases capitalized so that the email text looks good in the header
            CASE 
            WHEN a.hardware_type = 'aloha'
            THEN 'Aloha'
            WHEN a.hardware_type = 'ohana'
            THEN 'Ohana'
            WHEN a.hardware_type = 'omni'
            THEN 'Omni'
            WHEN a.hardware_type = 'atlas'
            THEN 'Atlas'
            WHEN a.hardware_type = 'catalina'
            THEN 'Catalina'
            WHEN a.hardware_type = 'tate'
            THEN 'Tate'
            WHEN a.hardware_type = 'luma'
            THEN 'Luma'
            WHEN a.hardware_type IS NULL -- this is the only non-cosmetic part of the CASE WHEN and should be retained always. Some Alohas have no device_type value in the db, and NULLS can mess up the config
            THEN 'Aloha'
            ELSE a.hardware_type
            END AS device_type,
            a.first_name,
            a.owner_fbid AS FBID, -- Alias as FBID in order to match with Columns specified in Config
            a.first_setup_time,
            a.hardware_build,
            a.allocation_team
        FROM dim_aloha_asset_management a
        JOIN dim_aloha_devices b on a.serial_number = b.device_serial_number
        WHERE
            a.ds = '<LATEST_DS:dim_aloha_asset_management>'
            AND b.ds = '<LATEST_DS:dim_aloha_devices>'
            AND a.secondary_owner_fbid IS NULL
            AND a.df_flag = 1
            AND a.edf_flag = 0
            AND comment not LIKE '%6GB%'
            AND a.hardware_type in ('luma','tate') -- device types you want to include in the distribution
            --AND b.active_device_l28 > 0 -- usually this line will stay commented out for distribution. I use this to check what the denom should be for the active response rate in Task Log.
            AND a.ota_channel in ('Portal Alpha Canary','Portal OTA Alpha','Portal Beta Canary','Portal OTA Beta') -- Channels you want to include in distribution. Be sure everything is spelled right & formatted correctly here, some channels include a space in front of the name.
            OR a.owner_fbid in (1659697886,1639302470,671368390,6410940) -- These are Saurabh Bhandari, Trip, Anju, and Joe Sena's FBIDs. Check and see if Saurabh still wants to receive surveys and whether Joe wants to be included.
            AND a.owner_fbid NOT IN (567957396, 627847099) 
            AND a.owner_fbid NOT IN (4) -- MZ
            AND a.state in ('ASSIGNED')
        GROUP BY
          2, 3, 4, 5, 6, 7
        ),

df2 as ( -- This subquery deduplicates any users that may have multiple devices / different channel allocations.
    SELECT 
        FBID, -- note how FBID passes through from df, so no further aliasing is required
        first_name AS first_name, 
        MAX(device_serial_number) as device_serial_number, 
        MAX(first_setup_time) AS first_setup_time,
        MAX(device_type) AS device_type,
        MAX(allocation_team) AS allocation_team
    FROM df
    GROUP BY 1,2),

df3 as ( -- this subquery further filters devices down to those allocated to Dogfooding. 
    SELECT FBID, first_name, device_serial_number, device_type
    FROM df2
    WHERE allocation_team in ('Dogfood') -- This is a failsafe on the df_flag = 1 condition from the subquery df 
),

df4 as ( -- this subquery adds in user emails and makes sure we aren't surveying 
SELECT 
    df3.*,
    hr.work_email AS email
FROM df3
LEFT JOIN d_employee_plus:hr hr
ON df3.FBID = hr.personal_fbid
WHERE
ds = '<LATEST_DS:d_employee_plus:hr>'
AND termination_date IS NULL
AND work_email NOT IN (
    'mz@fb.com', 'shigongliu@fb.com','markriseley@fb.com','rfeliu@fb.com','opuada@fb.com','klur@fb.com','gegbo@fb.com','alonrz@fb.com','bdahi@fb.com','afinkelstein@fb.com','euanair@fb.com','akramer@fb.com','staceyr@fb.com','szhuk@fb.com','masa@fb.com','huirongyang@fb.com','harshkang@fb.com','ayy@fb.com','brandiwolff@fb.com','kfischer@fb.com','kendrad@fb.com','weizeng@fb.com','tjloving@fb.com','amyhayes@fb.com','kichoi@fb.com','cravennn@fb.com','bbennett@fb.com','noambe@fb.com'))

SELECT * FROM df4
            """,
        "columns": [
            "device_serial_number",
            "device_type",
            "first_name",
            "email",
            "FBID",
        ],
        "sender": "The Portal Dogfood Survey Team <portaldogfoodingsurvey@fb.com>",
        "email_subject": "Please Complete Blend Dewarp Survey",
        "is_enabled": "FALSE",
        "create_task": "FALSE",
    },
    "generate_portal_df_survey_portal_blend_dewarp_reminder_sep6": {
        "cron_schedule": "0 10 * * 2",
        "email_message": """
            <html><head></head>
            <body>
            <br><table style="width:50%" align="center">
              <tbody><tr>
                <th colspan="3"><h1 style="font-family:arial;font-weight:normal">Thank you for Dogfooding {columns[device_type]}!</h1></th>
              </tr>
                <tr>
                <th colspan="3"><h2 style="font-family:arial;font-weight:normal">Hello {columns[first_name]}</h2></th>
                </tr>
                <tr><th colspan="2"><p style="font-family:arial;font-weight:normal">This is a friendly reminder to please complete the <b>Blend Dewarp Survey.</b></p><br></th>
                </tr><tr>
                <th colspan="2"><p style="font-family:arial;font-weight:normal">The survey should only take a few minutes to complete, and your feedback is extremely important to the Portal team. Your feedback helps improve Portal for everyone! Please help us by completing the survey. Click the button below to begin the survey; if you already completed the survey this morning, kindly disregard this message.</p></th>
              </tr>
                <tr><td></td>
                <td><br><p style="text-align:center;"> <a href="https://www.facebook.com/survey/?oid=1755442131467609"> <img src="https://i.imgur.com/riIgnG1.png" width="245" height="80"> </a></p><br></td>
                <td></td>
              </tr>
               <tr>
                <th colspan="3"><p style="font-family:arial;font-weight:normal">Responding to Dogfooding surveys now earns you engagement points which you can redeem for awesome items in the Swag Store! Complete this survey, create a Swag Store account, <a href="https://portal.mypropago.com"> visit this link</a>, and check out the awesome items you can earn just by Dogfooding Portal! For more information about the Swag Store, <a href="https://www.internalfb.com/intern/wiki/Portal/Portal_Dogfooding/Dogfooding/Swag_Store/"> check out the wiki</a>!<br></p></th>
              </tr>
               <tr>
               <th colspan="3"><p style="font-family:arial;font-weight:normal"><b><br>Issues with Portal?</b><br>If you have problems with your Portal {columns[device_serial_number]}, or have any questions/comments, please post in <a href="https://fb.workplace.com/groups/1959599607620319">the Portal Feedback group</a>.</p></th>
               </tr>
               <tr>
               </tr>
               <tr>
               <th colspan="3"><p align="left" style="font-family:arial;font-weight:normal"><br>Best regards,<br>The Portal Dogfooding Survey Team</p></th>
            </tr></tbody></table>
            </body></html>
            """,
        "query": """
            WITH q1 AS (
    SELECT
            MAX(a.device_serial_number) AS device_serial_number,
            b.hardware_type AS device_type,
            a.FBID,
            a.recipients AS email
        FROM aloha_dogfooding_email_recipients a
        JOIN dim_aloha_asset_management b on b.serial_number = a.device_serial_number
        WHERE
            a.ds = '2022-08-29' -- updated
            AND a.category_name like '%blend_dewarp_aug29%' -- updated
        GROUP BY 2, 3, 4
    ),

q2 AS (
    SELECT
            preferred_first_name AS first_name,
            preferred_last_name,
            unix_username,
            work_email,
            personal_fbid
        FROM d_employee_plus:hr
        WHERE
            ds = '<LATEST_DS:d_employee_plus:hr>'
            AND is_active = TRUE
    ),

q3 AS (
    SELECT
        q1.FBID,
        q1.device_serial_number,
        CASE 
            WHEN q1.device_type = 'aloha'
            THEN 'Aloha'
            WHEN q1.device_type = 'ohana'
            THEN 'Ohana'
            WHEN q1.device_type = 'omni'
            THEN 'Omni'
            WHEN q1.device_type = 'atlas'
            THEN 'Atlas'
            WHEN q1.device_type = 'catalina'
            THEN 'Catalina'
            WHEN q1.device_type = 'tate'
            THEN 'Tate'
            WHEN q1.device_type = 'luma'
            THEN 'Luma'
            WHEN q1.device_type IS NULL
            THEN 'Aloha'
            ELSE q1.device_type
            END AS device_type,
        q2.first_name,
        q1.email
    from q1
    left join q2
    on q1.FBID = q2.personal_fbid
)

SELECT FBID, device_serial_number, device_type, first_name, email from q3
LEFT JOIN (
    SELECT
        *
    FROM simon_responses_formatted:growth
    WHERE
        survey_id = 1755442131467609 -- updated
        AND ds > '<DATEID-12>'
) complete
    ON q3.FBID = complete.user_id
WHERE
    complete.user_id IS NULL
            """,
        "columns": [
            "device_serial_number",
            "device_type",
            "first_name",
            "email",
            "FBID",
        ],
        "sender": "The Portal Dogfood Survey Team <portaldogfoodingsurvey@fb.com>",
        "email_subject": "REMINDER: Please Complete the Blend Dewarp Survey",
        "is_enabled": "FALSE",
        "create_task": "FALSE",
    },
    "generate_portal_df_survey_email_format_test_jul5": {
        "cron_schedule": "15 11 * * 1",
        "email_message": """
            <html><head></head>
            <body>
            <br><table style="width:50%" align="center">
              <tbody><tr>
                <th colspan="3"><h1 style="font-family:arial;font-weight:normal">Thank you for Dogfooding {columns[device_type]}!</h1></th>
              </tr>
                <tr>
                <th colspan="3"><h2 style="font-family:arial;font-weight:normal">Hello {columns[first_name]}</h2></th>
                </tr>
                <tr><th colspan="2"><p style="font-family:arial;font-weight:normal">It's that time of the month! We would love to hear from you about your experience with <b>Portal's core software</b>!</p><br></th>
                </tr><tr>
                <th colspan="2"><p style="font-family:arial;font-weight:normal">Please take a few moments to complete this survey on the <b>quality of Portal's core software</b> by EOD Sunday, 6/19 &#9200. Core surveys help us track Portal’s health over time, and your feedback is critical! Click the button below to begin the survey.</p></th>
              </tr>
                <tr><td></td>
                <td><br><p style="text-align:center;"> <a href="https://www.facebook.com/survey/?oid=657484455477098"> <img src="https://i.imgur.com/riIgnG1.png" width="245" height="80"> </a></p><br></td>
                <td></td>
              </tr>
               <tr>
                <th colspan="3"><p style="font-family:arial;font-weight:normal">Responding to Dogfooding surveys now earns you engagement points which you can redeem for awesome items in the Swag Store! Complete this survey, create a Swag Store account, <a href="https://portal.mypropago.com"> visit this link</a>, and check out the awesome items you can earn just by Dogfooding Portal! For more information about the Swag Store, <a href="https://www.internalfb.com/intern/wiki/Portal/Portal_Dogfooding/Dogfooding/Swag_Store/"> check out the wiki</a>!<br></p></th>
              </tr>
               <tr>
               <th colspan="3"><p style="font-family:arial;font-weight:normal"><b><br>Issues with Portal?</b><br>If you have problems with your Portal {columns[device_serial_number]}, or have any questions/comments, please post in <a href="https://fb.workplace.com/groups/1959599607620319">the Portal Feedback group</a>.</p></th>
               </tr>
               <tr>
               </tr>
               <tr>
               <th colspan="3"><p align="left" style="font-family:arial;font-weight:normal"><br>Best regards,<br>The Portal Dogfooding Survey Team</p></th>
            </tr></tbody></table>
            </body></html>
            """,
        "query": """
        WITH df AS (
        SELECT
            MAX(a.serial_number) AS device_serial_number,
            CASE WHEN a.hardware_type IS NULL
            THEN 'aloha'
            ELSE a.hardware_type
            END AS device_type,
            a.first_name,
            a.owner_fbid AS FBID,
            a.first_setup_time,
            a.hardware_build,
            a.allocation_team
        FROM dim_aloha_asset_management a
        JOIN dim_aloha_devices b on a.serial_number = b.device_serial_number
        WHERE
            a.ds = '<LATEST_DS:dim_aloha_asset_management>'
            AND a.secondary_owner_fbid IS NULL
            AND a.df_flag = 1
            AND a.edf_flag = 0
            AND a.owner_fbid in (1599726643)
            AND a.owner_fbid NOT IN (567957396, 627847099)
            AND a.owner_fbid NOT IN (4)
            AND a.state in ('ASSIGNED')
        GROUP BY
          2, 3, 4, 5, 6, 7
        ),

df2 as (
    SELECT 
        FBID, 
        first_name AS first_name, 
        MAX(device_serial_number) as device_serial_number, 
        MAX(first_setup_time) AS first_setup_time,
        MAX(device_type) AS device_type,
        MAX(allocation_team) AS allocation_team
    FROM df
    GROUP BY 1,2),

df3 as (
    SELECT FBID, first_name, device_serial_number, device_type
    FROM df2
    WHERE allocation_team in ('Dogfood')
),

df4 as (
SELECT 
    df3.*,
    hr.work_email AS email
FROM df3
LEFT JOIN d_employee_plus:hr hr
ON df3.FBID = hr.personal_fbid
WHERE
ds = '<LATEST_DS:d_employee_plus:hr>'
AND termination_date IS NULL
AND work_email NOT IN (
    'mz@fb.com', 'shigongliu@fb.com','markriseley@fb.com','rfeliu@fb.com','opuada@fb.com','klur@fb.com','gegbo@fb.com','alonrz@fb.com','bdahi@fb.com','afinkelstein@fb.com','euanair@fb.com','akramer@fb.com','staceyr@fb.com','szhuk@fb.com','masa@fb.com','huirongyang@fb.com','harshkang@fb.com','ayy@fb.com','brandiwolff@fb.com','kfischer@fb.com','kendrad@fb.com','weizeng@fb.com','tjloving@fb.com','amyhayes@fb.com','kichoi@fb.com','cravennn@fb.com','bbennett@fb.com','noambe@fb.com'))

SELECT * FROM df4
        """,
        "columns": ["device_serial_number", "device_type", "FBID", "first_name", "email"],
        "sender": "The Portal Dogfood Survey Team <portaldogfoodingsurvey@fb.com>",
        "email_subject": "Test Instance: Email Format",
        "is_enabled": "FALSE",
        "create_task": "FALSE",
    },
    "generate_portal_df_survey_portal_segmentation_reminder_aug15": {
        "cron_schedule": "0 10 * * 1",
        "email_message": """
            <html><head></head>
            <body>
            <br><table style="width:50%" align="center">
              <tbody><tr>
                <th colspan="3"><h1 style="font-family:arial;font-weight:normal">Thank you for Dogfooding {columns[device_type]}!</h1></th>
              </tr>
                <tr>
                <th colspan="3"><h2 style="font-family:arial;font-weight:normal">Hello {columns[first_name]}</h2></th>
                </tr>
                <tr><th colspan="2"><p style="font-family:arial;font-weight:normal">This is a final, friendly reminder to please complete the <b>Portal background AR effects for work survey.</b></p><br></th>
                </tr><tr>
                <th colspan="2"><p style="font-family:arial;font-weight:normal">The survey should only take a few minutes to complete, and your feedback is extremely important to the Portal team. Your feedback helps improve Portal for everyone! Please complete the survey by EOD. Click the button below to begin the survey; if you already completed the survey this morning, kindly disregard this message.</p></th>
              </tr>
                <tr><td></td>
                <td><br><p style="text-align:center;"> <a href="https://www.facebook.com/survey/?oid=1401103873729329"> <img src="https://i.imgur.com/riIgnG1.png" width="245" height="80"> </a></p><br></td>
                <td></td>
              </tr>
               <tr>
                <th colspan="3"><p style="font-family:arial;font-weight:normal">Responding to Dogfooding surveys now earns you engagement points which you can redeem for awesome items in the Swag Store! Complete this survey, create a Swag Store account, <a href="https://portal.mypropago.com"> visit this link</a>, and check out the awesome items you can earn just by Dogfooding Portal! For more information about the Swag Store, <a href="https://www.internalfb.com/intern/wiki/Portal/Portal_Dogfooding/Dogfooding/Swag_Store/"> check out the wiki</a>!<br></p></th>
              </tr>
               <tr>
               <th colspan="3"><p style="font-family:arial;font-weight:normal"><b><br>Issues with Portal?</b><br>If you have problems with your Portal {columns[device_serial_number]}, or have any questions/comments, please post in <a href="https://fb.workplace.com/groups/1959599607620319">the Portal Feedback group</a>.</p></th>
               </tr>
               <tr>
               </tr>
               <tr>
               <th colspan="3"><p align="left" style="font-family:arial;font-weight:normal"><br>Best regards,<br>The Portal Dogfooding Survey Team</p></th>
            </tr></tbody></table>
            </body></html>
            """,
        "query": """
            WITH q1 AS (
    SELECT
            MAX(a.device_serial_number) AS device_serial_number,
            b.hardware_type AS device_type,
            a.FBID,
            a.recipients AS email
        FROM aloha_dogfooding_email_recipients a
        JOIN dim_aloha_asset_management b on b.serial_number = a.device_serial_number
        WHERE
            a.ds = '2022-08-11' -- updated
            AND a.category_name like '%segmentation_aug11%' -- updated
        GROUP BY 2, 3, 4
    ),

q2 AS (
    SELECT
            preferred_first_name AS first_name,
            preferred_last_name,
            unix_username,
            work_email,
            personal_fbid
        FROM d_employee_plus:hr
        WHERE
            ds = '<LATEST_DS:d_employee_plus:hr>'
            AND is_active = TRUE
    ),

q3 AS (
    SELECT
        q1.FBID,
        q1.device_serial_number,
        CASE 
            WHEN q1.device_type = 'aloha'
            THEN 'Aloha'
            WHEN q1.device_type = 'ohana'
            THEN 'Ohana'
            WHEN q1.device_type = 'omni'
            THEN 'Omni'
            WHEN q1.device_type = 'atlas'
            THEN 'Atlas'
            WHEN q1.device_type = 'catalina'
            THEN 'Catalina'
            WHEN q1.device_type = 'tate'
            THEN 'Tate'
            WHEN q1.device_type = 'luma'
            THEN 'Luma'
            WHEN q1.device_type IS NULL
            THEN 'Aloha'
            ELSE q1.device_type
            END AS device_type,
        q2.first_name,
        q1.email
    from q1
    left join q2
    on q1.FBID = q2.personal_fbid
)

SELECT FBID, device_serial_number, device_type, first_name, email from q3
LEFT JOIN (
    SELECT
        *
    FROM simon_responses_formatted:growth
    WHERE
        survey_id = 1401103873729329 -- updated
        AND ds > '<DATEID-6>'
) complete
    ON q3.FBID = complete.user_id
WHERE
    complete.user_id IS NULL
    """,
        "columns": ["device_serial_number", "device_type", "FBID", "first_name", "email"],
        "sender": "The Portal Dogfood Survey Team <portaldogfoodingsurvey@fb.com>",
        "email_subject": "FINAL REMINDER: Please Complete the Portal Background AR Effects for Work Survey by EOD",
        "is_enabled": "FALSE",
        "create_task": "FALSE",
    },
    "generate_portal_df_survey_Portal_core_survey_november_reminder2": {
        "cron_schedule": "30 11 * * 3",
        "email_message": """
            <html>
                <head>
                </head>
                <body>
                    Hello {columns[first_name]},
                <br/> <p> This is a friendly reminder to please complete the <b>Portal Core Software Survey by EOD</b> using the following link:
                <p>
                <p>
                        <a href="https://www.facebook.com/survey/?oid=911341053153252">Click here to begin the survey.</a>
                <p>
                <p>If you have entered the survey this morning, please ignore this reminder.<br>
                    <li>If you see other issues on your Portal, please use the bugnub in the bottom right corner to report.</li></br>
                    <li>If you have questions/comments, please post in <a href="https://fb.workplace.com/groups/1959599607620319">the Portal feedback group</a>!</li></br>
                    </ul>
                    </p>
                    Responding to Dogfooding surveys now earns you engagement points which you can redeem for awesome items in the Swag Store! 
                    Complete this survey, create a Swag Store account, <a href="https://portal.mypropago.com"> visit this link</a>, 
                    and check out the awesome items you can earn just by Dogfooding Portal! 
                    For more information about the Swag Store, <a href="https://www.internalfb.com/intern/wiki/Portal/Portal_Dogfooding/Dogfooding/Swag_Store/">check out the wiki</a>!
                    </br>
                    <br>
                    </p>
                    <p>
                        Thank you,<br/>
                        The Portal Dogfood Survey Team
                    </p>
                </body>
            </html>
            """,
        "query": """
            WITH q1 AS (
    SELECT
            MAX(a.device_serial_number) AS device_serial_number,
            b.hardware_type AS device_type,
            a.FBID,
            a.recipients AS email
        FROM aloha_dogfooding_email_recipients a
        JOIN dim_aloha_asset_management b on b.serial_number = a.device_serial_number
        WHERE
            a.ds = '2021-11-08' -- updated
            AND a.category_name like '%Portal_core_survey_nov8%' -- updated
        GROUP BY 2, 3, 4
    ),

q2 AS (
    SELECT
            preferred_first_name AS first_name,
            preferred_last_name,
            unix_username,
            work_email,
            personal_fbid
        FROM d_employee_plus:hr
        WHERE
            ds = '<LATEST_DS:d_employee_plus:hr>'
            AND is_active = TRUE
    ),

q3 AS (
    SELECT
        q1.FBID,
        q1.device_serial_number,
        q1.device_type,
        q2.first_name,
        q1.email
    from q1
    left join q2
    on q1.FBID = q2.personal_fbid
)

SELECT FBID, device_serial_number, device_type, first_name, email from q3
LEFT JOIN (
    SELECT
        *
    FROM simon_responses_formatted_non_bucketed:growth
    WHERE
        survey_id = 911341053153252 -- updated
        AND ds > '<DATEID-6>'
) complete
    ON q3.FBID = complete.user_id
WHERE
    complete.user_id IS NULL
    """,
        "columns": ["device_serial_number", "device_type", "FBID", "first_name", "email"],
        "sender": "The Portal Dogfood Survey Team <portaldogfoodingsurvey@fb.com>",
        "email_subject": "*REMINDER* Portal Core Software Feedback Survey November 2021: Please complete by EOD Today",
        "is_enabled": "FALSE",
        "create_task": "FALSE",
    },
    "generate_portal_df_survey_duet_survey_aug22": {
        "cron_schedule": "0 10 * * 1",
        "email_message": """
            <html><head></head>
            <body>
            <br><table style="width:50%" align="center">
              <tbody><tr>
                <th colspan="3"><h1 style="font-family:arial;font-weight:normal">Thank you for Dogfooding {columns[device_type]}!</h1></th>
              </tr>
                <tr>
                <th colspan="3"><h2 style="font-family:arial;font-weight:normal">Hello {columns[first_name]}</h2></th>
                </tr>
                <tr><th colspan="2"><p style="font-family:arial;font-weight:normal">We are interested in your experience with <b>Portal Duet!</b></p><br></th>
                </tr><tr>
                <th colspan="2"><p style="font-family:arial;font-weight:normal">Please take a few moments to complete this survey by EOD Wednesday, August 24, 2022. Your feedback helps improve Portal for everyone, and now is your chance to make your voice heard! Click the button below to begin the survey.</p></th>
              </tr>
                <tr><td></td>
                <td><br><p style="text-align:center;"> <a href="https://www.facebook.com/survey/?oid=771925667329648"> <img src="https://i.imgur.com/riIgnG1.png" width="245" height="80"> </a></p><br></td>
                <td></td>
              </tr>
               <tr>
                <th colspan="3"><p style="font-family:arial;font-weight:normal">Responding to Dogfooding surveys now earns you engagement points which you can redeem for awesome items in the Swag Store! Complete this survey, create a Swag Store account, <a href="https://portal.mypropago.com"> visit this link</a>, and check out the awesome items you can earn just by Dogfooding Portal! For more information about the Swag Store, <a href="https://www.internalfb.com/intern/wiki/Portal/Portal_Dogfooding/Dogfooding/Swag_Store/"> check out the wiki</a>!<br></p></th>
              </tr>
               <tr>
               <th colspan="3"><p style="font-family:arial;font-weight:normal"><b><br>Issues with Portal?</b><br>If you have problems with your Portal {columns[device_serial_number]}, or have any questions/comments, please post in <a href="https://fb.workplace.com/groups/1959599607620319">the Portal Feedback group</a>.</p></th>
               </tr>
               <tr>
               </tr>
               <tr>
               <th colspan="3"><p align="left" style="font-family:arial;font-weight:normal"><br>Best regards,<br>The Portal Dogfooding Survey Team</p></th>
            </tr></tbody></table>
            </body></html>
            """,
        "query": """
WITH df AS (
        SELECT
            MAX(a.serial_number) AS device_serial_number,
            CASE 
            WHEN a.hardware_type = 'aloha'
            THEN 'Aloha'
            WHEN a.hardware_type = 'ohana'
            THEN 'Ohana'
            WHEN a.hardware_type = 'omni'
            THEN 'Omni'
            WHEN a.hardware_type = 'atlas'
            THEN 'Atlas'
            WHEN a.hardware_type = 'catalina'
            THEN 'Catalina'
            WHEN a.hardware_type = 'tate'
            THEN 'Tate'
            WHEN a.hardware_type = 'luma'
            THEN 'Luma'
            WHEN a.hardware_type IS NULL
            THEN 'Aloha'
            ELSE a.hardware_type
            END AS device_type,
            a.first_name,
            a.owner_fbid AS FBID,
            a.first_setup_time,
            a.hardware_build,
            a.allocation_team
        FROM dim_aloha_asset_management a
        JOIN dim_aloha_devices b on a.serial_number = b.device_serial_number
        WHERE
            a.ds = '<LATEST_DS:dim_aloha_asset_management>'
            AND b.ds = '<LATEST_DS:dim_aloha_devices>'
            AND a.secondary_owner_fbid IS NULL
            AND a.df_flag = 1
            AND a.edf_flag = 0
            AND a.hardware_type in ('aloha', 'ohana', 'omni', 'atlas', 'tate', 'luma')
            --AND b.active_device_l28 > 0
            AND a.ota_channel in ('Portal Alpha Canary','Portal OTA Alpha','Portal Beta Canary','Portal OTA Beta') 
            OR a.owner_fbid in (1659697886,1599726643,1639302470,515420376,671368390)
            AND a.owner_fbid NOT IN (567957396, 627847099)
            AND a.owner_fbid NOT IN (4)
            AND a.state in ('ASSIGNED')
        GROUP BY
          2, 3, 4, 5, 6, 7
        ),

df2 as (
    SELECT 
        FBID, 
        first_name AS first_name, 
        MAX(device_serial_number) as device_serial_number, 
        MAX(first_setup_time) AS first_setup_time,
        MAX(device_type) AS device_type,
        MAX(allocation_team) AS allocation_team
    FROM df
    GROUP BY 1,2),

df3 as (
    SELECT FBID, first_name, device_serial_number, device_type
    FROM df2
    WHERE allocation_team in ('Dogfood')
),

df4 as (
SELECT 
    df3.*,
    hr.work_email AS email
FROM df3
LEFT JOIN d_employee_plus:hr hr
ON df3.FBID = hr.personal_fbid
WHERE
ds = '<LATEST_DS:d_employee_plus:hr>'
AND termination_date IS NULL
AND work_email NOT IN (
    'mz@fb.com', 'shigongliu@fb.com','markriseley@fb.com','rfeliu@fb.com','opuada@fb.com','klur@fb.com','gegbo@fb.com','alonrz@fb.com','bdahi@fb.com','afinkelstein@fb.com','euanair@fb.com','akramer@fb.com','staceyr@fb.com','szhuk@fb.com','masa@fb.com','huirongyang@fb.com','harshkang@fb.com','ayy@fb.com','brandiwolff@fb.com','kfischer@fb.com','kendrad@fb.com','weizeng@fb.com','tjloving@fb.com','amyhayes@fb.com','kichoi@fb.com','cravennn@fb.com','bbennett@fb.com','noambe@fb.com'))

SELECT * FROM df4
            """,
        "columns": ["device_serial_number",
                    "device_type",
                    "FBID",
                    "first_name",
                    "email",],
        "sender": "The Portal Dogfood Survey Team <portaldogfoodingsurvey@fb.com>",
        "email_subject": "Please complete the Portal Duet Survey by EOD Wednesday",
        "is_enabled": "FALSE",
        "create_task": "FALSE",
    },
    "generate_portal_df_survey_duet_survey_reminder_aug24": {
        "cron_schedule": "0 10 * * 3",
        "email_message": """
            <html><head></head>
            <body>
            <br><table style="width:50%" align="center">
              <tbody><tr>
                <th colspan="3"><h1 style="font-family:arial;font-weight:normal">Thank you for Dogfooding {columns[device_type]}!</h1></th>
              </tr>
                <tr>
                <th colspan="3"><h2 style="font-family:arial;font-weight:normal">Hello {columns[first_name]}</h2></th>
                </tr>
                <tr><th colspan="2"><p style="font-family:arial;font-weight:normal">This is a friendly reminder to please complete the <b>Portal Duet survey.</b></p><br></th>
                </tr><tr>
                <th colspan="2"><p style="font-family:arial;font-weight:normal">The survey should only take a few minutes to complete, and your feedback is extremely important to the Portal team. Your feedback helps improve Portal for everyone! Please complete the survey by EOD tomorrow. Click the button below to begin the survey; if you already completed the survey this morning, kindly disregard this message.</p></th>
              </tr>
                <tr><td></td>
                <td><br><p style="text-align:center;"> <a href="https://www.facebook.com/survey/?oid=771925667329648"> <img src="https://i.imgur.com/riIgnG1.png" width="245" height="80"> </a></p><br></td>
                <td></td>
              </tr>
               <tr>
                <th colspan="3"><p style="font-family:arial;font-weight:normal">Responding to Dogfooding surveys now earns you engagement points which you can redeem for awesome items in the Swag Store! Complete this survey, create a Swag Store account, <a href="https://portal.mypropago.com"> visit this link</a>, and check out the awesome items you can earn just by Dogfooding Portal! For more information about the Swag Store, <a href="https://www.internalfb.com/intern/wiki/Portal/Portal_Dogfooding/Dogfooding/Swag_Store/"> check out the wiki</a>!<br></p></th>
              </tr>
               <tr>
               <th colspan="3"><p style="font-family:arial;font-weight:normal"><b><br>Issues with Portal?</b><br>If you have problems with your Portal {columns[device_serial_number]}, or have any questions/comments, please post in <a href="https://fb.workplace.com/groups/1959599607620319">the Portal Feedback group</a>.</p></th>
               </tr>
               <tr>
               </tr>
               <tr>
               <th colspan="3"><p align="left" style="font-family:arial;font-weight:normal"><br>Best regards,<br>The Portal Dogfooding Survey Team</p></th>
            </tr></tbody></table>
            </body></html>
            """,
        "query": """
        WITH q1 AS (
    SELECT
            MAX(a.device_serial_number) AS device_serial_number,
            b.hardware_type AS device_type,
            a.FBID,
            a.recipients AS email
        FROM aloha_dogfooding_email_recipients a
        JOIN dim_aloha_asset_management b on b.serial_number = a.device_serial_number
        WHERE
            a.ds = '2022-08-22' -- updated
            AND a.category_name like '%duet_survey_aug22%' -- updated
        GROUP BY 2, 3, 4
    ),

q2 AS (
    SELECT
            preferred_first_name AS first_name,
            preferred_last_name,
            unix_username,
            work_email,
            personal_fbid
        FROM d_employee_plus:hr
        WHERE
            ds = '<LATEST_DS:d_employee_plus:hr>'
            AND is_active = TRUE
    ),

q3 AS (
    SELECT
        q1.FBID,
        q1.device_serial_number,
        CASE 
            WHEN q1.device_type = 'aloha'
            THEN 'Aloha'
            WHEN q1.device_type = 'ohana'
            THEN 'Ohana'
            WHEN q1.device_type = 'omni'
            THEN 'Omni'
            WHEN q1.device_type = 'atlas'
            THEN 'Atlas'
            WHEN q1.device_type = 'catalina'
            THEN 'Catalina'
            WHEN q1.device_type = 'tate'
            THEN 'Tate'
            WHEN q1.device_type = 'luma'
            THEN 'Luma'
            WHEN q1.device_type IS NULL
            THEN 'Aloha'
            ELSE q1.device_type
            END AS device_type,
        q2.first_name,
        q1.email
    from q1
    left join q2
    on q1.FBID = q2.personal_fbid
)

SELECT FBID, device_serial_number, device_type, first_name, email from q3
LEFT JOIN (
    SELECT
        *
    FROM simon_responses_formatted:growth
    WHERE
        survey_id = 771925667329648 -- updated
        AND ds > '<DATEID-6>'
) complete
    ON q3.FBID = complete.user_id
WHERE
    complete.user_id IS NULL
    """,
        "columns": ["device_serial_number", "device_type", "FBID", "first_name", "email"],
        "sender": "The Portal Dogfood Survey Team <portaldogfoodingsurvey@fb.com>",
        "email_subject": "REMINDER: Please complete the Portal Duet Survey by EOD Tomorrow",
        "is_enabled": "FALSE",
        "create_task": "FALSE",
    },
    "generate_portal_df_survey_catalina_core_sept12": {
        "cron_schedule": "0 10 * * 1",
        "email_message": """
            <html><head></head>
            <body>
            <br><table style="width:50%" align="center">
              <tbody><tr>
                <th colspan="3"><h1 style="font-family:arial;font-weight:normal">Thank you for Dogfooding {columns[device_type]}!</h1></th>
              </tr>
                <tr>
                <th colspan="3"><h2 style="font-family:arial;font-weight:normal">Hello {columns[first_name]}</h2></th>
                </tr>
                <tr><th colspan="2"><p style="font-family:arial;font-weight:normal">It's that time of the month! We would love to hear from you about your experience with <b>Portal TV’s core software</b>!</p><br></th>
                </tr><tr>
                <th colspan="2"><p style="font-family:arial;font-weight:normal">Please take a few moments to complete this survey on the <b>quality of Portal TV's core software</b> by EOD Wednesday, 9/14 &#9200. Core surveys help us track Portal TV’s health over time, and your feedback is critical! Click the button below to begin the survey.</p></th>
              </tr>
                <tr><td></td>
                <td><br><p style="text-align:center;"> <a href="https://www.facebook.com/survey/?oid=1252388308871222"> <img src="https://i.imgur.com/riIgnG1.png" width="245" height="80"> </a></p><br></td>
                <td></td>
              </tr>
               <tr>
                <th colspan="3"><p style="font-family:arial;font-weight:normal">Responding to Dogfooding surveys now earns you engagement points which you can redeem for awesome items in the Swag Store! Complete this survey, create a Swag Store account, <a href="https://portal.mypropago.com"> visit this link</a>, and check out the awesome items you can earn just by Dogfooding Portal! For more information about the Swag Store, <a href="https://www.internalfb.com/intern/wiki/Portal/Portal_Dogfooding/Dogfooding/Swag_Store/"> check out the wiki</a>!<br></p></th>
              </tr>
               <tr>
               <th colspan="3"><p style="font-family:arial;font-weight:normal"><b><br>Issues with Portal?</b><br>If you have problems with your Portal {columns[device_serial_number]}, or have any questions/comments, please post in <a href="https://fb.workplace.com/groups/1959599607620319">the Portal Feedback group</a>.</p></th>
               </tr>
               <tr>
               </tr>
               <tr>
               <th colspan="3"><p align="left" style="font-family:arial;font-weight:normal"><br>Best regards,<br>The Portal Dogfooding Survey Team</p></th>
            </tr></tbody></table>
            </body></html>
            """,
        "query": """
        WITH df AS ( -- begin first subquery - getting device information
        SELECT
            MAX(a.serial_number) AS device_serial_number, -- The CASE WHEN statement here makes device aliases capitalized so that the email text looks good in the header
            CASE 
            WHEN a.hardware_type = 'aloha'
            THEN 'Aloha'
            WHEN a.hardware_type = 'ohana'
            THEN 'Ohana'
            WHEN a.hardware_type = 'omni'
            THEN 'Omni'
            WHEN a.hardware_type = 'atlas'
            THEN 'Atlas'
            WHEN a.hardware_type = 'catalina'
            THEN 'Catalina'
            WHEN a.hardware_type = 'tate'
            THEN 'Tate'
            WHEN a.hardware_type = 'luma'
            THEN 'Luma'
            WHEN a.hardware_type IS NULL -- this is the only non-cosmetic part of the CASE WHEN and should be retained always. Some Alohas have no device_type value in the db, and NULLS can mess up the config
            THEN 'Aloha'
            ELSE a.hardware_type
            END AS device_type,
            a.first_name,
            a.last_name,
            a.owner_fbid AS FBID, -- Alias as FBID in order to match with Columns specified in Config
            a.first_setup_time,
            a.hardware_build,
            a.allocation_team
        FROM dim_aloha_asset_management a
        JOIN dim_aloha_devices b on a.serial_number = b.device_serial_number
        WHERE
            a.ds = '<LATEST_DS:dim_aloha_asset_management>'
            AND b.ds = '<LATEST_DS:dim_aloha_devices>'
            AND a.secondary_owner_fbid IS NULL
            AND a.df_flag = 1
            AND a.edf_flag = 0
            AND a.hardware_type ='catalina' -- device types you want to include in the distribution
            --AND b.active_device_l28 > 0 -- usually this line will stay commented out for distribution. I use this to check what the denom should be for the active response rate in Task Log.
            AND a.ota_channel in ('Portal Beta Canary','Portal OTA Beta') -- Channels you want to include in distribution. Be sure everything is spelled right & formatted correctly here, some channels include a space in front of the name.
            OR a.owner_fbid in (1659697886,1639302470,671368390,6410940) -- These are Saurabh Bhandari, Trip, Anju, and Joe Sena's FBIDs. Check and see if Saurabh still wants to receive surveys and whether Joe wants to be included.
            AND a.owner_fbid NOT IN (567957396, 627847099) 
            AND a.owner_fbid NOT IN (4) -- MZ
            AND a.state in ('ASSIGNED')
        GROUP BY
          2, 3, 4, 5, 6, 7, 8
        ),

df2 as ( -- This subquery deduplicates any users that may have multiple devices / different channel allocations.
    SELECT 
        FBID, -- note how FBID passes through from df, so no further aliasing is required
        first_name AS first_name, 
        last_name AS last_name,
        MAX(device_serial_number) as device_serial_number, 
        MAX(first_setup_time) AS first_setup_time,
        MAX(device_type) AS device_type,
        MAX(allocation_team) AS allocation_team
    FROM df
    GROUP BY 1,2,3),

df3 as ( -- this subquery further filters devices down to those allocated to Dogfooding. 
    SELECT FBID, first_name, last_name, device_serial_number, device_type
    FROM df2
    WHERE allocation_team in ('Dogfood') -- This is a failsafe on the df_flag = 1 condition from the subquery df 
),

df4 as ( -- this subquery adds in user emails and makes sure we aren't surveying 
SELECT 
    df3.*,
    hr.work_email AS email
FROM df3
LEFT JOIN d_employee_plus:hr hr
ON df3.FBID = hr.personal_fbid
WHERE
ds = '<LATEST_DS:d_employee_plus:hr>'
AND termination_date IS NULL
AND work_email NOT IN (
    'mz@fb.com', 'shigongliu@fb.com','markriseley@fb.com','rfeliu@fb.com','opuada@fb.com','klur@fb.com','gegbo@fb.com','alonrz@fb.com','bdahi@fb.com','afinkelstein@fb.com','euanair@fb.com','akramer@fb.com','staceyr@fb.com','szhuk@fb.com','masa@fb.com','huirongyang@fb.com','harshkang@fb.com','ayy@fb.com','brandiwolff@fb.com','kfischer@fb.com','kendrad@fb.com','weizeng@fb.com','tjloving@fb.com','amyhayes@fb.com','kichoi@fb.com','cravennn@fb.com','bbennett@fb.com','noambe@fb.com'))

SELECT * FROM df4
    """,
        "columns": [
            "device_serial_number",
            "device_type",
            "first_name",
            "email",
            "FBID",
        ],
        "sender": "The Portal Dogfood Survey Team <portaldogfoodingsurvey@fb.com>",
        "email_subject": "Portal TV Core Software Survey September: Please Complete by EOD Wednesday",
        "is_enabled": "TRUE",
        "create_task": "FALSE",
    },
    "generate_portal_df_survey_catalina_core_reminder_sept13": {
        "cron_schedule": "0 10 * * 2",
        "email_message": """
            <html><head></head>
            <body>
            <br><table style="width:50%" align="center">
              <tbody><tr>
                <th colspan="3"><h1 style="font-family:arial;font-weight:normal">Thank you for Dogfooding {columns[device_type]}!</h1></th>
              </tr>
                <tr>
                <th colspan="3"><h2 style="font-family:arial;font-weight:normal">Hello {columns[first_name]}</h2></th>
                </tr>
                <tr><th colspan="2"><p style="font-family:arial;font-weight:normal">This is another friendly reminder to please complete the <b>Portal TV core software survey</b>.</p><br></th>
                </tr><tr>
                <th colspan="2"><p style="font-family:arial;font-weight:normal">Core surveys help us track Portal TV’s health over time, and your feedback is critical!  Please complete the survey by EOD Sunday, August 21st. Click the button below to begin the survey; if you already completed the survey this morning, kindly disregard this message.</p></th>
              </tr>
                <tr><td></td>
                <td><br><p style="text-align:center;"> <a href="https://www.facebook.com/survey/?oid=1252388308871222"> <img src="https://i.imgur.com/riIgnG1.png" width="245" height="80"> </a></p><br></td>
                <td></td>
              </tr>
               <tr>
                <th colspan="3"><p style="font-family:arial;font-weight:normal">Responding to Dogfooding surveys now earns you engagement points which you can redeem for awesome items in the Swag Store! Complete this survey, create a Swag Store account, <a href="https://portal.mypropago.com"> visit this link</a>, and check out the awesome items you can earn just by Dogfooding Portal! For more information about the Swag Store, <a href="https://www.internalfb.com/intern/wiki/Portal/Portal_Dogfooding/Dogfooding/Swag_Store/"> check out the wiki</a>!<br></p></th>
              </tr>
               <tr>
               <th colspan="3"><p style="font-family:arial;font-weight:normal"><b><br>Issues with Portal?</b><br>If you have problems with your Portal {columns[device_serial_number]}, or have any questions/comments, please post in <a href="https://fb.workplace.com/groups/1959599607620319">the Portal Feedback group</a>.</p></th>
               </tr>
               <tr>
               </tr>
               <tr>
               <th colspan="3"><p align="left" style="font-family:arial;font-weight:normal"><br>Best regards,<br>The Portal Dogfooding Survey Team</p></th>
            </tr></tbody></table>
            </body></html>
            """,
        "query": """
            WITH q1 AS (
    SELECT
            MAX(a.device_serial_number) AS device_serial_number,
            b.hardware_type AS device_type,
            a.FBID,
            a.recipients AS email
        FROM aloha_dogfooding_email_recipients a
        JOIN dim_aloha_asset_management b on b.serial_number = a.device_serial_number
        WHERE
            a.ds = '2022-09-12' -- updated
            AND a.category_name like '%catalina_core_sept12%' -- updated
        GROUP BY 2, 3, 4
    ),

q2 AS (
    SELECT
            preferred_first_name AS first_name,
            preferred_last_name,
            unix_username,
            work_email,
            personal_fbid
        FROM d_employee_plus:hr
        WHERE
            ds = '<LATEST_DS:d_employee_plus:hr>'
            AND is_active = TRUE
    ),

q3 AS (
    SELECT
        q1.FBID,
        q1.device_serial_number,
        CASE 
            WHEN q1.device_type = 'aloha'
            THEN 'Aloha'
            WHEN q1.device_type = 'ohana'
            THEN 'Ohana'
            WHEN q1.device_type = 'omni'
            THEN 'Omni'
            WHEN q1.device_type = 'atlas'
            THEN 'Atlas'
            WHEN q1.device_type = 'catalina'
            THEN 'Catalina'
            WHEN q1.device_type = 'tate'
            THEN 'Tate'
            WHEN q1.device_type = 'luma'
            THEN 'Luma'
            WHEN q1.device_type IS NULL
            THEN 'Aloha'
            ELSE q1.device_type
            END AS device_type,
        q2.first_name,
        q1.email
    from q1
    left join q2
    on q1.FBID = q2.personal_fbid
)

SELECT FBID, device_serial_number, device_type, first_name, email from q3
LEFT JOIN (
    SELECT
        *
    FROM simon_responses_formatted:growth
    WHERE
        survey_id = 1252388308871222 -- updated
        AND ds > '<DATEID-6>'
) complete
    ON q3.FBID = complete.user_id
WHERE
    complete.user_id IS NULL
        """,
        "columns": ["device_serial_number", "device_type", "FBID", "first_name", "email"],
        "sender": "The Portal Dogfood Survey Team <portaldogfoodingsurvey@fb.com>",
        "email_subject": "REMINDER: Please Complete the Portal TV Core Software Survey by EOD Wednesday",
        "is_enabled": "TRUE",
        "create_task": "FALSE",
    },
    "generate_portal_df_survey_tate_core_jul12": {
        "cron_schedule": "0 10 * * 2",
        "email_message": """
            <html><head></head>
            <body>
            <br><table style="width:50%" align="center">
              <tbody><tr>
                <th colspan="3"><h1 style="font-family:arial;font-weight:normal">Thank you for Dogfooding {columns[device_type]}!</h1></th>
              </tr>
                <tr>
                <th colspan="3"><h2 style="font-family:arial;font-weight:normal">Hello {columns[first_name]}</h2></th>
                </tr>
                <tr><th colspan="2"><p style="font-family:arial;font-weight:normal">It's that time of the month! We would love to hear from you about your experience with <b>Portal's core software</b>!</p><br></th>
                </tr><tr>
                <th colspan="2"><p style="font-family:arial;font-weight:normal">Please take a few moments to complete this survey on the <b>quality of Portal's core software</b> by EOD Thursday, 7/14 &#9200. Core surveys help us track Portal’s health over time, and your feedback is critical! Click the button below to begin the survey.</p></th>
              </tr>
                <tr><td></td>
                <td><br><p style="text-align:center;"> <a href="https://www.facebook.com/survey/?oid=1762879734077070"> <img src="https://i.imgur.com/riIgnG1.png" width="245" height="80"> </a></p><br></td>
                <td></td>
              </tr>
               <tr>
                <th colspan="3"><p style="font-family:arial;font-weight:normal">Responding to Dogfooding surveys now earns you engagement points which you can redeem for awesome items in the Swag Store! Complete this survey, create a Swag Store account, <a href="https://portal.mypropago.com"> visit this link</a>, and check out the awesome items you can earn just by Dogfooding Portal! For more information about the Swag Store, <a href="https://www.internalfb.com/intern/wiki/Portal/Portal_Dogfooding/Dogfooding/Swag_Store/"> check out the wiki</a>!<br></p></th>
              </tr>
               <tr>
               <th colspan="3"><p style="font-family:arial;font-weight:normal"><b><br>Issues with Portal?</b><br>If you have problems with your Portal {columns[device_serial_number]}, or have any questions/comments, please post in <a href="https://fb.workplace.com/groups/1959599607620319">the Portal Feedback group</a>.</p></th>
               </tr>
               <tr>
               </tr>
               <tr>
               <th colspan="3"><p align="left" style="font-family:arial;font-weight:normal"><br>Best regards,<br>The Portal Dogfooding Survey Team</p></th>
            </tr></tbody></table>
            </body></html>
            """,
        "query": """
       WITH df AS (
        SELECT
            MAX(a.serial_number) AS device_serial_number,
            CASE 
            WHEN a.hardware_type = 'aloha'
            THEN 'Aloha'
            WHEN a.hardware_type = 'ohana'
            THEN 'Ohana'
            WHEN a.hardware_type = 'omni'
            THEN 'Omni'
            WHEN a.hardware_type = 'atlas'
            THEN 'Atlas'
            WHEN a.hardware_type = 'catalina'
            THEN 'Catalina'
            WHEN a.hardware_type = 'tate'
            THEN 'Tate'
            WHEN a.hardware_type = 'luma'
            THEN 'Luma'
            WHEN a.hardware_type IS NULL
            THEN 'Aloha'
            ELSE a.hardware_type
            END AS device_type,
            a.first_name,
            a.owner_fbid AS FBID,
            a.first_setup_time,
            a.hardware_build,
            a.allocation_team
        FROM dim_aloha_asset_management a
        JOIN dim_aloha_devices b on a.serial_number = b.device_serial_number
        WHERE
            a.ds = '<LATEST_DS:dim_aloha_asset_management>'
            AND a.secondary_owner_fbid IS NULL
            AND a.df_flag = 1
            AND a.edf_flag = 0
            AND a.hardware_type in ('tate')
            --AND b.active_device_l28 > 0
            AND a.ota_channel in ('Portal Beta Canary','Portal OTA Beta') 
            OR a.owner_fbid in (1659697886,1599726643)
            AND a.owner_fbid NOT IN (567957396, 627847099)
            AND a.owner_fbid NOT IN (4)
            AND a.state in ('ASSIGNED')
        GROUP BY
          2, 3, 4, 5, 6, 7
        ),

df2 as (
    SELECT 
        FBID, 
        first_name AS first_name, 
        MAX(device_serial_number) as device_serial_number, 
        MAX(first_setup_time) AS first_setup_time,
        MAX(device_type) AS device_type,
        MAX(allocation_team) AS allocation_team
    FROM df
    GROUP BY 1,2),

df3 as (
    SELECT FBID, first_name, device_serial_number, device_type
    FROM df2
    WHERE allocation_team in ('Dogfood')
),

df4 as (
SELECT 
    df3.*,
    hr.work_email AS email
FROM df3
LEFT JOIN d_employee_plus:hr hr
ON df3.FBID = hr.personal_fbid
WHERE
ds = '<LATEST_DS:d_employee_plus:hr>'
AND termination_date IS NULL
AND work_email NOT IN (
    'mz@fb.com', 'shigongliu@fb.com','markriseley@fb.com','rfeliu@fb.com','opuada@fb.com','klur@fb.com','gegbo@fb.com','alonrz@fb.com','bdahi@fb.com','afinkelstein@fb.com','euanair@fb.com','akramer@fb.com','staceyr@fb.com','szhuk@fb.com','masa@fb.com','huirongyang@fb.com','harshkang@fb.com','ayy@fb.com','brandiwolff@fb.com','kfischer@fb.com','kendrad@fb.com','weizeng@fb.com','tjloving@fb.com','amyhayes@fb.com','kichoi@fb.com','cravennn@fb.com','bbennett@fb.com','noambe@fb.com'))

SELECT * FROM df4
    """,
        "columns": [
            "device_serial_number",
            "device_type",
            "first_name",
            "email",
            "FBID",
        ],
        "sender": "The Portal Dogfood Survey Team <portaldogfoodingsurvey@fb.com>",
        "email_subject": "Tate Core Survey July 2022 - Please Complete by EOD Thursday, 7/14",
        "is_enabled": "FALSE",
        "create_task": "FALSE",
    },
    "generate_portal_df_survey_Tate_Core_reminder1_july13": {
        "cron_schedule": "0 10 * * 3",
        "email_message": """
            <html><head></head>
            <body>
            <br><table style="width:50%" align="center">
              <tbody><tr>
                <th colspan="3"><h1 style="font-family:arial;font-weight:normal">Thank you for Dogfooding {columns[device_type]}!</h1></th>
              </tr>
                <tr>
                <th colspan="3"><h2 style="font-family:arial;font-weight:normal">Hello {columns[first_name]}</h2></th>
                </tr>
                <tr><th colspan="2"><p style="font-family:arial;font-weight:normal">This is a friendly reminder to please complete the <b>Portal core software survey</b>.</p><br></th>
                </tr><tr>
                <th colspan="2"><p style="font-family:arial;font-weight:normal">The survey should only take a few minutes to complete, and your feedback is extremely important to the Portal team. Your feedback helps improve Portal for everyone! Please complete the survey by EOD tomorrow. Click the button below to begin the survey; if you already completed the survey this morning, kindly disregard this message.</p></th>
              </tr>
                <tr><td></td>
                <td><br><p style="text-align:center;"> <a href="https://www.facebook.com/survey/?oid=1762879734077070"> <img src="https://i.imgur.com/riIgnG1.png" width="245" height="80"> </a></p><br></td>
                <td></td>
              </tr>
               <tr>
                <th colspan="3"><p style="font-family:arial;font-weight:normal">Responding to Dogfooding surveys now earns you engagement points which you can redeem for awesome items in the Swag Store! Complete this survey, create a Swag Store account, <a href="https://portal.mypropago.com"> visit this link</a>, and check out the awesome items you can earn just by Dogfooding Portal! For more information about the Swag Store, <a href="https://www.internalfb.com/intern/wiki/Portal/Portal_Dogfooding/Dogfooding/Swag_Store/"> check out the wiki</a>!<br></p></th>
              </tr>
               <tr>
               <th colspan="3"><p style="font-family:arial;font-weight:normal"><b><br>Issues with Portal?</b><br>If you have problems with your Portal {columns[device_serial_number]}, or have any questions/comments, please post in <a href="https://fb.workplace.com/groups/1959599607620319">the Portal Feedback group</a>.</p></th>
               </tr>
               <tr>
               </tr>
               <tr>
               <th colspan="3"><p align="left" style="font-family:arial;font-weight:normal"><br>Best regards,<br>The Portal Dogfooding Survey Team</p></th>
            </tr></tbody></table>
            </body></html>
            """,
        "query": """
            WITH q1 AS (
    SELECT
            MAX(a.device_serial_number) AS device_serial_number,
            b.hardware_type AS device_type,
            a.FBID,
            a.recipients AS email
        FROM aloha_dogfooding_email_recipients a
        JOIN dim_aloha_asset_management b on b.serial_number = a.device_serial_number
        WHERE
            a.ds = '2022-07-12' -- updated
            AND a.category_name like '%tate_core_jul12%' -- updated
        GROUP BY 2, 3, 4
    ),

q2 AS (
    SELECT
            preferred_first_name AS first_name,
            preferred_last_name,
            unix_username,
            work_email,
            personal_fbid
        FROM d_employee_plus:hr
        WHERE
            ds = '<LATEST_DS:d_employee_plus:hr>'
            AND is_active = TRUE
    ),

q3 AS (
    SELECT
        q1.FBID,
        q1.device_serial_number,
        CASE 
            WHEN q1.device_type = 'aloha'
            THEN 'Aloha'
            WHEN q1.device_type = 'ohana'
            THEN 'Ohana'
            WHEN q1.device_type = 'omni'
            THEN 'Omni'
            WHEN q1.device_type = 'atlas'
            THEN 'Atlas'
            WHEN q1.device_type = 'catalina'
            THEN 'Catalina'
            WHEN q1.device_type = 'tate'
            THEN 'Tate'
            WHEN q1.device_type = 'luma'
            THEN 'Luma'
            WHEN q1.device_type IS NULL
            THEN 'Aloha'
            ELSE q1.device_type
            END AS device_type,
        q2.first_name,
        q1.email
    from q1
    left join q2
    on q1.FBID = q2.personal_fbid
)

SELECT FBID, device_serial_number, device_type, first_name, email from q3
LEFT JOIN (
    SELECT
        *
    FROM simon_responses_formatted:growth
    WHERE
        survey_id = 1762879734077070 -- updated
        AND ds > '<DATEID-6>'
) complete
    ON q3.FBID = complete.user_id
WHERE
    complete.user_id IS NULL
        """,
        "columns": ["device_serial_number", "device_type", "FBID", "first_name", "email"],
        "sender": "The Portal Dogfood Survey Team <portaldogfoodingsurvey@fb.com>",
        "email_subject": "*REMINDER* Tate Core Survey July 2022: Please Complete by EOD Thursday",
        "is_enabled": "FALSE",
        "create_task": "FALSE",
    },
    "generate_device_onboarding_email": {
        "cron_schedule": "0 8 * * *",
        "email_message": """
        <html>
        <head>
        </head>
        <body>
        Hello {columns[first_name]},
        <p>
        We’re excited for you to join the Portal Dogfooding experience! A Portal device has been assigned and is on its' way to you. You will be receiving a {columns[hardware_name]} device with the serial number {columns[device_serial_number]}. If this serial number does not match up with the serial number of the device you received, please let us know.<p> Along with your device, you have been added into the {columns[ota_group]} and <a href="https://fb.workplace.com/groups/1959599607620319/">Portal Feedback</a> workplace groups.<p> The {columns[ota]} group will be the main source for any important announcements, new surveys, and new features that will be available for you to test. Keep a close eye on this group so you can test new features as soon as they are released and for any major updates!<p>The Portal Feedback group is where you can leave any feedback about the Portal device. Input can vary from extended bug reports, positive stories, initial impressions, suggestions, feature requests, and more!<p> We also want to inform you that you are able to utilize Workplace to call into meetings from all of our touch devices to enhance your work from home experience. For more information, please see the <a href="https://fb.workplace.com/groups/1821606021263141/">Workplace on Portal Feedback</a> and <a href="https://fb.workplace.com/groups/557637738200601/"> Portal for Work FYI</a> groups. For a tutorial on how to get Workplace on your Portal device, please see this <a =href"https://fb.workplace.com/groups/557637738200601/permalink/558007591496949/">post</a>.<p> If you have any issues with the device or want to return the device to us, feel free to email us at any time at portaldogfooding@fb.com. We look forward to hearing your feedback!<p>Best,<br> The Portal Dogfooding Team
        </body>
        </html>
    """,
        "query": """
        SELECT
            serial_number as device_serial_number,
            hardware_type,
            CASE
                WHEN hardware_type = 'aloha' THEN 'Portal Plus'
                WHEN hardware_type = 'ohana' THEN 'Portal Gen 1'
                WHEN hardware_type = 'catalina' THEN 'Portal TV'
                WHEN hardware_type = 'omni' THEN 'Portal Mini'
                WHEN hardware_type = 'atlas' THEN 'Portal Gen 2'
            END AS hardware_name,
            amt.first_name,
            CASE
                WHEN ota_channel = 'Portal OTA Beta'
                    THEN '<a href="https://fb.workplace.com/groups/3332837666735850/">Portal Beta Dogfooding FYI & Announcements</a>'
                WHEN ota_channel = 'Portal OTA Alpha'
                    THEN '<a href="https://fb.workplace.com/groups/581819192717326/">Portal Alpha Dogfooding FYI & Announcements</a>'
                WHEN ota_channel = 'Prod (Restricted)'
                    THEN '<a href="https://fb.workplace.com/groups/644179526134010/">Portal Prod Dogfooding FYI & Announcements</a>'
            END AS ota_group,
            CASE
                WHEN ota_channel = 'Portal OTA Beta'
                    THEN 'Portal Beta Dogfooding FYI & Announcements'
                WHEN ota_channel = 'Portal OTA Alpha'
                    THEN 'Portal Alpha Dogfooding FYI & Announcements'
                WHEN ota_channel = 'Prod (Restricted)'
                    THEN 'Portal Prod Dogfooding FYI & Announcements'
            END AS ota,
            owner_fbid AS FBID,
            email
        FROM dim_aloha_asset_management amt
        JOIN aloha_enrollment_test_groups en
            ON amt.owner_fbid = en.employee_fbid
        WHERE
            amt.ds = '<LATEST_DS:dim_aloha_asset_management>'
            AND en.ds = '<LATEST_DS:d_employee_plus:hr>'
            AND df_flag = 1
            AND edf_flag = 0
            AND allocation_team = 'Dogfood'
            AND assigned_at_time >= '<DATEID-1>'
            and hardware_type NOT IN ('luma','tate')
    """,
        "columns": [
            "first_name",
            "hardware_name",
            "device_serial_number",
            "ota_group",
            "ota",
            "email",
            "FBID",
        ],
        "sender": "Portal Dogfooding <portaldogfooding@fb.com>",
        "email_subject": "Portal Family Dogfooding: Welcome to Dogfooding!",
        "is_enabled": "TRUE",
        "create_task": "FALSE",
    },
    "generate_former_employee_email": {
        "cron_schedule": "0 10 * * 4",
        "email_message": """
        <html>
        <body>
        <p>
        Investigations team -
        </p><p>&#128128<p><p>&#128128<p><p>&#128128<p>
        These are the following new former employees who still possess a Portal Dogfood device. The device(s) have been set to poison.
        <p> {columns[info]}
        </p>
        Thanks, <br>
        The Portal Dogfooding Team
        </body>
        </html>
    """,
        "query": """
        SELECT
            CAST(ARRAY_JOIN(ARRAY_AGG(info), '
                            ') AS VARCHAR) AS info,
            'investigations_center@fb.com' AS email,
            '11111' AS FBID,
            '11111' AS device_serial_number
        FROM (
            SELECT
                CONCAT(
                    '<br>',
                    preferred_name,
                    ' - ',
                    hardware_type,
                    ' - ',
                    hardware_build,
                    ' - ',
                    termination_date,
                    ' - ',
                    serial_number,
                    '</br>'
                ) AS info
            FROM dim_aloha_asset_management AS amt
            JOIN d_employee_plus:hr AS hr
                ON amt.owner_fbid = hr.personal_fbid
            WHERE
                amt.ds = '<LATEST_DS:dim_aloha_asset_management>'
                AND hr.ds = '<LATEST_DS:d_employee_plus:hr>'
                AND hr.is_active = FALSE
                AND edf_flag <>1
                AND allocation_team NOT IN ('Workplace VC', 'Personal')
                AND termination_date > '<DATEID-8>'
        )
    """,
        "columns": ["email", "FBID", "info", "device_serial_number"],
        "sender": "Portal Dogfooding <portaldogfooding@fb.com>",
        "email_subject": "Former Employee with Device That Are alreday Poisoned &#128128",
        "is_enabled": "TRUE",
        "create_task": "FALSE",
    },
    "generate_dogfood_enrollment_reminder": {
        "cron_schedule": "0 10 * * 1",
        "email_message": """
        <html>
        <head>
        </head>
        <body>
        Hello {columns[first_name]},
        <p>
        At the moment, your application to test pre-release software on Portal is pending signed agreement(s) from {columns[unsigned_users]}. If you need to resend agreements to yourself and/or your household members, you can do so by following this <a href="https://www.internalfb.com/intern/portal/dogfood/program_selector/">link</a>. (Use the email send icon to resend documents).
        <p>
        Please let the recipients know to expect an email from Adobe Sign (echosign@echosign.com). Once the documents are signed and completed, we will reach out with the next steps.
        <p>
        Please let us know if you have any questions.
        <p>
        Best, <br>
        The Portal Dogfooding Team
        <p>
        *If the agreement is not found in the inbox, be sure to check the spam folder
        </p>
        </body>
        </html>
    """,
        "query": """
        SELECT
            e.test_group_id,
            employee_fbid AS FBID,
            first_name,
            last_name,
            email,
            unsigned_users,
            NULL as device_serial_number
        FROM (
            SELECT
                *
            FROM aloha_enrollment_test_groups
            WHERE
                ds = '<LATEST_DS:aloha_enrollment_test_groups>'
                AND NOT (
                    step = 'approved'
                    OR hh_signature_status = 'all_signed'
                )
                AND enrollment_start_date BETWEEN '<DATEID-20>' AND '<DATEID-2>'
                AND test_type IN ('dogfooding', 'workplace_vc')
        ) e
        JOIN (
            SELECT
                test_group_id,
                ARRAY_JOIN(ARRAY_AGG(name), ', ') AS unsigned_users
            FROM aloha_enrollment_testers
            WHERE
                ds = '<LATEST_DS:aloha_enrollment_testers>'
                AND agreement_status = 'SENT'
            GROUP BY
                1
        ) i
            ON e.test_group_id = i.test_group_id
    """,
        "columns": [
            "first_name",
            "email",
            "FBID",
            "unsigned_users",
            "device_serial_number",
        ],
        "sender": "Portal Dogfooding <portaldogfooding@fb.com>",
        "email_subject": "Portal Family Dogfooding: Complete Your Application Soon!",
        "is_enabled": "TRUE",
        "create_task": "FALSE",
    },
    "generate_pg_first_reminder_email": {
        "cron_schedule": "0 10 * * 4",
        "email_message": """
        <html>
        <head>
        </head>
        <body>
        Hello {columns[first_name]},
        <p>
        At the moment, your application to test pre-release Assistant software on Portal is pending signed agreement(s) from {columns[unsigned_users]}. If you need to resend agreements to yourself and/or your household members, you can do so by following this <a href="https://our.internmc.facebook.com/intern/aloha/product_test?product_test_type=playground">link</a>. (Use the email send icon to resend documents).
        <p>
        Please let the recipients know to expect an email from Adobe Sign (echosign@echosign.com). Once the documents are signed and completed, we will reach out with the next steps.
        <p>
        Please let us know if you have any questions.
        <p>
        Best, <br>
        The Playground Ops Team
        <p>
        *If the agreement is not found in the inbox, be sure to check the spam folder
        </p>
        </body>
        </html>
    """,
        "query": """
        SELECT
            e.test_group_id,
            employee_fbid AS FBID,
            first_name,
            last_name,
            email,
            unsigned_users
        FROM (
            SELECT
                *
            FROM aloha_enrollment_test_groups
            WHERE
                ds = '<LATEST_DS:aloha_enrollment_test_groups>'
                AND NOT (
                    step = 'approved'
                    OR hh_signature_status = 'all_signed'
                )
                AND enrollment_start_date BETWEEN '<DATEID-20>' AND '<DATEID-2>'
                AND test_type = 'playground'
                AND email NOT IN (
                    SELECT
                        recipients
                    FROM aloha_dogfooding_ops_emails
                    WHERE
                        category_name = 'generate_first_reminder_email'
                )
        ) e
        JOIN (
            SELECT
                test_group_id,
                ARRAY_JOIN(ARRAY_AGG(name), ', ') AS unsigned_users
            FROM aloha_enrollment_testers
            WHERE
                ds = '<LATEST_DS:aloha_enrollment_testers>'
            GROUP BY
                1
        ) i
            ON e.test_group_id = i.test_group_id
    """,
        "columns": ["first_name", "email", "FBID", "unsigned_users"],
        "sender": "Playground Ops <playground-ops@fb.com>",
        "email_subject": "Portal Assistant Dogfooding: Complete Your Application Soon!",
        "is_enabled": "TRUE",
        "create_task": "FALSE",
    },
    "generate_recall_email": {
        "cron_schedule": "0 9 * * 1",
        "email_message": """
                <html>
                <head>
                </head>
                <body>
                Hi {columns[first_name]},<br/>
                <p>We noticed you haven't engaged with your {columns[device_type]} device ({columns[device_serial_number]}) in the past 30 days. <p>Please follow this <a href=https://www.internalfb.com/butterfly/form/2747685125516871>link</a> to initiate the return, so we can give others an opportunity to join the Dogfooding community.<p> Please submit the linked butterfly form by the end of this week to prevent further communications on this return request. <b> The form includes an option for those whose devices are stuck in a Facebook office.</b> <p>If you have any questions, feel free to reach out to us at portaldogfooding@fb.com.<p>Thank you for your participation in the Portal Dogfooding Program!<p>Best,<br/>The Portal Dogfooding Team</p>
                </body>
                </html>
            """,
        "query": """
            SELECT
                *
            FROM (
                SELECT
                    serial_number AS device_serial_number,
                    hardware_type AS device_type,
                    hardware_build,
                    owner_fbid AS FBID,
                    amt.first_name,
                    amt.last_name,
                    --unix_username,
                    work_email AS email,
                    --a.last_action_date AS last_online_date,
                    b.last_action_date AS last_active_date
                FROM dim_aloha_asset_management amt
                JOIN d_employee_plus:hr e
                    ON amt.owner_fbid = e.personal_fbid
                JOIN aloha_heartbeat_datelist_slim a
                    ON amt.serial_number = a.device_serial_number
                JOIN aloha_active_devices_datelist b
                    ON amt.serial_number = b.device_serial_number
                WHERE
                    amt.ds = '<LATEST_DS:dim_aloha_asset_management>'
                    AND a.ds = '<LATEST_DS:aloha_heartbeat_datelist_slim>'
                    AND e.ds = '<LATEST_DS:d_employee_plus:hr>'
                    AND b.ds = '<LATEST_DS:aloha_active_devices_datelist>'
                    AND location_country_code = 'US'
                    AND df_flag = 1
                    AND owner_fbid > 0
                    AND owner_fbid NOT IN (
                        SELECT
                            userid
                        FROM butterfly_forms_metrics:infrastructure
                        WHERE
                            ds >= '<DATEID-30>'
                            AND form_id = 2747685125516871
                            AND NOT CONTAINS(executed_butterfly_rules, 385988635759114)
                            AND answers['waiver'][1] <> 'YES; my device is stuck in office. '

                        UNION ALL

                        SELECT
                            userid
                        FROM butterfly_forms_metrics:infrastructure
                        WHERE
                            ds >= '<DATEID-30>'
                            AND form_id = 2747685125516871
                            AND NOT CONTAINS(executed_butterfly_rules, 385988635759114)
                            AND answers['waiver'][1] = 'YES; my device is stuck in office. '

                )
                    and owner_fbid NOT IN (1192064146,722961874,1149859289,1061400139,722961874,1192064146,4805023)
                    AND secondary_owner_fbid IS NULL
                    AND allocation_team = 'Dogfood'
                    AND ota_channel IN (
                        'Portal OTA Alpha',
                        'Portal OTA Beta',
                        'Portal Alpha Canary',
                        'Portal Beta Canary',
                        'Prod (Restricted)',
                        'Portal DF Prod Hotfix'
                    )
                    AND edf_flag <> 1
                    AND mteam_direct_employee_id <> 227085 --Ryan Cairns umbrella
                    AND NOT (
                        CONTAINS(asset_tags, 138060473031027)
                        OR CONTAINS(asset_tags, 1420923608029097)
                        OR CONTAINS(asset_tags, 2220216648035975)
                    )
                    --AND a.last_action_date < '<DATEID-30>'
                    AND b.last_action_date < '<DATEID-30>'
                    AND assigned_at_time < '<DATEID-60>'
            )
            WHERE
                FBID NOT IN (
                    SELECT
                        fbid
                    FROM aloha_dogfooding_email_recipients
                    WHERE
                        category = 'generate_recall_email'
                        AND ds > '<DATEID-7>'
                        AND fbid IS NOT NULL
                )
            """,
        "columns": [
            "device_serial_number",
            "device_type",
            "first_name",
            "email",
            "FBID",
        ],
        "sender": "Portal Dogfooding <portaldogfooding@fb.com>",
        "email_subject": "Portal Dogfooding Weekly Digest: Device Recall({columns[device_type]})",
        "is_enabled": "TRUE",
        "create_task": "FALSE",
    },
    "generate_incomplete_enrollment_email": {
        "cron_schedule": "0 10 * * 1",
        "email_message": """
        <html>
        <head></head><body>Hello {columns[first_name]},<p>The Portal Dogfooding team is reaching out to you because our records show that you have an incomplete enrollment to test pre-release Portal software. You have signed all of our agreements and are just a few steps away from receiving a Portal device!<p> If you are still interested in testing pre-release Portal software, please head back to this <a href="https://www.internalfb.com/intern/portal/dogfood/program_selector/?is_new=1">link</a> and complete your enrollment.<p>If you are no longer interested in testing Portal software, feel free to respond back and let us know.<p> If you have any questions, please don't hesitate to reach out.<p>Best,<br>The Portal Dogfooding Team</body>
        </html>
    """,
        "query": """
        SELECT
            a.first_name,
            a.employee_fbid AS FBID,
            a.email,
            NULL AS device_serial_number
        FROM (
            SELECT
                e.*
            FROM (
                SELECT
                    *
                FROM aloha_enrollment_test_groups
                WHERE
                    ds = '<DATEID>'
                    AND (
                        step = 'approved'
                        OR hh_signature_status = 'all_signed'
                    )
                    AND step <> 'opted_out'
                    AND test_type IN ('dogfooding')
                    AND enrollment_start_date BETWEEN '2020-07-01' AND '<DATEID-3>'
                    AND time_device_types_selected = ''
                    AND email NOT IN (
                        SELECT
                            recipients
                        FROM aloha_dogfooding_email_recipients
                        WHERE
                            category_name = 'generate_incomplete_enrollment_email'
                    )
            ) e
            LEFT JOIN (
                SELECT
                    *
                FROM dim_aloha_asset_management
                WHERE
                    ds = '<DATEID>'
                    AND owner_fbid > 0
                    AND df_flag = 1
            ) amt
                ON e.employee_fbid = amt.owner_fbid
            WHERE
                amt.owner_fbid IS NULL
        ) a
        LEFT JOIN (
            SELECT
                *
            FROM stg_aloha_long_term_participant
            WHERE
                ds = '<DATEID>'
        ) b
            ON a.employee_fbid = b.owner_fbid
        WHERE
            b.owner_fbid IS NULL
    """,
        "columns": ["first_name", "email", "FBID", "device_serial_number"],
        "sender": "Portal Dogfooding <portaldogfooding@fb.com>",
        "email_subject": "Portal Family Dogfooding: Final Steps",
        "is_enabled": "TRUE",
        "create_task": "FALSE",
    },
    "hasht_email": {
        "cron_schedule": "0 23 * * *",
        "email_message": """
        <html>
        <head>
        </head>
        <body>
        Hello {columns[name]},
         {columns['count_h]}
        Best,<br>
        The Portal Dogfooding Team
        </body>
        </html>
    """,
        "query": """
        SELECT
            'Anel' AS first_name,
            'anurkayeva@fb.com' AS email,
            100009995589032 FBID,
            count_h device_serial_number
        FROM (
            SELECT DISTINCT
                hashtag_id count_h
            FROM aloha_hasht_list
            WHERE
                ds = '2021-04-06'
                LIMIT 10
        )
    """,
        "columns": ["first_name", "email", "FBID", "device_serial_number"],
        "sender": "Portal Dogfooding <portaldogfooding@fb.com>",
        "email_subject": "Portal Community hashes",
        "is_enabled": "TRUE",
        "create_task": "FALSE",
    },
    "hasht_email_html": {
        "cron_schedule": "0 23 * * *",
        "email_message": """
        <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional //EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:v="urn:schemas-microsoft-com:vml"><head><!--[if gte mso 9]><xml><o:OfficeDocumentSettings><o:AllowPNG/><o:PixelsPerInch>96</o:PixelsPerInch></o:OfficeDocumentSettings></xml><![endif]--><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><meta content="width=device-width" name="viewport"/><!--[if !mso]><!--><meta content="IE=edge" http-equiv="X-UA-Compatible"/><!--<![endif]--><title></title><!--[if !mso]><!--><!--<![endif]--><style type="text/css">body {margin: 0;padding: 0;}table,td,tr {vertical-align: top;border-collapse: collapse;}* {line-height: inherit;}a[x-apple-data-detectors=true] {color: inherit !important;text-decoration: none !important;}</style><style id="media-query" type="text/css">@media (max-width: 660px) {.block-grid,.col {min-width: 320px !important;max-width: 100% !important;display: block !important;}.block-grid {width: 100% !important;}.col {width: 100% !important;}.col_cont {margin: 0 auto;}img.fullwidth,img.fullwidthOnMobile {max-width: 100% !important;}.no-stack .col {min-width: 0 !important;display: table-cell !important;}.no-stack.two-up .col {width: 50% !important;}.no-stack .col.num2 {width: 16.6% !important;}.no-stack .col.num3 {width: 25% !important;}.no-stack .col.num4 {width: 33% !important;}.no-stack .col.num5 {width: 41.6% !important;}.no-stack .col.num6 {width: 50% !important;}.no-stack .col.num7 {width: 58.3% !important;}.no-stack .col.num8 {width: 66.6% !important;}.no-stack .col.num9 {width: 75% !important;}.no-stack .col.num10 {width: 83.3% !important;}.video-block {max-width: none !important;}.mobile_hide {min-height: 0px;max-height: 0px;max-width: 0px;display: none;overflow: hidden;font-size: 0px;}.desktop_hide {display: block !important;max-height: none !important;}}</style><style id="icon-media-query" type="text/css">@media (max-width: 660px) {.icons-inner {text-align: center;}.icons-inner td {margin: 0 auto;}}</style></head><body class="clean-body" style="margin: 0; padding: 0; -webkit-text-size-adjust: 100%; background-color: #f1f4f8;"><!--[if IE]><div class="ie-browser"><![endif]--><table bgcolor="#f1f4f8" cellpadding="0" cellspacing="0" class="nl-container" role="presentation" style="table-layout: fixed; vertical-align: top; min-width: 320px; border-spacing: 0; border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #f1f4f8; width: 100%;" valign="top" width="100%"><tbody><tr style="vertical-align: top;" valign="top"><td style="word-break: break-word; vertical-align: top;" valign="top"><!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td align="center" style="background-color:#f1f4f8"><![endif]--><div style="background-color:transparent;"><div class="block-grid" style="min-width: 320px; max-width: 640px; overflow-wrap: break-word; word-wrap: break-word; word-break: break-word; Margin: 0 auto; background-color: transparent;"><div style="border-collapse: collapse;display: table;width: 100%;background-color:transparent;"><!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color:transparent;"><tr><td align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:640px"><tr class="layout-full-width" style="background-color:transparent"><![endif]--><!--[if (mso)|(IE)]><td align="center" width="640" style="background-color:transparent;width:640px; border-top: 0px solid transparent; border-left: 0px solid transparent; border-bottom: 0px solid transparent; border-right: 0px solid transparent;" valign="top"><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding-right: 0px; padding-left: 0px; padding-top:0px; padding-bottom:0px;"><![endif]--><div class="col num12" style="min-width: 320px; max-width: 640px; display: table-cell; vertical-align: top; width: 640px;"><div class="col_cont" style="width:100% !important;"><!--[if (!mso)&(!IE)]><!--><div style="border-top:0px solid transparent; border-left:0px solid transparent; border-bottom:0px solid transparent; border-right:0px solid transparent; padding-top:0px; padding-bottom:0px; padding-right: 0px; padding-left: 0px;"><!--<![endif]--><div class="mobile_hide"><table border="0" cellpadding="0" cellspacing="0" class="divider" role="presentation" style="table-layout: fixed; vertical-align: top; border-spacing: 0; border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; min-width: 100%; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%;" valign="top" width="100%"><tbody><tr style="vertical-align: top;" valign="top"><td class="divider_inner" style="word-break: break-word; vertical-align: top; min-width: 100%; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; padding-top: 30px; padding-right: 10px; padding-bottom: 0px; padding-left: 10px;" valign="top"><table align="center" border="0" cellpadding="0" cellspacing="0" class="divider_content" role="presentation" style="table-layout: fixed; vertical-align: top; border-spacing: 0; border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; border-top: 0px solid #BBBBBB; width: 100%;" valign="top" width="100%"><tbody><tr style="vertical-align: top;" valign="top"><td style="word-break: break-word; vertical-align: top; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%;" valign="top"><span></span></td></tr></tbody></table></td></tr></tbody></table></div><!--[if (!mso)&(!IE)]><!--></div><!--<![endif]--></div></div><!--[if (mso)|(IE)]></td></tr></table><![endif]--><!--[if (mso)|(IE)]></td></tr></table></td></tr></table><![endif]--></div></div></div><div style="background-color:transparent;"><div class="block-grid" style="min-width: 320px; max-width: 640px; overflow-wrap: break-word; word-wrap: break-word; word-break: break-word; Margin: 0 auto; background-color: #ffffff;"><div style="border-collapse: collapse;display: table;width: 100%;background-color:#ffffff;"><!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color:transparent;"><tr><td align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:640px"><tr class="layout-full-width" style="background-color:#ffffff"><![endif]--><!--[if (mso)|(IE)]><td align="center" width="640" style="background-color:#ffffff;width:640px; border-top: 0px solid transparent; border-left: 0px solid transparent; border-bottom: 1px solid #F3F2F3; border-right: 0px solid transparent;" valign="top"><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding-right: 0px; padding-left: 0px; padding-top:0px; padding-bottom:0px;"><![endif]--><div class="col num12" style="min-width: 320px; max-width: 640px; display: table-cell; vertical-align: top; width: 640px;"><div class="col_cont" style="width:100% !important;"><!--[if (!mso)&(!IE)]><!--><div style="border-top:0px solid transparent; border-left:0px solid transparent; border-bottom:1px solid #F3F2F3; border-right:0px solid transparent; padding-top:0px; padding-bottom:0px; padding-right: 0px; padding-left: 0px;"><!--<![endif]--><table border="0" cellpadding="0" cellspacing="0" class="divider" role="presentation" style="table-layout: fixed; vertical-align: top; border-spacing: 0; border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; min-width: 100%; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%;" valign="top" width="100%"><tbody><tr style="vertical-align: top;" valign="top"><td class="divider_inner" style="word-break: break-word; vertical-align: top; min-width: 100%; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; padding-top: 15px; padding-right: 10px; padding-bottom: 0px; padding-left: 10px;" valign="top"><table align="center" border="0" cellpadding="0" cellspacing="0" class="divider_content" role="presentation" style="table-layout: fixed; vertical-align: top; border-spacing: 0; border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; border-top: 0px solid #BBBBBB; width: 100%;" valign="top" width="100%"><tbody><tr style="vertical-align: top;" valign="top"><td style="word-break: break-word; vertical-align: top; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%;" valign="top"><span></span></td></tr></tbody></table></td></tr></tbody></table><table border="0" cellpadding="0" cellspacing="0" class="divider" role="presentation" style="table-layout: fixed; vertical-align: top; border-spacing: 0; border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; min-width: 100%; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%;" valign="top" width="100%"><tbody><tr style="vertical-align: top;" valign="top"><td class="divider_inner" style="word-break: break-word; vertical-align: top; min-width: 100%; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; padding-top: 18px; padding-right: 10px; padding-bottom: 0px; padding-left: 10px;" valign="top"><table align="center" border="0" cellpadding="0" cellspacing="0" class="divider_content" role="presentation" style="table-layout: fixed; vertical-align: top; border-spacing: 0; border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; border-top: 0px solid #BBBBBB; width: 100%;" valign="top" width="100%"><tbody><tr style="vertical-align: top;" valign="top"><td style="word-break: break-word; vertical-align: top; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%;" valign="top"><span></span></td></tr></tbody></table></td></tr></tbody></table><!--[if (!mso)&(!IE)]><!--></div><!--<![endif]--></div></div><!--[if (mso)|(IE)]></td></tr></table><![endif]--><!--[if (mso)|(IE)]></td></tr></table></td></tr></table><![endif]--></div></div></div><div style="background-color:transparent;"><div class="block-grid mixed-two-up" style="min-width: 320px; max-width: 640px; overflow-wrap: break-word; word-wrap: break-word; word-break: break-word; Margin: 0 auto; background-color: transparent;"><div style="border-collapse: collapse;display: table;width: 100%;background-color:transparent;"><!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color:transparent;"><tr><td align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:640px"><tr class="layout-full-width" style="background-color:transparent"><![endif]--><!--[if (mso)|(IE)]><td align="center" width="160" style="background-color:transparent;width:160px; border-top: 0px solid transparent; border-left: 0px solid transparent; border-bottom: 0px solid transparent; border-right: 0px solid transparent;" valign="top"><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding-right: 0px; padding-left: 0px; padding-top:5px; padding-bottom:5px;background-color:#ffffff;"><![endif]--><div class="col num3" style="display: table-cell; vertical-align: top; max-width: 320px; min-width: 159px; background-color: #ffffff; width: 160px;"><div class="col_cont" style="width:100% !important;"><!--[if (!mso)&(!IE)]><!--><div style="border-top:0px solid transparent; border-left:0px solid transparent; border-bottom:0px solid transparent; border-right:0px solid transparent; padding-top:5px; padding-bottom:5px; padding-right: 0px; padding-left: 0px;"><!--<![endif]--><div align="center" class="img-container center autowidth" style="padding-right: 0px;padding-left: 0px;"><!--[if mso]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr style="line-height:0px"><td style="padding-right: 0px;padding-left: 0px;" align="center"><![endif]--><img align="center" border="0" class="center autowidth" src="images/myportal.png" style="text-decoration: none; -ms-interpolation-mode: bicubic; height: auto; border: 0; width: 100%; max-width: 160px; display: block;" width="160"/><!--[if mso]></td></tr></table><![endif]--></div><!--[if (!mso)&(!IE)]><!--></div><!--<![endif]--></div></div><!--[if (mso)|(IE)]></td></tr></table><![endif]--><!--[if (mso)|(IE)]></td><td align="center" width="480" style="background-color:transparent;width:480px; border-top: 0px solid transparent; border-left: 0px solid transparent; border-bottom: 0px solid transparent; border-right: 0px solid transparent;" valign="top"><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding-right: 0px; padding-left: 0px; padding-top:5px; padding-bottom:5px;background-color:#ffffff;"><![endif]--><div class="col num9" style="display: table-cell; vertical-align: top; max-width: 320px; min-width: 477px; background-color: #ffffff; width: 480px;"><div class="col_cont" style="width:100% !important;"><!--[if (!mso)&(!IE)]><!--><div style="border-top:0px solid transparent; border-left:0px solid transparent; border-bottom:0px solid transparent; border-right:0px solid transparent; padding-top:5px; padding-bottom:5px; padding-right: 0px; padding-left: 0px;"><!--<![endif]--><div align="center" class="img-container center autowidth" style="padding-right: 20px;padding-left: 20px;"><!--[if mso]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr style="line-height:0px"><td style="padding-right: 20px;padding-left: 20px;" align="center"><![endif]--><div style="font-size:1px;line-height:20px"> </div><img align="center" alt="Image" border="0" class="center autowidth" src="https://scontent.xx.fbcdn.net/v/t39.2365-6/121280473_643589743249222_6489550308265824365_n.svg?_nc_cat=111&amp;_nc_map=test-rt&amp;ccb=1-3&amp;_nc_sid=ad8a9d&amp;_nc_ohc=DI9SDybBB84AX8_eM7E&amp;_nc_ht=scontent.xx&amp;_nc_rmd=260&amp;oh=a594fd45170259d495547db6bc3175fb&amp;oe=608DA174" style="text-decoration: none; -ms-interpolation-mode: bicubic; height: auto; border: 0; width: 100%; max-width: 149px; display: block;" title="Image" width="149"/><div style="font-size:1px;line-height:20px"> </div><!--[if mso]></td></tr></table><![endif]--></div><!--[if (!mso)&(!IE)]><!--></div><!--<![endif]--></div></div><!--[if (mso)|(IE)]></td></tr></table><![endif]--><!--[if (mso)|(IE)]></td></tr></table></td></tr></table><![endif]--></div></div></div><div style="background-color:transparent;"><div class="block-grid" style="min-width: 320px; max-width: 640px; overflow-wrap: break-word; word-wrap: break-word; word-break: break-word; Margin: 0 auto; background-color: #ffffff;"><div style="border-collapse: collapse;display: table;width: 100%;background-color:#ffffff;"><!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color:transparent;"><tr><td align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:640px"><tr class="layout-full-width" style="background-color:#ffffff"><![endif]--><!--[if (mso)|(IE)]><td align="center" width="640" style="background-color:#ffffff;width:640px; border-top: 0px solid transparent; border-left: 0px solid transparent; border-bottom: 0px solid transparent; border-right: 0px solid transparent;" valign="top"><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding-right: 0px; padding-left: 0px; padding-top:0px; padding-bottom:0px;"><![endif]--><div class="col num12" style="min-width: 320px; max-width: 640px; display: table-cell; vertical-align: top; width: 640px;"><div class="col_cont" style="width:100% !important;"><!--[if (!mso)&(!IE)]><!--><div style="border-top:0px solid transparent; border-left:0px solid transparent; border-bottom:0px solid transparent; border-right:0px solid transparent; padding-top:0px; padding-bottom:0px; padding-right: 0px; padding-left: 0px;"><!--<![endif]--><table border="0" cellpadding="0" cellspacing="0" class="divider" role="presentation" style="table-layout: fixed; vertical-align: top; border-spacing: 0; border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; min-width: 100%; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%;" valign="top" width="100%"><tbody><tr style="vertical-align: top;" valign="top"><td class="divider_inner" style="word-break: break-word; vertical-align: top; min-width: 100%; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; padding-top: 10px; padding-right: 10px; padding-bottom: 10px; padding-left: 10px;" valign="top"><table align="center" border="0" cellpadding="0" cellspacing="0" class="divider_content" role="presentation" style="table-layout: fixed; vertical-align: top; border-spacing: 0; border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; border-top: 0px solid #BBBBBB; width: 100%;" valign="top" width="100%"><tbody><tr style="vertical-align: top;" valign="top"><td style="word-break: break-word; vertical-align: top; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%;" valign="top"><span></span></td></tr></tbody></table></td></tr></tbody></table><!--[if mso]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding-right: 40px; padding-left: 40px; padding-top: 20px; padding-bottom: 15px; font-family: Tahoma, sans-serif"><![endif]--><div style="color:#555555;font-family:Trebuchet MS, Lucida Grande, Lucida Sans Unicode, Lucida Sans, Tahoma, sans-serif;line-height:1.2;padding-top:20px;padding-right:40px;padding-bottom:15px;padding-left:40px;"><div class="txtTinyMce-wrapper" style="line-height: 1.2; font-size: 12px; color: #555555; font-family: Trebuchet MS, Lucida Grande, Lucida Sans Unicode, Lucida Sans, Tahoma, sans-serif; mso-line-height-alt: 14px;"><p style="font-size: 30px; line-height: 1.2; text-align: center; word-break: break-word; mso-line-height-alt: 36px; margin: 0;"><span style="font-size: 30px; color: #003188;"><strong>We haven’t heard from you!</strong></span></p></div></div><!--[if mso]></td></tr></table><![endif]--><!--[if mso]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding-right: 40px; padding-left: 40px; padding-top: 15px; padding-bottom: 10px; font-family: Tahoma, sans-serif"><![endif]--><div style="color:#555555;font-family:Trebuchet MS, Lucida Grande, Lucida Sans Unicode, Lucida Sans, Tahoma, sans-serif;line-height:1.5;padding-top:15px;padding-right:40px;padding-bottom:10px;padding-left:40px;"><div class="txtTinyMce-wrapper" style="line-height: 1.5; font-size: 12px; font-family: Trebuchet MS, Lucida Grande, Lucida Sans Unicode, Lucida Sans, Tahoma, sans-serif; color: #555555; mso-line-height-alt: 18px;"><p style="line-height: 1.5; word-break: break-word; font-family: Trebuchet MS, Lucida Grande, Lucida Sans Unicode, Lucida Sans, Tahoma, sans-serif; font-size: 16px; mso-line-height-alt: 24px; margin: 0;"><span style="font-size: 16px; color: #6d89bc;">Our records indicate that you have not engaged with your {columns[hardware_type]} ({columns[device_serial_number]}) over the last week.</span></p><p style="line-height: 1.5; word-break: break-word; font-family: Trebuchet MS, Lucida Grande, Lucida Sans Unicode, Lucida Sans, Tahoma, sans-serif; font-size: 16px; mso-line-height-alt: 24px; margin: 0;"><span style="font-size: 16px; color: #6d89bc;">We ask that Portal dogfooders use their devices and share feedback consistently, as we depend on this signal to ship high quality Portal products and experiences. Please let us know if you are having issues with your device that prevent you from gaining the full Portal experience, or if you are no longer interested in dogfooding. </span></p><p style="line-height: 1.5; word-break: break-word; font-family: Trebuchet MS, Lucida Grande, Lucida Sans Unicode, Lucida Sans, Tahoma, sans-serif; font-size: 16px; mso-line-height-alt: 24px; margin: 0;"><span style="font-size: 16px; color: #6d89bc;">We sincerely appreciate your input and encourage you to report bugs via Bugnub, complete surveys, and post about your experiences in the Portal Feedback Workplace group. </span></p></div></div><!--[if mso]></td></tr></table><![endif]--><!--[if (!mso)&(!IE)]><!--></div><!--<![endif]--></div></div><!--[if (mso)|(IE)]></td></tr></table><![endif]--><!--[if (mso)|(IE)]></td></tr></table></td></tr></table><![endif]--></div></div></div><div style="background-color:transparent;"><div class="block-grid three-up" style="min-width: 320px; max-width: 640px; overflow-wrap: break-word; word-wrap: break-word; word-break: break-word; Margin: 0 auto; background-color: transparent;"><div style="border-collapse: collapse;display: table;width: 100%;background-color:transparent;"><!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color:transparent;"><tr><td align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:640px"><tr class="layout-full-width" style="background-color:transparent"><![endif]--><!--[if (mso)|(IE)]><td align="center" width="160" style="background-color:transparent;width:160px; border-top: 0px solid #FFFFFF; border-left: 0px solid #FFFFFF; border-bottom: 3px solid #FFFFFF; border-right: 0px solid #FFFFFF;" valign="top"><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding-right: 0px; padding-left: 0px; padding-top:5px; padding-bottom:5px;background-color:#ffffff;"><![endif]--><div class="col num3" style="display: table-cell; vertical-align: top; max-width: 320px; min-width: 159px; background-color: #ffffff; width: 160px;"><div class="col_cont" style="width:100% !important;"><!--[if (!mso)&(!IE)]><!--><div style="border-top:0px solid #FFFFFF; border-left:0px solid #FFFFFF; border-bottom:3px solid #FFFFFF; border-right:0px solid #FFFFFF; padding-top:5px; padding-bottom:5px; padding-right: 0px; padding-left: 0px;"><!--<![endif]--><div align="center" class="button-container" style="padding-top:10px;padding-right:10px;padding-bottom:10px;padding-left:10px;"><!--[if mso]><table width="100%" cellpadding="0" cellspacing="0" border="0" style="border-spacing: 0; border-collapse: collapse; mso-table-lspace:0pt; mso-table-rspace:0pt;"><tr><td style="padding-top: 10px; padding-right: 10px; padding-bottom: 10px; padding-left: 10px" align="center"><v:roundrect xmlns:v="urn:schemas-microsoft-com:vml" xmlns:w="urn:schemas-microsoft-com:office:word" href="survey url" style="height:31.5pt;width:95.25pt;v-text-anchor:middle;" arcsize="10%" stroke="false" fillcolor="#3AAEE0"><w:anchorlock/><v:textbox inset="0,0,0,0"><center style="color:#ffffff; font-family:Tahoma, sans-serif; font-size:16px"><![endif]--><a href="survey url" style="-webkit-text-size-adjust: none; text-decoration: none; display: inline-block; color: #ffffff; background-color: #3AAEE0; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; width: auto; width: auto; border-top: 1px solid #3AAEE0; border-right: 1px solid #3AAEE0; border-bottom: 1px solid #3AAEE0; border-left: 1px solid #3AAEE0; padding-top: 5px; padding-bottom: 5px; font-family: Trebuchet MS, Lucida Grande, Lucida Sans Unicode, Lucida Sans, Tahoma, sans-serif; text-align: center; mso-border-alt: none; word-break: keep-all;" target="_blank"><span style="padding-left:20px;padding-right:20px;font-size:16px;display:inline-block;letter-spacing:undefined;"><span style="font-size: 16px; line-height: 2; word-break: break-word; mso-line-height-alt: 32px;">Survey</span></span></a><!--[if mso]></center></v:textbox></v:roundrect></td></tr></table><![endif]--></div><!--[if (!mso)&(!IE)]><!--></div><!--<![endif]--></div></div><!--[if (mso)|(IE)]></td></tr></table><![endif]--><!--[if (mso)|(IE)]></td><td align="center" width="160" style="background-color:transparent;width:160px; border-top: 0px solid transparent; border-left: 0px solid transparent; border-bottom: 0px solid transparent; border-right: 0px solid transparent;" valign="top"><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding-right: 0px; padding-left: 0px; padding-top:5px; padding-bottom:5px;background-color:#ffffff;"><![endif]--><div class="col num3" style="display: table-cell; vertical-align: top; max-width: 320px; min-width: 159px; background-color: #ffffff; width: 160px;"><div class="col_cont" style="width:100% !important;"><!--[if (!mso)&(!IE)]><!--><div style="border-top:0px solid transparent; border-left:0px solid transparent; border-bottom:0px solid transparent; border-right:0px solid transparent; padding-top:5px; padding-bottom:5px; padding-right: 0px; padding-left: 0px;"><!--<![endif]--><div align="center" class="button-container" style="padding-top:10px;padding-right:10px;padding-bottom:10px;padding-left:10px;"><!--[if mso]><table width="100%" cellpadding="0" cellspacing="0" border="0" style="border-spacing: 0; border-collapse: collapse; mso-table-lspace:0pt; mso-table-rspace:0pt;"><tr><td style="padding-top: 10px; padding-right: 10px; padding-bottom: 10px; padding-left: 10px" align="center"><v:roundrect xmlns:v="urn:schemas-microsoft-com:vml" xmlns:w="urn:schemas-microsoft-com:office:word" href="bug url" style="height:31.5pt;width:118.5pt;v-text-anchor:middle;" arcsize="10%" stroke="false" fillcolor="#3AAEE0"><w:anchorlock/><v:textbox inset="0,0,0,0"><center style="color:#ffffff; font-family:Tahoma, sans-serif; font-size:16px"><![endif]--><a href="bug url" style="-webkit-text-size-adjust: none; text-decoration: none; display: inline-block; color: #ffffff; background-color: #3AAEE0; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; width: auto; width: auto; border-top: 1px solid #3AAEE0; border-right: 1px solid #3AAEE0; border-bottom: 1px solid #3AAEE0; border-left: 1px solid #3AAEE0; padding-top: 5px; padding-bottom: 5px; font-family: Trebuchet MS, Lucida Grande, Lucida Sans Unicode, Lucida Sans, Tahoma, sans-serif; text-align: center; mso-border-alt: none; word-break: keep-all;" target="_blank"><span style="padding-left:20px;padding-right:20px;font-size:16px;display:inline-block;letter-spacing:undefined;"><span style="font-size: 16px; line-height: 2; word-break: break-word; mso-line-height-alt: 32px;">Report Bug</span></span></a><!--[if mso]></center></v:textbox></v:roundrect></td></tr></table><![endif]--></div><!--[if (!mso)&(!IE)]><!--></div><!--<![endif]--></div></div><!--[if (mso)|(IE)]></td></tr></table><![endif]--><!--[if (mso)|(IE)]></td><td align="center" width="320" style="background-color:transparent;width:320px; border-top: 0px solid #FFFFFF; border-left: 0px solid #FFFFFF; border-bottom: 0px solid #FFFFFF; border-right: 0px solid #FFFFFF;" valign="top"><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding-right: 0px; padding-left: 0px; padding-top:5px; padding-bottom:5px;background-color:#ffffff;"><![endif]--><div class="col num6" style="display: table-cell; vertical-align: top; max-width: 320px; min-width: 318px; background-color: #ffffff; width: 320px;"><div class="col_cont" style="width:100% !important;"><!--[if (!mso)&(!IE)]><!--><div style="border-top:0px solid #FFFFFF; border-left:0px solid #FFFFFF; border-bottom:0px solid #FFFFFF; border-right:0px solid #FFFFFF; padding-top:5px; padding-bottom:5px; padding-right: 0px; padding-left: 0px;"><!--<![endif]--><div align="center" class="button-container" style="padding-top:10px;padding-right:10px;padding-bottom:10px;padding-left:10px;"><!--[if mso]><table width="100%" cellpadding="0" cellspacing="0" border="0" style="border-spacing: 0; border-collapse: collapse; mso-table-lspace:0pt; mso-table-rspace:0pt;"><tr><td style="padding-top: 10px; padding-right: 10px; padding-bottom: 10px; padding-left: 10px" align="center"><v:roundrect xmlns:v="urn:schemas-microsoft-com:vml" xmlns:w="urn:schemas-microsoft-com:office:word" href="group url" style="height:31.5pt;width:230.25pt;v-text-anchor:middle;" arcsize="10%" stroke="false" fillcolor="#3AAEE0"><w:anchorlock/><v:textbox inset="0,0,0,0"><center style="color:#ffffff; font-family:Tahoma, sans-serif; font-size:16px"><![endif]--><a href="group url" style="-webkit-text-size-adjust: none; text-decoration: none; display: inline-block; color: #ffffff; background-color: #3AAEE0; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; width: auto; width: auto; border-top: 1px solid #3AAEE0; border-right: 1px solid #3AAEE0; border-bottom: 1px solid #3AAEE0; border-left: 1px solid #3AAEE0; padding-top: 5px; padding-bottom: 5px; font-family: Trebuchet MS, Lucida Grande, Lucida Sans Unicode, Lucida Sans, Tahoma, sans-serif; text-align: center; mso-border-alt: none; word-break: keep-all;" target="_blank"><span style="padding-left:20px;padding-right:20px;font-size:16px;display:inline-block;letter-spacing:undefined;"><span style="font-size: 16px; line-height: 2; word-break: break-word; mso-line-height-alt: 32px;">Ask a question or give feedback</span></span></a><!--[if mso]></center></v:textbox></v:roundrect></td></tr></table><![endif]--></div><!--[if (!mso)&(!IE)]><!--></div><!--<![endif]--></div></div><!--[if (mso)|(IE)]></td></tr></table><![endif]--><!--[if (mso)|(IE)]></td></tr></table></td></tr></table><![endif]--></div></div></div><div style="background-color:transparent;"><div class="block-grid" style="min-width: 320px; max-width: 640px; overflow-wrap: break-word; word-wrap: break-word; word-break: break-word; Margin: 0 auto; background-color: #ffffff;"><div style="border-collapse: collapse;display: table;width: 100%;background-color:#ffffff;"><!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color:transparent;"><tr><td align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:640px"><tr class="layout-full-width" style="background-color:#ffffff"><![endif]--><!--[if (mso)|(IE)]><td align="center" width="640" style="background-color:#ffffff;width:640px; border-top: 1px solid #E5EAF3; border-left: 0px solid transparent; border-bottom: 0px solid transparent; border-right: 0px solid transparent;" valign="top"><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding-right: 0px; padding-left: 0px; padding-top:0px; padding-bottom:0px;"><![endif]--><div class="col num12" style="min-width: 320px; max-width: 640px; display: table-cell; vertical-align: top; width: 640px;"><div class="col_cont" style="width:100% !important;"><!--[if (!mso)&(!IE)]><!--><div style="border-top:1px solid #E5EAF3; border-left:0px solid transparent; border-bottom:0px solid transparent; border-right:0px solid transparent; padding-top:0px; padding-bottom:0px; padding-right: 0px; padding-left: 0px;"><!--<![endif]--><!--[if mso]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding-right: 40px; padding-left: 40px; padding-top: 15px; padding-bottom: 10px; font-family: Tahoma, sans-serif"><![endif]--><div style="color:#555555;font-family:Trebuchet MS, Lucida Grande, Lucida Sans Unicode, Lucida Sans, Tahoma, sans-serif;line-height:1.5;padding-top:15px;padding-right:40px;padding-bottom:10px;padding-left:40px;"><div class="txtTinyMce-wrapper" style="line-height: 1.5; font-size: 12px; font-family: Trebuchet MS, Lucida Grande, Lucida Sans Unicode, Lucida Sans, Tahoma, sans-serif; color: #555555; mso-line-height-alt: 18px;"><p style="line-height: 1.5; word-break: break-word; font-family: Trebuchet MS, Lucida Grande, Lucida Sans Unicode, Lucida Sans, Tahoma, sans-serif; font-size: 16px; mso-line-height-alt: 24px; margin: 0;"><span style="font-size: 16px; color: #6d89bc;">Cheers,</span></p><p style="line-height: 1.5; word-break: break-word; font-family: Trebuchet MS, Lucida Grande, Lucida Sans Unicode, Lucida Sans, Tahoma, sans-serif; font-size: 16px; mso-line-height-alt: 24px; margin: 0;"><span style="font-size: 16px; color: #6d89bc;">The Portal Dogfooding Team</span></p><p style="line-height: 1.5; word-break: break-word; font-family: Trebuchet MS, Lucida Grande, Lucida Sans Unicode, Lucida Sans, Tahoma, sans-serif; font-size: 16px; mso-line-height-alt: 24px; margin: 0;"><span style="font-size: 16px; color: #6d89bc;">Please keep in mind that these metrics do not account for WhatsApp usage. We take great pride in the validity of our data, but if for some reason you feel this data is inaccurate, please let us know by replying to this email.</span></p><p style="line-height: 1.5; word-break: break-word; font-family: Trebuchet MS, Lucida Grande, Lucida Sans Unicode, Lucida Sans, Tahoma, sans-serif; mso-line-height-alt: 18px; margin: 0;"> </p></div></div><!--[if mso]></td></tr></table><![endif]--><table border="0" cellpadding="0" cellspacing="0" class="divider" role="presentation" style="table-layout: fixed; vertical-align: top; border-spacing: 0; border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; min-width: 100%; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%;" valign="top" width="100%"><tbody><tr style="vertical-align: top;" valign="top"><td class="divider_inner" style="word-break: break-word; vertical-align: top; min-width: 100%; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; padding-top: 35px; padding-right: 10px; padding-bottom: 0px; padding-left: 10px;" valign="top"><table align="center" border="0" cellpadding="0" cellspacing="0" class="divider_content" role="presentation" style="table-layout: fixed; vertical-align: top; border-spacing: 0; border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; border-top: 0px solid #BBBBBB; width: 100%;" valign="top" width="100%"><tbody><tr style="vertical-align: top;" valign="top"><td style="word-break: break-word; vertical-align: top; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%;" valign="top"><span></span></td></tr></tbody></table></td></tr></tbody></table><!--[if (!mso)&(!IE)]><!--></div><!--<![endif]--></div></div><!--[if (mso)|(IE)]></td></tr></table><![endif]--><!--[if (mso)|(IE)]></td></tr></table></td></tr></table><![endif]--></div></div></div><div style="background-color:transparent;"><div class="block-grid" style="min-width: 320px; max-width: 640px; overflow-wrap: break-word; word-wrap: break-word; word-break: break-word; Margin: 0 auto; background-color: transparent;"><div style="border-collapse: collapse;display: table;width: 100%;background-color:transparent;"><!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color:transparent;"><tr><td align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:640px"><tr class="layout-full-width" style="background-color:transparent"><![endif]--><!--[if (mso)|(IE)]><td align="center" width="640" style="background-color:transparent;width:640px; border-top: 0px solid transparent; border-left: 0px solid transparent; border-bottom: 0px solid transparent; border-right: 0px solid transparent;" valign="top"><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding-right: 0px; padding-left: 0px; padding-top:0px; padding-bottom:0px;"><![endif]--><div class="col num12" style="min-width: 320px; max-width: 640px; display: table-cell; vertical-align: top; width: 640px;"><div class="col_cont" style="width:100% !important;"><!--[if (!mso)&(!IE)]><!--><div style="border-top:0px solid transparent; border-left:0px solid transparent; border-bottom:0px solid transparent; border-right:0px solid transparent; padding-top:0px; padding-bottom:0px; padding-right: 0px; padding-left: 0px;"><!--<![endif]--><div class="mobile_hide"><table border="0" cellpadding="0" cellspacing="0" class="divider" role="presentation" style="table-layout: fixed; vertical-align: top; border-spacing: 0; border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; min-width: 100%; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%;" valign="top" width="100%"><tbody><tr style="vertical-align: top;" valign="top"><td class="divider_inner" style="word-break: break-word; vertical-align: top; min-width: 100%; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; padding-top: 30px; padding-right: 10px; padding-bottom: 0px; padding-left: 10px;" valign="top"><table align="center" border="0" cellpadding="0" cellspacing="0" class="divider_content" role="presentation" style="table-layout: fixed; vertical-align: top; border-spacing: 0; border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; border-top: 0px solid #BBBBBB; width: 100%;" valign="top" width="100%"><tbody><tr style="vertical-align: top;" valign="top"><td style="word-break: break-word; vertical-align: top; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%;" valign="top"><span></span></td></tr></tbody></table></td></tr></tbody></table></div><!--[if (!mso)&(!IE)]><!--></div><!--<![endif]--></div></div><!--[if (mso)|(IE)]></td></tr></table><![endif]--><!--[if (mso)|(IE)]></td></tr></table></td></tr></table><![endif]--></div></div></div><div style="background-color:transparent;"><div class="block-grid" style="min-width: 320px; max-width: 640px; overflow-wrap: break-word; word-wrap: break-word; word-break: break-word; Margin: 0 auto; background-color: transparent;"><div style="border-collapse: collapse;display: table;width: 100%;background-color:transparent;"><!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color:transparent;"><tr><td align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:640px"><tr class="layout-full-width" style="background-color:transparent"><![endif]--><!--[if (mso)|(IE)]><td align="center" width="640" style="background-color:transparent;width:640px; border-top: 0px solid transparent; border-left: 0px solid transparent; border-bottom: 0px solid transparent; border-right: 0px solid transparent;" valign="top"><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding-right: 0px; padding-left: 0px; padding-top:5px; padding-bottom:5px;"><![endif]--><div class="col num12" style="min-width: 320px; max-width: 640px; display: table-cell; vertical-align: top; width: 640px;"><div class="col_cont" style="width:100% !important;"><!--[if (!mso)&(!IE)]><!--><div style="border-top:0px solid transparent; border-left:0px solid transparent; border-bottom:0px solid transparent; border-right:0px solid transparent; padding-top:5px; padding-bottom:5px; padding-right: 0px; padding-left: 0px;"><!--<![endif]--><table cellpadding="0" cellspacing="0" role="presentation" style="table-layout: fixed; vertical-align: top; border-spacing: 0; border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt;" valign="top" width="100%"><tr style="vertical-align: top;" valign="top"><td align="center" style="word-break: break-word; vertical-align: top; padding-top: 5px; padding-right: 0px; padding-bottom: 5px; padding-left: 0px; text-align: center;" valign="top"><!--[if vml]><table align="left" cellpadding="0" cellspacing="0" role="presentation" style="display:inline-block;padding-left:0px;padding-right:0px;mso-table-lspace: 0pt;mso-table-rspace: 0pt;"><![endif]--><!--[if !vml]><!--><table cellpadding="0" cellspacing="0" class="icons-inner" role="presentation" style="table-layout: fixed; vertical-align: top; border-spacing: 0; border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; display: inline-block; margin-right: -4px; padding-left: 0px; padding-right: 0px;" valign="top"><!--<![endif]--><tr style="vertical-align: top;" valign="top"><td align="center" style="word-break: break-word; vertical-align: top; text-align: center; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 6px;" valign="top"><a href="https://www.designedwithbee.com/"><img align="center" alt="Designed with BEE" class="icon" height="32" src="images/bee.png" style="border:0;" width="null"/></a></td><td style="word-break: break-word; font-family: Trebuchet MS, Lucida Grande, Lucida Sans Unicode, Lucida Sans, Tahoma, sans-serif; font-size: 15px; color: #9d9d9d; vertical-align: middle; letter-spacing: undefined;" valign="middle"><a href="https://www.designedwithbee.com/" style="color:#9d9d9d;text-decoration:none;">Designed with BEE</a></td></tr></table></td></tr></table><!--[if (!mso)&(!IE)]><!--></div><!--<![endif]--></div></div><!--[if (mso)|(IE)]></td></tr></table><![endif]--><!--[if (mso)|(IE)]></td></tr></table></td></tr></table><![endif]--></div></div></div><!--[if (mso)|(IE)]></td></tr></table><![endif]--></td></tr></tbody></table><!--[if (IE)]></div><![endif]--></body></html>
    """,
        "query": """
        SELECT
            'Anel' AS first_name,
            'anurkayeva@fb.com' AS email,
            100009995589032 FBID,
            count_h device_serial_number
        FROM (
            SELECT DISTINCT
                hashtag_id count_h
            FROM aloha_hasht_list
            WHERE
                ds = '2021-04-06'
                LIMIT 10
        )
    """,
        "columns": ["first_name", "email", "FBID", "device_serial_number"],
        "sender": "Portal Dogfooding <portaldogfooding@fb.com>",
        "email_subject": "Portal Community hashes",
        "is_enabled": "TRUE",
        "create_task": "FALSE",
    },
    "generate_optin_initial_email": {
        "cron_schedule": "0 9 * * *",
        "email_message": """
            <html>
            <head>
            </head>
            <body>
            Hello {columns[first_name]},
            <p>
            We’re excited to announce that you can now opt-in to dogfood pre-release software on your Portal for Work device: <a href="https://www.internalfb.com/intern/portal/dogfood/agreements/?product_test_type=workplace_vc&ext=1596844776&hash=AeSg1EOhCvPSniZSqiY">SIGN UP HERE.</a>
            <h4>WHAT ARE THE BENEFITS?</h4>
            <ul><li>You get to have all of the fun testing the latest and greatest Portal features before any of your friends/family, and have an opportunity to shape the user experience before it ships to the public.</li>
            <li>Bugnub will be enabled on your device, empowering you to report bugs and poor user experiences directly to our Product, Design, and Engineering teams</li>
            <li>You will be a critical partner in helping us more efficiently test and stabilize our latest software with a wider and more diverse audience, helping us ship love to the Portal community</li></ul>
            <h4>WHAT CAN I EXPECT?</h4>
            <ul><li>Each month we release a new software build to our internal dogfooding community 4-6 weeks before it goes to the public. Once you opt-in, your device will pick up this new software over-the-air (OTA) allowing you to test the latest.</li>
            <li>You’ll continue to integrate Portal into your home, using it to connect with your colleagues, friends and family, testing brand new Portal experiences before anyone else along the way.</li>
            <li>We’ll anticipate your organic feedback via Bugnub (on-device) and Workplace Groups feedback groups, and occasionally solicit your feedback through brief-surveys to ensure we’re always shipping the best experiences.</li></ul>
            <h4>CAN I OPT-OUT LATER IF I WANT TO GO BACK TO PRODUCTION SOFTWARE?</h4>
            <p>Yes, at any time your software OTA channel can be reverted and your Portal will begin picking up public software releases going forward with no action needed on your behalf.
            <p>
            Thanks for dogfooding!
            <p>
            Best,<br>
            The Portal Dogfooding Team
            </body>
            </html>
        """,
        "query": """
                SELECT
                FBID,
                first_name,
                email,
                NULL as device_serial_number
            FROM (
                SELECT
                    it.owner_fbid AS FBID,
                    SUBSTR(it.full_name, 1, STRPOS(full_name, ' ')) AS first_name,
                    it.email
                FROM (
                    SELECT
                        owner_fbid,
                        full_name,
                        work_email AS email
                    FROM aloha_it_asset_management
                    WHERE
                        ds = '<LATEST_DS:aloha_it_asset_management>'
                        AND status_change_date >= CAST('<DATEID-7>' AS DATE)
                        AND status = 'DEPLOYED'
                ) it
                LEFT JOIN (
                    SELECT
                        *
                    FROM aloha_enrollment_test_groups
                    WHERE
                        ds = '<LATEST_DS:aloha_enrollment_test_groups>'
                        AND test_type IN ('dogfooding', 'workplace_vc')
                ) e
                    ON it.email = e.email
                WHERE
                    e.email IS NULL
            ) u
            JOIN (
                SELECT
                    work_email,
                    location_country_code
                FROM d_employee_plus:hr
                WHERE
                    ds = '<LATEST_DS:d_employee_plus:hr>'
                    AND location_country_code IN (
                        'US',
                        'GB',
                        'CA',
                        'IE',
                        'DE',
                        'FR',
                        'IT',
                        'ES',
                        'AU',
                        'NZ',
                        'SG'
                    )
            ) em
                ON u.email = em.work_email
                """,
        "columns": ["first_name", "email", "FBID", "device_serial_number"],
        "sender": "Portal Dogfooding <portaldogfooding@fb.com>",
        "email_subject": "Welcome to the Portal for Work Beta Software Opt-In Program",
        "is_enabled": "TRUE",
        "create_task": "FALSE",
    },
    "generate_PG_new_employee_enrollment": {
        "cron_schedule": "0 9 * * 3",
        "email_message": """
                        <html><head></head>
            <body>
            <br><table style="width:50%" align="center">
              <tbody><tr>
                <th colspan="3"><h1 style="font-family:arial;font-weight:normal">The Playground Dogfooding Team welcomes you to Facebook!</h1></th>
              </tr>
                <tr>
                <th colspan="3"><h2 style="font-family:arial;font-weight:normal">Hello {columns[first_name]}</h2></th>
                </tr>
                <tr><th colspan="2"><p style="font-family:arial;font-weight:normal">We invite you to join our top secret Q.A. program for Portal’s Assistant feature, and receive points for <b>Facebook SWAG!</b></p><br></th>
                </tr><tr>
                <th colspan="2"><p style="font-family:arial;font-weight:normal">Project Playground's focus is to improve Portal 's interactive voice assistant software. The program allows you to keep the Portal at home, and you are encouraged to use the device as your own! Our only request is to complete a brief weekly survey, report any bugs while testing out fresh new features being implemented, and provide your overall feedback on assignments that test different voice assistant features.</p></th>
              </tr>
                <tr><td></td>
                <td><br><p style="text-align:center;"> <a href="https://www.internalfb.com/intern/portal/dogfood/agreements/?product_test_type=playground&ext=1629740838&hash=AeS2x2OSPC8BE1I8so4"> <img src="https://i.imgur.com/DCpXBSI.png" width="245" height="80"> </a></p><br></td>
                <td></td>
              </tr>
               <tr>
                <th colspan="3"><p style="font-family:arial;font-weight:normal">Once the enrollment process has been completed for you and your household members, you can receive a playground dogfooding device to test and provide feedback! Due to current conditions, the device will be shipped to you and you will not physically receive it on campus.<br></p></th>
              </tr>
               <tr>
               <th colspan="3"><p style="font-family:arial;font-weight:normal"><b><br>What to Expect Next:</b><br>Once you have completed the enrollment process and devices are available for distribution, our team will contact you directly with further instructions. In the meantime, please feel free to reply to this email at <a href="mailto:playground-ops@fb.com">playground-ops@fb.com</a> with any questions or concerns.</p></th>
               </tr>
               <tr>
               </tr>
               <tr>
               <th colspan="3"><p style="font-family:arial;font-weight:normal"><b>Already have IT/EE owned Generation 1 Portal or Portal Mini?</b><br> Either of these devices can be opted-in remotely. Click the button below to opt-in a device that you already have.</p></th>
               </tr>
               <tr><td></td>
               <td><br><p style="text-align:center;"> <a href="https://www.internalfb.com/butterfly/form/695680037862275"> <img src="https://i.imgur.com/XDkjhWm.png" width="245" height="80"> </a></p><br></td>
               </tr>
               <tr>
               <th colspan="3"><p align="left" style="font-family:arial;font-weight:normal"><br>Best regards,<br>The Playground Dogfooding Team</p></th>
            </tr></tbody></table>
            </body></html>
        """,
        "query": """
                WITH new_hires AS (
                        SELECT DISTINCT
                            ds,
                            hire_date,
                            preferred_name,
                            personal_fbid,
                            country_code,
                            work_email as email
                        FROM d_employee_plus:hr
                        WHERE
                            ds = '<LATEST_DS:d_employee_plus:hr>'
                            AND ((hire_date BETWEEN '<DATEID-7>' AND '<DATEID>'
                            AND personal_fbid IS NOT NULL
                            AND country_code = 'US'
                            AND termination_date IS NULL
                            AND building_id LIKE 'MPK%'
                            AND contingent_worker_type IS NULL) OR (personal_fbid IN (100065352459952,515420376,100009995589032)))
                    ),
                    enrolled_amt AS (
                        SELECT
                            *
                        FROM dim_aloha_asset_management
                        WHERE
                            allocation_team = 'Playground'
                            AND allocation_team = 'Dogfood'
                            AND ds = '<LATEST_DS:dim_aloha_asset_management>'
                    )
                    SELECT DISTINCT
                        hire_date,
                        serial_number,
                        personal_fbid AS FBID,
                        country_code,
                        email,
                        preferred_name AS first_name,
                        'abc' AS device_serial_number
                    FROM new_hires
                    LEFT JOIN enrolled_amt
                        ON new_hires.personal_fbid = enrolled_amt.owner_fbid
                    WHERE
                        state IS NULL
                    ORDER BY hire_date DESC 
                           """,
                            "columns": [
                            "device_serial_number",
                            "FBID",
                            "first_name",
                           "email"
                           ],
                        "sender": "The Playground Dogfood Team <playground-ops@fb.com>",
                        "email_subject": "The Playground Dogfooding Team welcomes you to Facebook!",
                        "is_enabled": "FALSE",
                        "create_task": "FALSE",
    },
    "generate_weekly_score": {
        "cron_schedule": "0 16 * * *",
        "email_message": """
                     <head></head>
                        <body>
                        <br><table style="width:50%" align="center">
                          <tbody><tr>
                            <th c><h1 style="font-family:arial;font-weight:normal">  </h1></th>
                          </tr>
                            <tr>
                            <th c><h2 style="font-family:arial;font-weight:normal" align="left"></h2>    <p align="left"> Hey {columns[first_name]}</p><br></h2></th>
                            </tr>
                            <tr><th c><p style="font-family:arial;font-weight:normal" align="left"></p>




                                <p align="left">
                You're one of our top Dogfooders  {columns[hardware_type]} ({columns[device_serial_number]}) over the last week - we’re impressed! Keep up the great work. Your engagement score for this week is {columns[total_points]}, which puts you in the {columns[percentile]} percentile of Dogfooders!
                You now have {columns[running_total]} Swag Store points total. These points can be redeemed for cool swag in the Portal DF Swag Store
                                </p>
                                <p align="left">
                To see a more detailed breakdown of your device usage, please see your <a href="https://fburl.com/unidash/zx492wbb">personalized dashboard.</a> <b>Please keep in mind that these metrics do not account for WhatsApp usage.</b>
                <p align="left">Engaging with your device doesn’t just help us improve Portal - it can earn you points to redeem for awesome swag! Learn more about our Dogfooding Swag Store <a href="https://fb.workplace.com/groups/1709552312652936/permalink/2958714477736707/">here.</a>
                <p align="left">
                We sincerely appreciate your feedback and engagement, and encourage you to continue reporting bugs via Bugnub and posting about your experiences in the <a href="https://fb.workplace.com/groups/1959599607620319">Portal Feedback Workplace group</a>.



                            </p></th>
                            </tr><tr>

                            <th ><br> <p  style="font-family:arial;font-weight:normal ; margin-left: 5%;" align="left" >


                                <table style="border-collapse: collapse;" >

                                      <tr>
                                        <td >Points collected from survey</th>
                                        <td >{columns[surveys_completed]}</th>
                                      </tr>
                                      <tr>
                                        <td >Points collected from bug reports</td>
                                        <td >{columns[bug_reports]}</td>
                                      </tr>
                                      <tr>
                                        <td >Feedback points</td>
                                        <td >{columns[feedback_group_posts]}</td>
                                      </tr>
                                        <tr>
                                        <td >percentile</td>
                                        <td >{columns[percentile]}</td>
                                      </tr>
                                       </tr>
                                        <tr>
                                        <td >Running total sincece 08/01/2021</td>
                                        <td >{columns[running_total]}</td>
                                      </tr>

                                    </table>

                            </p></th>
                          </tr>
                            <tr><td></td>

                            <td></td>
                          </tr>


                           <tr>
                           <th c><br><p align="left" style="font-family:arial;font-weight:normal">
                            <p align="left">
                                Best,<br/>
                                The Portal Dogfooding Team
                                </p>

                        </p></th>
                        </tr></tbody></table>
                        </body></html>


            """,
        "query": """
        SELECT
                amt.owner_fbid FBID,
                '' device_serial_number,
                '' hardware_type,
                date_awarded,
                total_points,
                surveys_completed,
                bug_reports,
                feedback_group_posts,
                SPLIT(preferred_name, ' ')[1] first_name,
                work_email email,
                percentile --ths-- this computes their rank percentile = the % of people who have lower score.
                ,
                running_total
            FROM dim_aloha_asset_management amt

            LEFT JOIN (
 
            SELECT
                *,
                ROUND(
                    PERCENT_RANK() OVER (
                        ORDER BY
                            total_points
                    ) * 100
                ) AS percentile
            FROM (
                SELECT
                    *,
                    SUM(total_points) OVER (
                        PARTITION BY
                            owner_fbid
                        ORDER BY
                            date_awarded rows UNBOUNDED PRECEDING
                    ) running_total
                FROM aloha_df_engagement_swag

                WHERE
                    DAY_OF_WEEK(date(ds)) = 5

            )
            WHERE
                date_awarded > '<DATEID-8>'
        ) swag

            ON swag.owner_fbid = amt.owner_fbid

        LEFT JOIN d_employee_plus:hr hr

            ON hr.personal_fbid = amt.owner_fbid

        WHERE
            amt.ds = '<LATEST_DS:dim_aloha_asset_management>'
            AND hr.ds = '<LATEST_DS:d_employee_plus:hr>'
            AND df_flag = 1
            AND amt.owner_fbid > 0
            AND ota_channel IN (
                'Portal OTA Alpha',
                'Portal OTA Beta',
                'Prod (Restricted)',
                'Portal DF Prod Hotfix'
            )
            AND allocation_team IN('Dogfood')

            AND swag.owner_fbid IS NOT NULL
            AND amt.owner_fbid IN (1599726643, 100000311612793, 35803977, 1672552068, 1672552068)
        GROUP BY
            1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12

        HAVING
            (
                SUM(device_online_l7) <> 0
                OR SUM(device_online_l7) IS NOT NULL
            )

            AND percentile > 90
    
            """,
        "columns": [
            "FBID",
            "device_serial_number",
            "hardware_type",
            "date_awarded",
            "total_points",
            "surveys_completed", 
            "bug_reports",
            "feedback_group_posts",
            "first_name",
            "email",
            "percentile",
             "percentile",
            "running_total"
            
        ],
        "sender": "Portal Dogfooding <portaldogfooding@fb.com>",
        "email_subject": "Your score!({columns[hardware_type]}) ",
        "is_enabled": "TRUE",
        "create_task": "FALSE",
    },
    "generate_agreement_complete_email": {
        "cron_schedule": "0 10 * * *",
        "email_message": """
            <html>
            <head>
            </head>
            <body>Hey {columns[first_name]}! {columns[device_serial_number]}<br/>
                 
             
             <p>It’s time for your next step of Dogfooding enrollment! We’d like to notify you that all members of your household have officially completed their agreement(s), and we’re ready for you to log back into the
              <a href="https://www.internalfb.com/intern/portal/dogfood/program_selector/?is_new=true"> Portal Dogfooding enrollment tool </a> to complete your enrollment flow. </p>
             <p>If you have any questions or concerns, feel free to respond to this email or contact us at portaldogfooding@fb.com. Thank you! </p>


            <p>Best,<br/>The Portal Dogfooding Team
            </p>
            </body>
            </html>
            """,
        "query": """

                 SELECT
                 
                    DISTINCT FBID,
                    first_name,
                    --last_name,
                    email,
                    '' device_serial_number
                FROM (
                    SELECT
                        SUBSTR(CAST(latest_signature AS VARCHAR), 1, 10) AS latest_signature_date,
                        --test_type,
                        --step,
                        employee_fbid AS FBID,
                        first_name,
                        --last_name,
                        email
                    FROM aloha_enrollment_test_groups
                    WHERE
                        test_type IN ('dogfooding', 'vr_explorer')

                        AND ds = '<LATEST_DS:aloha_enrollment_test_groups>'
                    
                        AND agreement_status = 'SENT'
                ) e

                WHERE
                    latest_signature_date > '2021-06-29'
                    AND email NOT IN (
                        SELECT
                            recipients
                        FROM aloha_dogfooding_email_recipients
                        WHERE
                            category_name = 'generate_agreement_complete_email'
                    )


            """,
        "columns": [
         
            "FBID",
            "first_name",
            "email",
            "device_serial_number",
            
        ],
        "sender": "Portal Dogfooding <portaldogfooding@fb.com>",
        "email_subject": "FRL Dogfooding Enrollment - Agreements Completed",
        "is_enabled": "TRUE",
        "create_task": "FALSE",
    },
        "generate_gk_biglist_removal_request_pg_ops": {
        "cron_schedule": "0 11 * * 1",
        "email_message": """
            <html>
            <head>
            </head>
            <body>Hey {columns[first_name]}!<br/>
             <p>Here’s this weeks list of users within the <a href = "https://www.internalfb.com/intern/gatekeeper/biglist/portal_playground"> gk biglist </a> that need to be removed. List: {columns[list_of]} </p>
            <p>Thank you! {columns[device_serial_number]}
            </p>
            </body>
            </html>
            """,
        "query": """

            SELECT
                FBID,
                list_of,
                work_email AS email,
                '' AS device_serial_number,
                preferred_name AS first_name
            FROM (
                SELECT
                    FBID,
                    list_of
                FROM (
                    SELECT
                        ARRAY[100000651211705, 1075764297, 100065352459952, 515420376] fb,
                        ARRAY_JOIN(ARRAY_AGG(fbid), '<br>') list_of
                    FROM (
                        SELECT
                            CAST(fbid AS VARCHAR) fbid
                        FROM (
                            SELECT DISTINCT
                                gk.fbid,
                                'terminated' AS status
                            FROM d_employee_plus:hr AS hr
                            JOIN aloha_dogfooding_biglists AS gk
                                ON hr.personal_fbid = gk.fbid
                            WHERE
                                end_employment_date IS NOT NULL
                                AND gk.ds = '<LATEST_DS:d_employee_plus:hr>'
                                AND gk.biglist_name = 'portal_playground'

                                --test example to show users that have left the program and are still employees

                            UNION ALL

                            SELECT
                                gk.fbid,
                                'left pg' AS status
                            FROM aloha_dogfooding_biglists gk
                            WHERE
                                NOT EXISTS (
                                    SELECT
                                        1
                                    FROM dim_aloha_asset_management amt
                                    WHERE
                                        amt.owner_fbid = gk.fbid
                                )
                                AND biglist_name = 'portal_playground'
                                AND ds = '<LATEST_DS:aloha_dogfooding_biglists>'
                        )
                    )
                )
                CROSS JOIN UNNEST(fb) AS f(FBID)
            ) a

            LEFT JOIN d_employee_plus:hr hr


                ON hr.personal_fbid = a.FBID
                where hr.ds = '<LATEST_DS:d_employee_plus:hr>'
            """,
        "columns": [                            
            "device_serial_number",    
            "FBID",
            "first_name",
            "email",
            "list_of"
        ],
        "sender": "Portal Dogfooding <portaldogfooding@fb.com>",
        "email_subject": "Please see for needed removals within PG GK biglist",
        "is_enabled": "TRUE",
        "create_task": "FALSE",
},
"generate_npi_recall_email": {
        "cron_schedule": "0 10 * * 2",
        "email_message": """
            <html>
                    <head>
                    <meta charset="UTF-8">
                    </head>
                    <body>
                        &#128075&#128075 Hi {columns[first_name]},<br/>
                        <p>
                        Thank you for your participation in the Portal Dogfooding program! <b>We are asking that all users of Tate & Luma (NPI) EVT devices return them to us,</b> in preparation for our program’s next phases.<br>
<br/>Kindly initiate the return process of your {columns[device_type]} device {columns[device_serial_number]} by filling out <a href="https://www.internalfb.com/butterfly/form/371356444541648"> this butterfly form.</a> Once this has been submitted, a task will be created and you’ll be informed of next steps. Please note further communications will be sent if we do not hear from you within one week. <br> 
<br/><i>If you have any further questions or concerns, contact us at portaldogfooding@fb.com. </i>
                        <p>
                            Best,
                            <br>
                            The Portal Dogfood Survey Team
                        </p>
                    </body>
            </html>
            """,
        "query": """
                SELECT DISTINCT
                    a.serial_number,
                    a.hardware_type,
                    a.build,
                    a.full_name,
                    a.personal_fbid,
                    a.work_email
                FROM oculus_asset_hourly:bizapps a
                LEFT JOIN dim_aloha_devices b
                    ON a.serial_number = b.device_serial_number
                LEFT JOIN d_employee_plus:hr c
                    ON a.personal_fbid = c.personal_fbid
                WHERE
                    a.ds = '<LATEST_DS/ts:oculus_asset_hourly:bizapps>'
                    AND a.ts = '<LATEST_TS/LATEST_DS:oculus_asset_hourly:bizapps>'
                    AND a.hardware_type IN ('B8 Cipher', 'B8 Terry')
                    AND a.status = 'DEPLOYED'
                    AND a.allocated_to = 'PTL DOGFOOD'
                    AND a.build IN ('EVT1', 'EVT2')
                    AND c.mteam_direct_employee_id != 227085 --Ryan Cairns umbrella    
        """,
        "columns": [
            "device_serial_number",
            "device_type",
            "first_name",
            "email",
            "FBID",
        ],
        "sender": "Portal Dogfooding <portaldogfooding@fb.com>",
        "email_subject": "Portal Dogfooding: We Need Your Device Back! Tate & Luma EVT Recall",
        "is_enabled": "TRUE",
        "create_task": "FALSE",
},

    
    
    
     "generate_reminder_allocation": {
        "cron_schedule": "0 * * * *",
        "email_message": """ There are significant changes on the distribution of column allocation_team in table dim_aloha_asset_management:aloham as below:
                    
                <br>Column allocation_team counts changed in teams : {columns[list_of]} ,
                <br>Counts today : {columns[counts_today]} ,
                <br>Couts yesterday : {columns[counts_]}
                <br><br>
                This change might reflect there are business logic changes on how to identify the Production upgrade pool. To avoid this, please check today’s DAD and make sure there are no unexpected changes. Below pipeline might be impacted and probably need to be modify: https://www.internalfb.com/code/fbsource/[6381015cfcc0]/fbcode/dataswarm-pipelines/tasks/aloha/device/device_gk_groups.py
                 <br><br>
                More details can be found in this post: https://fb.workplace.com/groups/275578114362069/permalink/277305897522624/
                     <br><br>

                Thanks,
                 <br>
                Portal DE


        """,
        "query": """

          WITH TODAY AS (
                SELECT
                    allocation_team,
                    COUNT() counts_today
                FROM dim_aloha_asset_management
                WHERE
                    ds = '<DATEID>'
                GROUP BY
                        1
                )

                SELECT
                    0 device_serial_number,
                    0 FBID,
                    'Anel' first_name,
                    'anurkayeva@fb.com' email, --xiangshi100@fb.com
                    allocation_team list_of,
                    counts_today,
                    counts_

                FROM (
                    SELECT
                        t.allocation_team,
                        t.counts_today,
                        COUNT() counts_
                    FROM dim_aloha_asset_management y
                    FULL JOIN TODAY t
                        ON y.allocation_team = t.allocation_team
                    WHERE
                        ds = '<DATEID-1>'
                    GROUP BY
                        1, 2
                )
                WHERE
                    counts_today * 100 / counts_ >= 120
                    OR counts_ * 100 / counts_today >= 120

                UNION ALL

                SELECT
                    0 device_serial_number,
                    0 FBID,
                    'oncall' first_name,
                    'oncall+aloha_analytics@xmail.facebook.com ' email,
                    allocation_team list_of,
                    counts_today,
                    counts_

                FROM (
                    SELECT
                        t.allocation_team,
                        t.counts_today,
                        COUNT() counts_
                    FROM dim_aloha_asset_management y
                    FULL JOIN TODAY t
                        ON y.allocation_team = t.allocation_team
                    WHERE
                        ds = '<DATEID-1>'
                    GROUP BY
                        1, 2
                )
                WHERE
                    counts_today * 100 / counts_ >= 120
                    OR counts_ * 100 / counts_today >= 120

                UNION ALL



                SELECT
                    0 device_serial_number,
                    0 FBID,
                    'Xiang' first_name,
                    'xiangshi100@fb.com' email,
                    allocation_team list_of,
                    counts_today,
                    counts_

                FROM (
                    SELECT
                        t.allocation_team,
                        t.counts_today,
                        COUNT() counts_
                    FROM dim_aloha_asset_management y
                    FULL JOIN TODAY t
                        ON y.allocation_team = t.allocation_team
                    WHERE
                        ds = '<DATEID-1>'
                    GROUP BY
                        1, 2
                )
                WHERE
                    counts_today * 100 / counts_ >= 120
                    OR counts_ * 100 / counts_today >= 120
            """,
        "columns": [                            
            "device_serial_number",    
            "FBID",
            "first_name",
            "email",
            "list_of",
            "counts_today",
            "counts_"
        ],
        "sender": "oncall+aloha_analytics@xmail.facebook.com",
        "email_subject": "WARNING: Portal Upgrade Pool Allocation Team Changes",
        "is_enabled": "TRUE",
        "create_task": "FALSE",
      },
"generate_new_assistant_on_oculus_hw_assignment": {
        "cron_schedule": "5 13 * * 1",
        "email_message": """
            <html>
                    <head>
                    <meta charset="UTF-8">
                    </head>
                    <body>
                        &#128075&#128075 Hi {columns[first_name]},<br/>
                        <p>
                        Thank you for your willingness to participate in Playground Assistant on Oculus ! <br/>
                        <b> We are calling on you to help out with the most recent homework assignment.</b> 
                        The homework assignment focuses on the Party feature. The party feature allows you to 
                        join up with friends both inside and outside of supported apps. To use voice functionality 
                        within Oculus either enable the wake word “Hey Facebook” or double tap the Oculus button on either of the controllers.<br>
<br/><b>How to complete the homework:</b>

<ul>
<li>Visit the <a href="https://fb.workplace.com/groups/3008270309499635/permalink/3121734414819890/">homework post</a> for more information</li>
<li>Perform each test within the survey</li>
<li>Fill out ratings for each test</li>
<li>SUBMIT!</li>
</ul>
<b>Additional information:</b>
<ul>
<li><u>Testing of this feature is currently only for devices within the US</u></li>

<li>Post any additional feedback or questions/comments within the <a href="https://fb.workplace.com/groups/3008270309499635">  Assistant on Oculus Playground Testing group </a></li>
<li>Contact Playground Ops with feedback or questions/comments at <a href="playground-ops@fb.com"> playground-ops@fb.com </a> <br/>
                        <p>
                            Best,
                            <br>
                            Thank you and happy testing!
                        </p>
                    </body>
            </html>
            """,
        "query": """
                SELECT
                    work_email AS email,
                    preferred_name AS first_name
                FROM workplace_facebook_group_members:workplace AS wp
                JOIN d_employee_plus:hr AS hr
                    ON wp.userid = hr.workplace_fbid
                WHERE
                    wp.group_id = 3008270309499635
                    and wp.ds= '<LATEST_DS:workplace_facebook_group_members:workplace>'
                    and hr.ds='<LATEST_DS:d_employee_plus:hr>'
        """,
        "columns": [
            "first_name",
            "email",
        ],
        "sender": "Project Playground <playground-ops@fb.com>",
        "email_subject": "Assistant testing on Oculus - New Homework assignment",
        "is_enabled": "TRUE",
        "create_task": "FALSE",
},
    
    
    
    
    }

exportIfLast(RawDict(**config))
